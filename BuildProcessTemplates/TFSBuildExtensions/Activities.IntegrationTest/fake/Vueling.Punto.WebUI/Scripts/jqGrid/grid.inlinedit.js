(function(n){n.jgrid.extend({editRow:function(t,i,r,u,f,e,o,s,h){return this.each(function(){var c=this,a,y,b,k=0,p=null,w={},v,l;c.grid&&(v=n(c).jqGrid("getInd",t,!0),v!==!1)&&(b=n(v).attr("editable")||"0",b!="0"||n(v).hasClass("not-editable-row")||(l=c.p.colModel,n("td",v).each(function(i){var u,f,r;if(a=l[i].name,u=c.p.treeGrid===!0&&a==c.p.ExpandColumn,u)y=n("span:first",this).html();else try{y=n.unformat(this,{rowId:t,colModel:l[i]},i)}catch(e){y=n(this).html()}a!="cb"&&a!="subgrid"&&a!="rn"&&(c.p.autoencode&&(y=n.jgrid.htmlDecode(y)),w[a]=y,l[i].editable===!0&&(p===null&&(p=i),u?n("span:first",this).html(""):n(this).html(""),f=n.extend({},l[i].editoptions||{},{id:t+"_"+a,name:a}),l[i].edittype||(l[i].edittype="text"),r=createEl(l[i].edittype,f,y,!0,n.extend({},n.jgrid.ajaxOptions,c.p.ajaxSelectOptions||{})),n(r).addClass("editable"),u?n("span:first",this).append(r):n(this).append(r),l[i].edittype=="select"&&l[i].editoptions.multiple===!0&&n.browser.msie&&n(r).width(n(r).width()),k++))}),k>0&&(w.id=t,c.p.savedRow.push(w),n(v).attr("editable","1"),n("td:eq("+p+") input",v).focus(),i===!0&&n(v).bind("keydown",function(i){if(i.keyCode===27&&n(c).jqGrid("restoreRow",t,h),i.keyCode===13){var r=i.target;return r.tagName=="TEXTAREA"?!0:(n(c).jqGrid("saveRow",t,u,f,e,o,s,h),!1)}i.stopPropagation()}),n.isFunction(r)&&r.call(c,t))))})},saveRow:function(t,i,r,u,f,e,o){return this.each(function(){var s=this,c,h={},p={},d,y,a,v,l,k,g,b,nt,tt,w;if(s.grid&&(v=n(s).jqGrid("getInd",t,!0),v!==!1)&&(d=n(v).attr("editable"),r=r?r:s.p.editurl,d==="1")){if(n("td",v).each(function(t){var i,f,r;if(l=s.p.colModel[t],c=l.name,c!="cb"&&c!="subgrid"&&l.editable===!0&&c!="rn"){switch(l.edittype){case"checkbox":i=["Yes","No"];l.editoptions&&(i=l.editoptions.value.split(":"));h[c]=n("input",this).attr("checked")?i[0]:i[1];break;case"text":case"password":case"textarea":case"button":h[c]=n("input, textarea",this).val();break;case"select":l.editoptions.multiple?(f=n("select",this),r=[],h[c]=n(f).val(),h[c]=h[c]?h[c].join(","):"",n("select > option:selected",this).each(function(t,i){r[t]=n(i).text()}),p[c]=r.join(",")):(h[c]=n("select>option:selected",this).val(),p[c]=n("select>option:selected",this).text());l.formatter&&l.formatter=="select"&&(p={});break;case"custom":try{if(l.editoptions&&n.isFunction(l.editoptions.custom_value)){if(h[c]=l.editoptions.custom_value.call(s,n(".customelement",this),"get"),h[c]===undefined)throw"e2";}else throw"e1";}catch(u){u=="e1"&&info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+n.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);u=="e2"?info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+n.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):info_dialog(jQuery.jgrid.errors.errcap,u.message,jQuery.jgrid.edit.bClose)}}if(a=checkValues(h[c],t,s),a[0]===!1)return a[1]=h[c]+" "+a[1],!1;s.p.autoencode&&(h[c]=n.jgrid.htmlEncode(h[c]))}}),a[0]===!1){try{k=findPos(n("#"+n.jgrid.jqID(t),s.grid.bDiv)[0]);info_dialog(n.jgrid.errors.errcap,a[1],n.jgrid.edit.bClose,{left:k[0],top:k[1]})}catch(it){alert(a[1])}return}if(h&&(b=s.p.prmNames,nt=b.oper,g=b.id,h[nt]=b.editoper,h[g]=t,typeof s.p.inlineData=="undefined"&&(s.p.inlineData={}),typeof u=="undefined"&&(u={}),h=n.extend({},h,s.p.inlineData,u)),r=="clientArray"){for(h=n.extend({},h,p),s.p.autoencode&&n.each(h,function(t,i){h[t]=n.jgrid.htmlDecode(i)}),tt=n(s).jqGrid("setRowData",t,h),n(v).attr("editable","0"),w=0;w<s.p.savedRow.length;w++)if(s.p.savedRow[w].id==t){y=w;break}y>=0&&s.p.savedRow.splice(y,1);n.isFunction(f)&&f.call(s,t,tt)}else n("#lui_"+s.p.id).show(),n.ajax(n.extend({url:r,data:n.isFunction(s.p.serializeRowData)?s.p.serializeRowData.call(s,h):h,type:"POST",complete:function(r,u){var l,c;if(n("#lui_"+s.p.id).hide(),u==="success")if(l=n.isFunction(i)?i.call(s,r):!0,l===!0){for(s.p.autoencode&&n.each(h,function(t,i){h[t]=n.jgrid.htmlDecode(i)}),h=n.extend({},h,p),n(s).jqGrid("setRowData",t,h),n(v).attr("editable","0"),c=0;c<s.p.savedRow.length;c++)if(s.p.savedRow[c].id==t){y=c;break}y>=0&&s.p.savedRow.splice(y,1);n.isFunction(f)&&f.call(s,t,r)}else n.isFunction(e)&&e.call(s,t,r,u),n(s).jqGrid("restoreRow",t,o)},error:function(i,r){n("#lui_"+s.p.id).hide();n.isFunction(e)?e.call(s,t,i,r):alert("Error Row: "+t+" Result: "+i.status+":"+i.statusText+" Status: "+r);n(s).jqGrid("restoreRow",t,o)}},n.jgrid.ajaxOptions,s.p.ajaxRowOptions||{}));n(v).unbind("keydown")}})},restoreRow:function(t,i){return this.each(function(){var r=this,u,e,o={},f;if(r.grid&&(e=n(r).jqGrid("getInd",t,!0),e!==!1)){for(f=0;f<r.p.savedRow.length;f++)if(r.p.savedRow[f].id==t){u=f;break}if(u>=0){if(n.isFunction(n.fn.datepicker))try{n("input.hasDatepicker","#"+n.jgrid.jqID(e.id)).datepicker("hide")}catch(s){}n.each(r.p.colModel,function(){this.editable===!0&&this.name in r.p.savedRow[u]&&(o[this.name]=r.p.savedRow[u][this.name])});n(r).jqGrid("setRowData",t,o);n(e).attr("editable","0").unbind("keydown");r.p.savedRow.splice(u,1)}n.isFunction(i)&&i.call(r,t)}})}})})(jQuery)
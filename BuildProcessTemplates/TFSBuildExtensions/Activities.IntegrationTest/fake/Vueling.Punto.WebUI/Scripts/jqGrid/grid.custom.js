(function(n){n.jgrid.extend({getColProp:function(n){var r={},u=this[0],i,t;if(u.grid){for(i=u.p.colModel,t=0;t<i.length;t++)if(i[t].name==n){r=i[t];break}return r}},setColProp:function(t,i){return this.each(function(){var u,r;if(this.grid&&i)for(u=this.p.colModel,r=0;r<u.length;r++)if(u[r].name==t){n.extend(this.p.colModel[r],i);break}})},sortGrid:function(n,t,i){return this.each(function(){var r=this,f=-1,u,e;if(r.grid){for(n||(n=r.p.sortname),u=0;u<r.p.colModel.length;u++)if(r.p.colModel[u].index==n||r.p.colModel[u].name==n){f=u;break}f!=-1&&(e=r.p.colModel[f].sortable,typeof e!="boolean"&&(e=!0),typeof t!="boolean"&&(t=!1),e&&r.sortData("jqgh_"+n,f,t,i))}})},GridDestroy:function(){return this.each(function(){if(this.grid){this.p.pager&&n(this.p.pager).remove();var t=this.id;try{n("#gbox_"+t).remove()}catch(i){}}})},GridUnload:function(){return this.each(function(){var r,t,i;this.grid&&(r={id:n(this).attr("id"),cl:n(this).attr("class")},this.p.pager&&n(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom"),t=document.createElement("table"),n(t).attr({id:r.id}),t.className=r.cl,i=this.id,n(t).removeClass("ui-jqgrid-btable"),n(this.p.pager).parents("#gbox_"+i).length===1?(n(t).insertBefore("#gbox_"+i).show(),n(this.p.pager).insertBefore("#gbox_"+i)):n(t).insertBefore("#gbox_"+i).show(),n("#gbox_"+i).remove())})},setGridState:function(t){return this.each(function(){if(this.grid){var i=this;t=="hidden"?(n(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+i.p.id).slideUp("fast"),i.p.pager&&n(i.p.pager).slideUp("fast"),i.p.toppager&&n(i.p.toppager).slideUp("fast"),i.p.toolbar[0]===!0&&(i.p.toolbar[1]=="both"&&n(i.grid.ubDiv).slideUp("fast"),n(i.grid.uDiv).slideUp("fast")),i.p.footerrow&&n(".ui-jqgrid-sdiv","#gbox_"+i.p.id).slideUp("fast"),n(".ui-jqgrid-titlebar-close span",i.grid.cDiv).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),i.p.gridstate="hidden"):t=="visible"&&(n(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+i.p.id).slideDown("fast"),i.p.pager&&n(i.p.pager).slideDown("fast"),i.p.toppager&&n(i.p.toppager).slideDown("fast"),i.p.toolbar[0]===!0&&(i.p.toolbar[1]=="both"&&n(i.grid.ubDiv).slideDown("fast"),n(i.grid.uDiv).slideDown("fast")),i.p.footerrow&&n(".ui-jqgrid-sdiv","#gbox_"+i.p.id).slideDown("fast"),n(".ui-jqgrid-titlebar-close span",i.grid.cDiv).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),i.p.gridstate="visible")}})},updateGridRows:function(t,i,r){var f,e=!1,u;return this.each(function(){var o=this,h,c,s,l;if(!o.grid)return!1;i||(i="id");t&&t.length>0&&n(t).each(function(){if(s=this,c=o.rows.namedItem(s[i]),c){if(l=s[i],r===!0&&o.p.jsonReader.repeatitems===!0){o.p.jsonReader.cell&&(s=s[o.p.jsonReader.cell]);for(var t=0;t<s.length;t++)h=o.formatter(l,s[t],t,s,"edit"),u=o.p.colModel[t].title?{title:n.jgrid.stripHtml(h)}:{},o.p.treeGrid===!0&&f==o.p.ExpandColumn?n("td:eq("+t+") > span:first",c).html(h).attr(u):n("td:eq("+t+")",c).html(h).attr(u);return e=!0,!0}n(o.p.colModel).each(function(t){f=r===!0?this.jsonmap||this.name:this.name;s[f]!==undefined&&(h=o.formatter(l,s[f],t,s,"edit"),u=this.title?{title:n.jgrid.stripHtml(h)}:{},o.p.treeGrid===!0&&f==o.p.ExpandColumn?n("td:eq("+t+") > span:first",c).html(h).attr(u):n("td:eq("+t+")",c).html(h).attr(u),e=!0)})}})}),e},filterGrid:function(t,i){return i=n.extend({gridModel:!1,gridNames:!1,gridToolbar:!1,filterModel:[],formtype:"horizontal",autosearch:!0,formclass:"filterform",tableclass:"filtertable",buttonclass:"filterbutton",searchButton:"Search",clearButton:"Clear",enableSearch:!1,enableClear:!1,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,url:"",marksearched:!0},i||{}),this.each(function(){var r=this,u,s,e;if(this.p=i,this.p.filterModel.length===0&&this.p.gridModel===!1){alert("No filter is set");return}if(!t){alert("No target grid is set!");return}if(this.p.gridid=t.indexOf("#")!=-1?t:"#"+t,u=n(this.p.gridid).jqGrid("getGridParam","colModel"),u)this.p.gridModel===!0?(s=n(this.p.gridid)[0],n.each(u,function(n){var t=[];this.search=this.search===!1?!1:!0;e=this.editrules&&this.editrules.searchhidden===!0?!0:this.hidden===!0?!1:!0;this.search===!0&&e===!0&&(t.label=r.p.gridNames===!0?s.p.colNames[n]:"",t.name=this.name,t.index=this.index||this.name,t.stype=this.edittype||"text",t.stype!="select"&&(t.stype="text"),t.defval=this.defval||"",t.surl=this.surl||"",t.sopt=this.editoptions||{},t.width=this.width,r.p.filterModel.push(t))})):n.each(r.p.filterModel,function(){for(var n=0;n<u.length;n++)if(this.name==u[n].name){this.index=u[n].index||this.name;break}this.index||(this.index=this.name)});else{alert("Could not get grid colModel");return}var f=function(){var f={},e=0,i,t=n(r.p.gridid)[0],u,s,o;t.p.searchdata={};n.isFunction(r.p.beforeSearch)&&r.p.beforeSearch();n.each(r.p.filterModel,function(){u=this.index;switch(this.stype){case"select":if(i=n("select[name="+u+"]",r).val(),i)f[u]=i,r.p.marksearched&&n("#jqgh_"+this.name,t.grid.hDiv).addClass("dirty-cell"),e++;else{r.p.marksearched&&n("#jqgh_"+this.name,t.grid.hDiv).removeClass("dirty-cell");try{delete t.p.postData[this.index]}catch(o){}}break;default:if(i=n("input[name="+u+"]",r).val(),i)f[u]=i,r.p.marksearched&&n("#jqgh_"+this.name,t.grid.hDiv).addClass("dirty-cell"),e++;else{r.p.marksearched&&n("#jqgh_"+this.name,t.grid.hDiv).removeClass("dirty-cell");try{delete t.p.postData[this.index]}catch(o){}}}});s=e>0?!0:!1;n.extend(t.p.postData,f);r.p.url&&(o=n(t).jqGrid("getGridParam","url"),n(t).jqGrid("setGridParam",{url:r.p.url}));n(t).jqGrid("setGridParam",{search:s}).trigger("reloadGrid",[{page:1}]);o&&n(t).jqGrid("setGridParam",{url:o});n.isFunction(r.p.afterSearch)&&r.p.afterSearch()},h=function(){var f={},i,e=0,t=n(r.p.gridid)[0],u,s,o;n.isFunction(r.p.beforeClear)&&r.p.beforeClear();n.each(r.p.filterModel,function(){u=this.index;i=this.defval?this.defval:"";this.stype||(this.stype="text");switch(this.stype){case"select":var o;if(n("select[name="+u+"] option",r).each(function(t){return t===0&&(this.selected=!0),n(this).text()==i?(this.selected=!0,o=n(this).val(),!1):void 0}),o)f[u]=o,r.p.marksearched&&n("#jqgh_"+this.name,t.grid.hDiv).addClass("dirty-cell"),e++;else{r.p.marksearched&&n("#jqgh_"+this.name,t.grid.hDiv).removeClass("dirty-cell");try{delete t.p.postData[this.index]}catch(s){}}break;case"text":if(n("input[name="+u+"]",r).val(i),i)f[u]=i,r.p.marksearched&&n("#jqgh_"+this.name,t.grid.hDiv).addClass("dirty-cell"),e++;else{r.p.marksearched&&n("#jqgh_"+this.name,t.grid.hDiv).removeClass("dirty-cell");try{delete t.p.postData[this.index]}catch(s){}}}});s=e>0?!0:!1;n.extend(t.p.postData,f);r.p.url&&(o=n(t).jqGrid("getGridParam","url"),n(t).jqGrid("setGridParam",{url:r.p.url}));n(t).jqGrid("setGridParam",{search:s}).trigger("reloadGrid",[{page:1}]);o&&n(t).jqGrid("setGridParam",{url:o});n.isFunction(r.p.afterClear)&&r.p.afterClear()},l=function(){var u=document.createElement("tr"),i,s,c,e,t;r.p.formtype=="horizontal"&&n(o).append(u);n.each(r.p.filterModel,function(s){var h,l,a,w,y,c,p,v,b;e=document.createElement("td");n(e).append("<label for='"+this.name+"'>"+this.label+"<\/label>");t=document.createElement("td");h=this;this.stype||(this.stype="text");switch(this.stype){case"select":if(this.surl)n(t).load(this.surl,function(){h.defval&&n("select",this).val(h.defval);n("select",this).attr({name:h.index||h.name,id:"sg_"+h.name});h.sopt&&n("select",this).attr(h.sopt);r.p.gridToolbar===!0&&h.width&&n("select",this).width(h.width);r.p.autosearch===!0&&n("select",this).change(function(){return f(),!1})});else if(h.sopt.value){if(l=h.sopt.value,a=document.createElement("select"),n(a).attr({name:h.index||h.name,id:"sg_"+h.name}).attr(h.sopt),typeof l=="string")for(w=l.split(";"),p=0;p<w.length;p++)y=w[p].split(":"),c=document.createElement("option"),c.value=y[0],c.innerHTML=y[1],y[1]==h.defval&&(c.selected="selected"),a.appendChild(c);else if(typeof l=="object")for(v in l)l.hasOwnProperty(v)&&(s++,c=document.createElement("option"),c.value=v,c.innerHTML=l[v],l[v]==h.defval&&(c.selected="selected"),a.appendChild(c));r.p.gridToolbar===!0&&h.width&&n(a).width(h.width);n(t).append(a);r.p.autosearch===!0&&n(a).change(function(){return f(),!1})}break;case"text":b=this.defval?this.defval:"";n(t).append("<input type='text' name='"+(this.index||this.name)+"' id='sg_"+this.name+"' value='"+b+"'/>");h.sopt&&n("input",t).attr(h.sopt);r.p.gridToolbar===!0&&h.width&&(n.browser.msie?n("input",t).width(h.width-4):n("input",t).width(h.width-2));r.p.autosearch===!0&&n("input",t).keypress(function(n){var t=n.charCode?n.charCode:n.keyCode?n.keyCode:0;return t==13?(f(),!1):this})}r.p.formtype=="horizontal"?(r.p.gridToolbar===!0&&r.p.gridNames===!1?n(u).append(t):n(u).append(e).append(t),n(u).append(t)):(i=document.createElement("tr"),n(i).append(e).append(t),n(o).append(i))});t=document.createElement("td");r.p.enableSearch===!0&&(s="<input type='button' id='sButton' class='"+r.p.buttonclass+"' value='"+r.p.searchButton+"'/>",n(t).append(s),n("input#sButton",t).click(function(){return f(),!1}));r.p.enableClear===!0&&(c="<input type='button' id='cButton' class='"+r.p.buttonclass+"' value='"+r.p.clearButton+"'/>",n(t).append(c),n("input#cButton",t).click(function(){return h(),!1}));(r.p.enableClear===!0||r.p.enableSearch===!0)&&(r.p.formtype=="horizontal"?n(u).append(t):(i=document.createElement("tr"),n(i).append("<td>&#160;<\/td>").append(t),n(o).append(i)))},c=n("<form name='SearchForm' style=display:inline;' class='"+this.p.formclass+"'><\/form>"),o=n("<table class='"+this.p.tableclass+"' cellspacing='0' cellpading='0' border='0'><tbody><\/tbody><\/table>");n(c).append(o);l();n(this).append(c);this.triggerSearch=f;this.clearSearch=h})},filterToolbar:function(t){return t=n.extend({autosearch:!0,searchOnEnter:!0,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:"",stringResult:!1,groupOp:"AND",defaultSearch:"bw"},t||{}),this.each(function(){function u(t,i){var r=n(t);r[0]&&jQuery.each(i,function(){this.data!==undefined?r.bind(this.type,this.data,this.fn):r.bind(this.type,this.fn)})}var i=this,r=function(){var e={},o=0,f,r,s={},a,u,h,c,l;n.each(i.p.colModel,function(){r=this.index||this.name;var u=this.searchoptions&&this.searchoptions.sopt?this.searchoptions.sopt[0]:t.defaultSearch;switch(this.stype){case"select":if(f=n("select[name="+r+"]",i.grid.hDiv).val(),f)e[r]=f,s[r]=u,o++;else try{delete i.p.postData[r]}catch(h){}break;case"text":if(f=n("input[name="+r+"]",i.grid.hDiv).val(),f)e[r]=f,s[r]=u,o++;else try{delete i.p.postData[r]}catch(h){}}});a=o>0?!0:!1;t.stringResult===!0||i.p.datatype=="local"?(u='{"groupOp":"'+t.groupOp+'","rules":[',h=0,n.each(e,function(n,t){h>0&&(u+=",");u+='{"field":"'+n+'",';u+='"op":"'+s[n]+'",';u+='"data":"'+t+'"}';h++}),u+="]}",n.extend(i.p.postData,{filters:u})):n.extend(i.p.postData,e);i.p.searchurl&&(c=i.p.url,n(i).jqGrid("setGridParam",{url:i.p.searchurl}));l=!1;n.isFunction(t.beforeSearch)&&(l=t.beforeSearch.call(i));l||n(i).jqGrid("setGridParam",{search:a}).trigger("reloadGrid",[{page:1}]);c&&n(i).jqGrid("setGridParam",{url:c});n.isFunction(t.afterSearch)&&t.afterSearch()},o=function(r){var o={},e,s=0,u,a,f,h,c,l;r=typeof r!="boolean"?!0:r;n.each(i.p.colModel,function(){e=this.searchoptions&&this.searchoptions.defaultValue?this.searchoptions.defaultValue:"";u=this.index||this.name;switch(this.stype){case"select":var t;if(n("select[name="+u+"] option",i.grid.hDiv).each(function(i){return i===0&&(this.selected=!0),n(this).text()==e?(this.selected=!0,t=n(this).val(),!1):void 0}),t)o[u]=t,s++;else try{delete i.p.postData[u]}catch(r){}break;case"text":if(n("input[name="+u+"]",i.grid.hDiv).val(e),e)o[u]=e,s++;else try{delete i.p.postData[u]}catch(r){}}});a=s>0?!0:!1;t.stringResult===!0||i.p.datatype=="local"?(f='{"groupOp":"'+t.groupOp+'","rules":[',h=0,n.each(o,function(n,t){h>0&&(f+=",");f+='{"field":"'+n+'",';f+='"op":"eq",';f+='"data":"'+t+'"}';h++}),f+="]}",n.extend(i.p.postData,{filters:f})):n.extend(i.p.postData,o);i.p.searchurl&&(c=i.p.url,n(i).jqGrid("setGridParam",{url:i.p.searchurl}));l=!1;n.isFunction(t.beforeClear)&&(l=t.beforeClear.call(i));l||r&&n(i).jqGrid("setGridParam",{search:a}).trigger("reloadGrid",[{page:1}]);c&&n(i).jqGrid("setGridParam",{url:c});n.isFunction(t.afterClear)&&t.afterClear()},s=function(){var t=n("tr.ui-search-toolbar",i.grid.hDiv);t.css("display")=="none"?t.show():t.hide()},e=n("<tr class='ui-search-toolbar' role='rowheader'><\/tr>"),f;n.each(i.p.colModel,function(){var s=this,c,y,o,b,l,a,h,k,d,v,p,w,g;if(y=n("<th role='columnheader' class='ui-state-default ui-th-column ui-th-"+i.p.direction+"'><\/th>"),c=n("<div style='width:100%;position:relative;height:100%;padding-right:0.3em;'><\/div>"),this.hidden===!0&&n(y).css("display","none"),this.search=this.search===!1?!1:!0,typeof this.stype=="undefined"&&(this.stype="text"),o=n.extend({},this.searchoptions||{}),this.search)switch(this.stype){case"select":if(b=this.surl||o.dataUrl,b)l=c,n.ajax(n.extend({url:b,dataType:"html",complete:function(i){if(o.buildSelect!==undefined){var f=o.buildSelect(i);f&&n(l).append(f)}else n(l).append(i.responseText);o.defaultValue&&n("select",l).val(o.defaultValue);n("select",l).attr({name:s.index||s.name,id:"gs_"+s.name});o.attr&&n("select",l).attr(o.attr);n("select",l).css({width:"100%"});o.dataInit!==undefined&&o.dataInit(n("select",l)[0]);o.dataEvents!==undefined&&u(n("select",l)[0],o.dataEvents);t.autosearch===!0&&n("select",l).change(function(){return r(),!1});i=null}},n.jgrid.ajaxOptions,i.p.ajaxSelectOptions||{}));else if(s.searchoptions&&s.searchoptions.value?a=s.searchoptions.value:s.editoptions&&s.editoptions.value&&(a=s.editoptions.value),a){if(h=document.createElement("select"),h.style.width="100%",n(h).attr({name:s.index||s.name,id:"gs_"+s.name}),typeof a=="string")for(k=a.split(";"),p=0;p<k.length;p++)d=k[p].split(":"),v=document.createElement("option"),v.value=d[0],v.innerHTML=d[1],h.appendChild(v);else if(typeof a=="object")for(w in a)a.hasOwnProperty(w)&&(v=document.createElement("option"),v.value=w,v.innerHTML=a[w],h.appendChild(v));o.defaultValue&&n(h).val(o.defaultValue);o.attr&&n(h).attr(o.attr);o.dataInit!==undefined&&o.dataInit(h);o.dataEvents!==undefined&&u(h,o.dataEvents);n(c).append(h);t.autosearch===!0&&n(h).change(function(){return r(),!1})}break;case"text":g=o.defaultValue?o.defaultValue:"";n(c).append("<input type='text' style='width:95%;padding:0px;' name='"+(s.index||s.name)+"' id='gs_"+s.name+"' value='"+g+"'/>");o.attr&&n("input",c).attr(o.attr);o.dataInit!==undefined&&o.dataInit(n("input",c)[0]);o.dataEvents!==undefined&&u(n("input",c)[0],o.dataEvents);t.autosearch===!0&&(t.searchOnEnter?n("input",c).keypress(function(n){var t=n.charCode?n.charCode:n.keyCode?n.keyCode:0;return t==13?(r(),!1):this}):n("input",c).keydown(function(n){var t=n.which;switch(t){case 13:return!1;case 9:case 16:case 37:case 38:case 39:case 40:case 27:break;default:f&&clearTimeout(f);f=setTimeout(function(){r()},500)}}))}n(y).append(c);n(e).append(y)});n("table thead",i.grid.hDiv).append(e);this.triggerToolbar=r;this.clearToolbar=o;this.toggleToolbar=s})}})})(jQuery)
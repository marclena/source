function createTab(n,t,i){createTab(n,t,i,!0)}function createTab(n,t,i,r){var u,f;r=!0;u="iFrame"+n;openApps[n]==undefined||openApps[n]==null?(f=tabs.add({id:n,title:t,viewConfig:{scrollOffset:1},html:"<iframe id='"+u+"' name='"+u+"' class='innerFrame'><\/iframe>",closable:!0,tabUrl:i}),f.show(),top[u].location.href=i,openApps[n]=f):((r||openApps[n]!=undefined&&openApps[n]!=null&&openApps[n].tabUrl!=i)&&(top[u].location.href=i),openApps[n].show(),openApps[n].tabUrl=i)}function onTabClose(n,t){return openApps[t.id]=null,!0}function closeTab(n){openApps[n]!=undefined&&openApps[n]!=null&&(openApps[n].fastClose=!0,tabs.remove(openApps[n].id),openApps[n]=null)}function logOutClick(){confirm(confimLogout)&&(document.execCommand("ClearAuthenticationCache"),document.location.reload())}var tabs,openApps=[];Ext.onReady(function(){storeUrl=params.StoreUrl;rootNode=new Ext.tree.AsyncTreeNode(Ext.decode(params.RootNode));rootNode==null&&(rootNode=new Ext.tree.TreeNode({id:"0",text:"No tiene acceso al menú",expanded:!1,allowChildren:!1}));var t=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:storeUrl}),reader:new Ext.data.JsonReader({root:"data",totalProperty:"totalCount",id:"Id",fields:["Id","Name","Url","Description","FullPath"]}),remoteSort:!1}),i=new Ext.XTemplate('<tpl for=".">','<div id="{Id}" style="padding: 10px">','<div><a href="{Url}"><h2>{Name}<\/h2><\/a><\/div>','<div class="seccionMenu">{FullPath}<\/div>',"<p>{Description}<\/p><\/div>","<\/tpl>",'<div class="x-clear"><\/div>'),r=new Ext.DataView({store:t,tpl:i,loadingText:"Buscando...",region:"central",frame:!1,autoHeight:!0,multiSelect:!1,overClass:"x-view-over",itemSelector:"div.thumb-wrap",emptyText:'<div style="padding:10px">Utilice el cuadro de texto para buscar opciones en el árbol de navegación.<\/div>'}),u=new Ext.Panel({id:"the-header",region:"north",split:!1,collapsible:!1,height:55,baseCls:"",margins:"4 4 3 4",contentEl:"header",border:!0}),n=new Ext.tree.TreePanel({root:rootNode,collapsible:!0,loader:new Ext.tree.TreeLoader,id:"tree",region:"west",autoScroll:!0,split:!0,collapsible:!0,collapsedCls:"mini",width:200,minWidth:150,baseCls:"x-panel",margins:"0 0 4 4",border:!0,enableDD:!1});n.on("click",function(n){var t=n.attributes.eventInfo;t!=null&&t.TabId>0?createTab(t.TabId,t.Title,t.ActionUrl):t!=null&&t.TabId<0&&(window.location.href=t.ActionUrl)},!0,this);tabs=new Ext.TabPanel({region:"center",deferredRender:!1,autoScroll:!0,enableTabScroll:!0,margins:"0 4 4 0",activeTab:0,viewConfig:{scrollOffset:1},items:[{id:"0",contentEl:"tabs",title:mainTab,iconCls:"mainTabIcon",closable:!1,autoScroll:!0,items:[new Ext.Toolbar({region:"north",items:["-","Buscar: ",new Ext.app.SearchField({store:t})]}),r]}]});viewport=new Ext.Viewport({layout:"border",items:[u,n,tabs]});n.render();rootNode.expand();tabs.on("beforeremove",onTabClose,this);params.TabCaption!=undefined&&params.TabUrl!=undefined&&createTab(0,params.TabCaption,params.TabUrl)});Ext.app.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.app.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(n,t){t.getKey()==t.ENTER&&this.onTrigger2Click()},this)},validationEvent:!1,validateOnBlur:!1,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:!0,width:180,hasSearch:!1,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value="";this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]="";this.store.reload({params:{start:0}});this.triggers[0].hide();this.hasSearch=!1}},onTrigger2Click:function(){var n=this.getRawValue(),t;if(n.length<1){this.onTrigger1Click();return}t={start:0};this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]=n;this.store.reload({params:t});this.hasSearch=!0;this.triggers[0].show()}})
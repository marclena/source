function ValidateItem(n){for(var i=n.items.items,t=0;t<i.length;t++){if(i[t].allowBlank==!1&&i[t].getValue()=="")return alert("El campo "+i[t].fieldLabel+" no puede tener valor nulo o inválido"),document.getElementById(i[t].id).focus(),!1;if(i[t].maskRe!=null&&i[t].getValue()!=""&&(objRegEx=i[t].maskRe,strTmp=i[t].getValue(),objRegEx.test(strTmp)==!1))return alert("El campo "+i[t].fieldLabel+" tiene un valor no válido"),document.getElementById(i[t].id).focus(),!1}return!0}function ValidateNullValues(n){return n==null||n==undefined||n.value==""?null:n.value}function MoneyFmt(n){return Ext.util.Format.formatNumber(n,{decimalSeparator:".",decimalPrecision:2,groupingSeparator:",",groupingSize:3,currencySymbol:"€"})}$$=function(n){return Ext.getCmp(n).getValue()};Ext.apply(Ext.util.Format,{numberFormat:{decimalSeparator:".",decimalPrecision:2,groupingSeparator:",",groupingSize:3,currencySymbol:"€"},formatNumber:function(n,t){var i=Ext.apply(Ext.apply({},Ext.util.Format.numberFormat),t),u,r;if(typeof n!="number"&&(n=String(n),i.currencySymbol&&(n=n.replace(i.currencySymbol,"")),i.groupingSeparator&&(n=n.replace(new RegExp(i.groupingSeparator,"g"),"")),i.decimalSeparator!=="."&&(n=n.replace(i.decimalSeparator,".")),n=parseFloat(n)),u=n<0,n=Math.abs(n).toFixed(i.decimalPrecision),r=n.indexOf("."),r>=0?i.decimalSeparator!=="."&&(n=n.slice(0,r)+i.decimalSeparator+n.slice(r+1)):r=n.length,i.groupingSeparator)while(r>i.groupingSize)r-=i.groupingSize,n=n.slice(0,r)+i.groupingSeparator+n.slice(r);return i.currencySymbol&&(n=n+" "+i.currencySymbol),u&&(n="-"+n),n}});Ext.onReady(function(){var r=params.ResultsPerPage,o=function(){n.baseParams={FileName:ValidateNullValues(Ext.getCmp("FileName")),NumberPoints:ValidateNullValues(Ext.getCmp("NumberPoints")),MoneyAmount:ValidateNullValues(Ext.getCmp("MoneyAmount")),GenerationDate:ValidateNullValues(Ext.getCmp("GenerationDate")),CaducityDate:ValidateNullValues(Ext.getCmp("CaducityDate")),Motivo:ValidateNullValues(Ext.getCmp("Motivo"))};t.render();n.load({params:{start:0,limit:params.ResultsPerPage}})},e=function(){Ext.getCmp("Motivo").value=Ext.getCmp("Motivo").getValue();n.removeAll();o()},u=new Ext.FormPanel({el:"form",frame:!0,collapsible:!0,collapsed:!1,title:"Carga Ad-hoc de puntos",bodyStyle:"padding:5px 5px 0",width:700,height:180,items:[{xtype:"fileuploadfield",id:"FileName",emptyText:"Seleccione un fichero",fieldLabel:"FileName",name:"Filchero",buttonText:"",buttonCfg:{iconCls:"upload-icon"},width:540},{layout:"column",items:[{columnWidth:.6,labelWidth:120,layout:"form",items:[{xtype:"numberfield",fieldLabel:"Numero de puntos",name:"NumberPoints",id:"NumberPoints",width:120,allowblank:!1},{xtype:"datefield",fieldLabel:"Fecha generación",labelWidth:120,name:"GenerationDate",id:"GenerationDate",width:100,allowblank:!1}]},{columnWidth:.4,layout:"form",labelWidth:120,items:[{xtype:"numberfield",fieldLabel:"Euros",name:"MoneyAmount",id:"MoneyAmount",width:120,allowblank:!1},{xtype:"datefield",fieldLabel:"Fecha caducidad",labelWidth:120,name:"CaducityDate",id:"CaducityDate",width:100,allowblank:!1}]}]},{xtype:"textfield",fieldLabel:"Motivo",name:"Motivo",id:"Motivo",width:540,allowblank:!1}],buttons:[{text:"Procesar fichero",type:"submit",handler:function(){e()}},{text:"MyReset",type:"reset",handler:function(){Ext.getCmp("FileName").setValue("Seleccione un fichero");Ext.getCmp("NumberPoints").setValue("");Ext.getCmp("MoneyAmount").setValue("");var n=new Date;Ext.getCmp("GenerationDate").setValue(n);n.setFullYear(n.getYear()+3);Ext.getCmp("CaducityDate").setValue(n);Ext.getCmp("Motivo").setValue("");e()}}]}),r=params.ResultsPerPage,n=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:params.UrlFetcher}),reader:new Ext.data.JsonReader({root:"data",totalProperty:"totalCount",id:"IdRegistro",fields:["sEmail","lPoints","dMoney","Result","ErrorNumber","ErrorMessage"]}),baseParams:{query:"",limit:r},remoteSort:!0}),f,t,i;storeBeforeLoad=function(){};n.on("beforeload",storeBeforeLoad);n.on("load",function(n,i){i.length>0?($("no-results").style.display="none",t.show(),u.collapse(!0)):($("no-results").style.display="block",t.hide(),u.expand(!0))});f=new Ext.grid.ColumnModel([{id:"Email",header:"Email",dataIndex:"sEmail",width:120,sortable:!1},{header:"Puntos",dataIndex:"lPoints",width:60,sortable:!1,align:"right"},{header:"Dinero",dataIndex:"dMoney",width:60,sortable:!1,align:"right",renderer:MoneyFmt},{header:"Resultado",dataIndex:"Result",width:60,sortable:!1},{header:"Cód. Error",dataIndex:"ErrorNumber",width:60,sortable:!1,align:"right"},{header:"Mensaje Error",dataIndex:"ErrorMessage",width:120,sortable:!1}]);f.defaultSortable=!1;t=new Ext.grid.GridPanel({el:"grid",header:!0,title:"Resultados",width:700,height:280,loadMask:!0,store:n,cm:f,collapsible:!0,viewConfig:{forceFit:!0,scrollOffset:1},bbar:new Ext.PagingToolbar({pageSize:r,store:n,displayInfo:!0,items:["-"]})});i=new Date;Ext.getCmp("GenerationDate").setValue(i);i.setFullYear(i.getYear()+3);Ext.getCmp("CaducityDate").setValue(i);u.render();t.render();t.hide();n.load({params:{start:0,limit:r}})})
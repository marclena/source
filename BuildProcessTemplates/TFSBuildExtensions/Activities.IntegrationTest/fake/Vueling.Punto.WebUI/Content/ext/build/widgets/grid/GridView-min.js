Ext.grid.GridView=function(n){Ext.apply(this,n);this.addEvents("beforerowremoved","beforerowsinserted","beforerefresh","rowremoved","rowsinserted","rowupdated","refresh");Ext.grid.GridView.superclass.constructor.call(this)};Ext.extend(Ext.grid.GridView,Ext.util.Observable,{scrollOffset:19,autoFill:!1,forceFit:!1,sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",columnsText:"Columns",borderWidth:2,initTemplates:function(){var n=this.templates||{},i,t;n.master||(n.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-viewport">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset">{header}<\/div><\/div><div class="x-clear"><\/div><\/div>','<div class="x-grid3-scroller"><div class="x-grid3-body">{body}<\/div><a href="#" class="x-grid3-focus" tabIndex="-1"><\/a><\/div>',"<\/div>",'<div class="x-grid3-resize-marker">&#160;<\/div>','<div class="x-grid3-resize-proxy">&#160;<\/div>',"<\/div>"));n.header||(n.header=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead><tr class="x-grid3-hd-row">{cells}<\/tr><\/thead>',"<\/table>"));n.hcell||(n.hcell=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id}" style="{style}"><div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',this.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"><\/a>':"",'{value}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"<\/div><\/td>"));n.body||(n.body=new Ext.Template("{rows}"));n.row||(n.row=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"><table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}<\/tr>",this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}<\/div><\/td><\/tr>':"","<\/tbody><\/table><\/div>"));n.cell||(n.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}<\/div>',"<\/td>"));for(i in n)t=n[i],t&&typeof t.compile=="function"&&!t.compiled&&(t.disableFormats=!0,t.compile());this.templates=n;this.tdClass="x-grid3-cell";this.cellSelector="td.x-grid3-cell";this.hdCls="x-grid3-hd";this.rowSelector="div.x-grid3-row";this.colRe=new RegExp("x-grid3-td-([^\\s]+)","")},fly:function(n){return this._flyweight||(this._flyweight=new Ext.Element.Flyweight(document.body)),this._flyweight.dom=n,this._flyweight},getEditorParent:function(){return this.scroller.dom},initElements:function(){var n=Ext.Element,i=this.grid.getGridEl().dom.firstChild,t=i.childNodes;this.el=new n(i);this.mainWrap=new n(t[0]);this.mainHd=new n(this.mainWrap.dom.firstChild);this.innerHd=this.mainHd.dom.firstChild;this.scroller=new n(this.mainWrap.dom.childNodes[1]);this.forceFit&&this.scroller.setStyle("overflow-x","hidden");this.mainBody=new n(this.scroller.dom.firstChild);this.focusEl=new n(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent("click",!0);this.resizeMarker=new n(t[1]);this.resizeProxy=new n(t[2])},getRows:function(){return this.hasRows()?this.mainBody.dom.childNodes:[]},findCell:function(n){return n?this.fly(n).findParent(this.cellSelector,3):!1},findCellIndex:function(n,t){var i=this.findCell(n);return i&&(!t||this.fly(i).hasClass(t))?this.getCellIndex(i):!1},getCellIndex:function(n){if(n){var t=n.className.match(this.colRe);if(t&&t[1])return this.cm.getIndexById(t[1])}return!1},findHeaderCell:function(n){var t=this.findCell(n);return t&&this.fly(t).hasClass(this.hdCls)?t:null},findHeaderIndex:function(n){return this.findCellIndex(n,this.hdCls)},findRow:function(n){return n?this.fly(n).findParent(this.rowSelector,10):!1},findRowIndex:function(n){var t=this.findRow(n);return t?t.rowIndex:!1},getRow:function(n){return this.getRows()[n]},getCell:function(n,t){return this.getRow(n).getElementsByTagName("td")[t]},getHeaderCell:function(n){return this.mainHd.dom.getElementsByTagName("td")[n]},addRowClass:function(n,t){var i=this.getRow(n);i&&this.fly(i).addClass(t)},removeRowClass:function(n,t){var i=this.getRow(n);i&&this.fly(i).removeClass(t)},removeRow:function(n){Ext.removeNode(this.getRow(n))},removeRows:function(n,t){for(var r=this.mainBody.dom,i=n;i<=t;i++)Ext.removeNode(r.childNodes[n])},getScrollState:function(){var n=this.scroller.dom;return{left:n.scrollLeft,top:n.scrollTop}},restoreScroll:function(n){var t=this.scroller.dom;t.scrollLeft=n.left;t.scrollTop=n.top},scrollToTop:function(){this.scroller.dom.scrollTop=0;this.scroller.dom.scrollLeft=0},syncScroll:function(){this.syncHeaderScroll();var n=this.scroller.dom;this.grid.fireEvent("bodyscroll",n.scrollLeft,n.scrollTop)},syncHeaderScroll:function(){var n=this.scroller.dom;this.innerHd.scrollLeft=n.scrollLeft;this.innerHd.scrollLeft=n.scrollLeft},updateSortIcon:function(n,t){var i=this.sortClasses,r=this.mainHd.select("td").removeClass(i);r.item(n).addClass(i[t=="DESC"?1:0])},updateAllColumnWidths:function(){for(var e,t,o,s,i,r=this.getTotalWidth(),f=this.cm.getColumnCount(),u=[],n=0;n<f;n++)u[n]=this.getColumnWidth(n);for(this.innerHd.firstChild.firstChild.style.width=r,n=0;n<f;n++)e=this.getHeaderCell(n),e.style.width=u[n];for(t=this.getRows(),n=0,o=t.length;n<o;n++)for(t[n].style.width=r,t[n].firstChild.style.width=r,s=t[n].firstChild.rows[0],i=0;i<f;i++)s.childNodes[i].style.width=u[i];this.onAllColumnWidthsUpdated(u,r)},updateColumnWidth:function(n){var u=this.getColumnWidth(n),r=this.getTotalWidth(),f,i,t,e;for(this.innerHd.firstChild.firstChild.style.width=r,f=this.getHeaderCell(n),f.style.width=u,i=this.getRows(),t=0,e=i.length;t<e;t++)i[t].style.width=r,i[t].firstChild.style.width=r,i[t].firstChild.rows[0].childNodes[n].style.width=u;this.onColumnWidthUpdated(n,u,r)},updateColumnHidden:function(n,t){var u=this.getTotalWidth(),f,e,r,i,o;for(this.innerHd.firstChild.firstChild.style.width=u,f=t?"none":"",e=this.getHeaderCell(n),e.style.display=f,r=this.getRows(),i=0,o=r.length;i<o;i++)r[i].style.width=u,r[i].firstChild.style.width=u,r[i].firstChild.rows[0].childNodes[n].style.display=f;this.onColumnHiddenUpdated(n,t,u);delete this.lastViewWidth;this.layout()},doRender:function(n,t,i,r,u,f){for(var y,s,l,w=this.templates,b=w.cell,k=w.row,d=u-1,g="width:"+this.getTotalWidth()+";",p=[],a,h,e={},c={tstyle:g},o,v=0,nt=t.length;v<nt;v++){for(o=t[v],a=[],y=v+r,s=0;s<u;s++)h=n[s],e.id=h.id,e.css=s==0?"x-grid3-cell-first ":s==d?"x-grid3-cell-last ":"",e.attr=e.cellAttr="",e.value=h.renderer(o.data[h.name],e,o,y,s,i),e.style=h.style,(e.value==undefined||e.value==="")&&(e.value="&#160;"),o.dirty&&typeof o.modified[h.name]!="undefined"&&(e.css+=" x-grid3-dirty-cell"),a[a.length]=b.apply(e);l=[];f&&(y+1)%2==0&&(l[0]="x-grid3-row-alt");o.dirty&&(l[1]=" x-grid3-dirty-row");c.cols=u;this.getRowClass&&(l[2]=this.getRowClass(o,y,c,i));c.alt=l.join(" ");c.cells=a.join("");p[p.length]=k.apply(c)}return p.join("")},processRows:function(n,t){var u,e,i,o,r,f,s;if(!(this.ds.getCount()<1))for(t=t||!this.grid.stripeRows,n=n||0,u=this.getRows(),e=" x-grid3-row-alt ",i=n,o=u.length;i<o;i++)if(r=u[i],r.rowIndex=i,!t){if(f=(i+1)%2==0,s=(" "+r.className+" ").indexOf(e)!=-1,f==s)continue;f?r.className+=" x-grid3-row-alt":r.className=r.className.replace("x-grid3-row-alt","")}},renderUI:function(){var t=this.renderHeaders(),i=this.templates.body.apply({rows:""}),r=this.templates.master.apply({body:i,header:t}),n=this.grid,u;n.getGridEl().dom.innerHTML=r;this.initElements();this.mainBody.dom.innerHTML=this.renderRows();this.processRows(0,!0);Ext.fly(this.innerHd).on("click",this.handleHdDown,this);this.mainHd.on("mouseover",this.handleHdOver,this);this.mainHd.on("mouseout",this.handleHdOut,this);this.mainHd.on("mousemove",this.handleHdMove,this);this.scroller.on("scroll",this.syncScroll,this);if(n.enableColumnResize!==!1&&(this.splitone=new Ext.grid.GridView.SplitDragZone(n,this.mainHd.dom)),n.enableColumnMove&&(this.columnDrag=new Ext.grid.GridView.ColumnDragZone(n,this.innerHd),this.columnDrop=new Ext.grid.HeaderDropZone(n,this.mainHd.dom)),n.enableHdMenu!==!1){if(n.enableColumnHide!==!1){this.colMenu=new Ext.menu.Menu({id:n.id+"-hcols-menu"});this.colMenu.on("beforeshow",this.beforeColMenuShow,this);this.colMenu.on("itemclick",this.handleHdMenuClick,this)}this.hmenu=new Ext.menu.Menu({id:n.id+"-hctx"});this.hmenu.add({id:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{id:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});n.enableColumnHide!==!1&&this.hmenu.add("-",{id:"columns",text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"});this.hmenu.on("itemclick",this.handleHdMenuClick,this)}(n.enableDragDrop||n.enableDrag)&&(u=new Ext.grid.GridDragZone(n,{ddGroup:n.ddGroup||"GridDD"}));this.updateHeaderSortState()},layout:function(){var u,r;if(this.mainBody){var i=this.grid,f=i.getGridEl(),e=this.cm,o=i.autoExpandColumn,s=this,t=f.getSize(!0),n=t.width;if(!(n<20)&&!(t.height<20)){i.autoHeight?this.scroller.dom.style.overflow="visible":(this.el.setSize(t.width,t.height),u=this.mainHd.getHeight(),r=t.height-u,this.scroller.setSize(n,r),this.innerHd&&(this.innerHd.style.width=n+"px"));this.forceFit?this.lastViewWidth!=n&&(this.fitColumns(!1,!1),this.lastViewWidth=n):(this.autoExpand(),this.syncHeaderScroll());this.onLayout(n,r)}}},onLayout:function(){},onColumnWidthUpdated:function(){},onAllColumnWidthsUpdated:function(){},onColumnHiddenUpdated:function(){},updateColumnText:function(){},afterMove:function(){},init:function(n){this.grid=n;this.initTemplates();this.initData(n.store,n.colModel);this.initUI(n)},getColumnId:function(n){return this.cm.getColumnId(n)},renderHeaders:function(){for(var i=this.cm,u=this.templates,f=u.hcell,r=[],n={},t=0,e=i.getColumnCount();t<e;t++)n.id=i.getColumnId(t),n.value=i.getColumnHeader(t)||"",n.style=this.getColumnStyle(t,!0),n.tooltip=this.getColumnTooltip(t),i.config[t].align=="right"?n.istyle="padding-right:16px":delete n.istyle,r[r.length]=f.apply(n);return u.header.apply({cells:r.join(""),tstyle:"width:"+this.getTotalWidth()+";"})},getColumnTooltip:function(n){var t=this.cm.getColumnTooltip(n);return t?Ext.QuickTips.isEnabled()?'ext:qtip="'+t+'"':'title="'+t+'"':""},beforeUpdate:function(){this.grid.stopEditing()},updateHeaders:function(){this.innerHd.firstChild.innerHTML=this.renderHeaders()},focusRow:function(n){this.focusCell(n,0,!1)},focusCell:function(n,t,i){var r=this.ensureVisible(n,t,i);this.focusEl.setXY(r);Ext.isGecko?this.focusEl.focus():this.focusEl.focus.defer(1,this.focusEl)},ensureVisible:function(n,t,i){var u,f;if((typeof n!="number"&&(n=n.rowIndex),this.ds)&&!(n<0)&&!(n>=this.ds.getCount())){if(t=t!==undefined?t:0,u=this.getRow(n),!(i===!1&&t===0)){while(this.cm.isHidden(t))t++;f=this.getCell(n,t)}if(u){for(var r=this.scroller.dom,e=0,o=u,s=this.el.dom;o&&o!=s;)e+=o.offsetTop,o=o.offsetParent;e-=this.mainHd.dom.offsetHeight;var c=e+u.offsetHeight,l=r.clientHeight,s=parseInt(r.scrollTop,10),y=s+l;if(e<s?r.scrollTop=e:c>y&&(r.scrollTop=c-l),i!==!1){var h=parseInt(f.offsetLeft,10),a=h+f.offsetWidth,v=parseInt(r.scrollLeft,10),p=v+r.clientWidth;h<v?r.scrollLeft=h:a>p&&(r.scrollLeft=a-r.clientWidth)}return f?Ext.fly(f).getXY():[r.scrollLeft,Ext.fly(u).getY()]}}},insertRows:function(n,t,i,r){if(t===0&&i==n.getCount()-1)this.refresh();else{r||this.fireEvent("beforerowsinserted",this,t,i);var u=this.renderRows(t,i),f=this.getRow(t);f?Ext.DomHelper.insertHtml("beforeBegin",f,u):Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,u);r||(this.fireEvent("rowsinserted",this,t,i),this.processRows(t))}},deleteRows:function(n,t,i){n.getRowCount()<1?this.refresh():(this.fireEvent("beforerowsdeleted",this,t,i),this.removeRows(t,i),this.processRows(t),this.fireEvent("rowsdeleted",this,t,i))},getColumnStyle:function(n,t){var i=t?"":this.cm.config[n].css||"",r;return i+="width:"+this.getColumnWidth(n)+";",this.cm.isHidden(n)&&(i+="display:none;"),r=this.cm.config[n].align,r&&(i+="text-align:"+r+";"),i},getColumnWidth:function(n){var t=this.cm.getColumnWidth(n);return typeof t=="number"?(Ext.isBorderBox?t:t-this.borderWidth>0?t-this.borderWidth:0)+"px":t},getTotalWidth:function(){return this.cm.getTotalWidth()+"px"},fitColumns:function(n,t,i){var r=this.cm,u,h=r.getTotalWidth(!1),e=this.grid.getGridEl().getWidth(!0)-this.scrollOffset,a,c,s,p,l;if(!(e<20)){if(a=e-h,a===0)return!1;c=r.getColumnCount(!0);s=c-(typeof i=="number"?1:0);s===0&&(s=1,i=undefined);var w=r.getColumnCount(),o=[],v=0,y=0,f;for(u=0;u<w;u++)r.isHidden(u)||r.isFixed(u)||u===i||(f=r.getColumnWidth(u),o.push(u),v=u,o.push(f),y+=f);for(p=(e-r.getTotalWidth())/y;o.length;)f=o.pop(),u=o.pop(),r.setColumnWidth(u,Math.max(this.grid.minColumnWidth,Math.floor(f+f*p)),!0);return(h=r.getTotalWidth(!1))>e&&(l=s!=c?i:v,r.setColumnWidth(l,Math.max(1,r.getColumnWidth(l)-(h-e)),!0)),n!==!0&&this.updateAllColumnWidths(),!0}},autoExpand:function(n){var t=this.grid,i=this.cm,r,u;if(!this.userResized&&t.autoExpandColumn&&(r=i.getTotalWidth(!1),u=this.grid.getGridEl().getWidth(!0)-this.scrollOffset,r!=u)){var f=i.getIndexById(t.autoExpandColumn),o=i.getColumnWidth(f),e=Math.min(Math.max(u-r+o,t.autoExpandMin),t.autoExpandMax);e!=o&&(i.setColumnWidth(f,e,!0),n!==!0&&this.updateColumnWidth(f,e))}},getColumnData:function(){for(var i,r=[],t=this.cm,u=t.getColumnCount(),n=0;n<u;n++)i=t.getDataIndex(n),r[n]={name:typeof i=="undefined"?this.ds.fields.get(n).name:i,renderer:t.getRenderer(n),id:t.getColumnId(n),style:this.getColumnStyle(n)};return r},renderRows:function(n,t){var r=this.grid,e=r.colModel,i=r.store,o=r.stripeRows,s=e.getColumnCount(),u,f;return i.getCount()<1?"":(u=this.getColumnData(),n=n||0,t=typeof t=="undefined"?i.getCount()-1:t,f=i.getRange(n,t),this.doRender(u,f,i,n,s,o))},renderBody:function(){var n=this.renderRows();return this.templates.body.apply({rows:n})},refreshRow:function(n){var i=this.ds,t,r;typeof n=="number"?(t=n,n=i.getAt(t)):t=i.indexOf(n);r=[];this.insertRows(i,t,t,!0);this.getRow(t).rowIndex=t;this.onRemove(i,n,t+1,!0);this.fireEvent("rowupdated",this,t,n)},refresh:function(n){this.fireEvent("beforerefresh",this);this.grid.stopEditing();var t=this.renderBody();this.mainBody.update(t);n===!0&&(this.updateHeaders(),this.updateHeaderSortState());this.processRows(0,!0);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},applyEmptyText:function(){this.emptyText&&!this.hasRows()&&this.mainBody.update('<div class="x-grid-empty">'+this.emptyText+"<\/div>")},updateHeaderSortState:function(){var n=this.ds.getSortState(),t,i;n&&(this.sortState&&this.sortState.field==n.field&&this.sortState.direction==n.direction||this.grid.fireEvent("sortchange",this.grid,n),this.sortState=n,t=this.cm.findColumnIndex(n.field),t!=-1&&(i=n.direction,this.updateSortIcon(t,i)))},destroy:function(){var n,t,i;if(this.colMenu&&(this.colMenu.removeAll(),Ext.menu.MenuMgr.unregister(this.colMenu),this.colMenu.getEl().remove(),delete this.colMenu),this.hmenu&&(this.hmenu.removeAll(),Ext.menu.MenuMgr.unregister(this.hmenu),this.hmenu.getEl().remove(),delete this.hmenu),this.grid.enableColumnMove&&(n=Ext.dd.DDM.ids["gridHeader"+this.grid.getGridEl().id],n)){for(t in n)!n[t].config.isTarget&&n[t].dragElId?(i=n[t].dragElId,n[t].unreg(),Ext.get(i).remove()):n[t].config.isTarget&&(n[t].proxyTop.remove(),n[t].proxyBottom.remove(),n[t].unreg()),Ext.dd.DDM.locationCache[t]&&delete Ext.dd.DDM.locationCache[t];delete Ext.dd.DDM.ids["gridHeader"+this.grid.getGridEl().id]}Ext.destroy(this.resizeMarker,this.resizeProxy);this.initData(null,null);Ext.EventManager.removeResizeListener(this.onWindowResize,this)},onDenyColumnHide:function(){},render:function(){var n=this.cm,t=n.getColumnCount();if(this.grid.monitorWindowResize===!0)Ext.EventManager.onWindowResize(this.onWindowResize,this,!0);this.autoFill?this.fitColumns(!0,!0):this.forceFit?this.fitColumns(!0,!1):this.grid.autoExpandColumn&&this.autoExpand(!0);this.renderUI()},onWindowResize:function(){this.grid.monitorWindowResize&&!this.grid.autoHeight&&this.layout()},initData:function(n,t){if(this.ds&&(this.ds.un("load",this.onLoad,this),this.ds.un("datachanged",this.onDataChange,this),this.ds.un("add",this.onAdd,this),this.ds.un("remove",this.onRemove,this),this.ds.un("update",this.onUpdate,this),this.ds.un("clear",this.onClear,this)),n){n.on("load",this.onLoad,this);n.on("datachanged",this.onDataChange,this);n.on("add",this.onAdd,this);n.on("remove",this.onRemove,this);n.on("update",this.onUpdate,this);n.on("clear",this.onClear,this)}if(this.ds=n,this.cm&&(this.cm.un("configchange",this.onColConfigChange,this),this.cm.un("widthchange",this.onColWidthChange,this),this.cm.un("headerchange",this.onHeaderChange,this),this.cm.un("hiddenchange",this.onHiddenChange,this),this.cm.un("columnmoved",this.onColumnMove,this),this.cm.un("columnlockchange",this.onColumnLock,this)),t){t.on("configchange",this.onColConfigChange,this);t.on("widthchange",this.onColWidthChange,this);t.on("headerchange",this.onHeaderChange,this);t.on("hiddenchange",this.onHiddenChange,this);t.on("columnmoved",this.onColumnMove,this);t.on("columnlockchange",this.onColumnLock,this)}this.cm=t},onDataChange:function(){this.refresh();this.updateHeaderSortState()},onClear:function(){this.refresh()},onUpdate:function(n,t){this.refreshRow(t)},onAdd:function(n,t,i){this.insertRows(n,i,i+(t.length-1))},onRemove:function(n,t,i,r){r!==!0&&this.fireEvent("beforerowremoved",this,i,t);this.removeRow(i);r!==!0&&(this.processRows(i),this.applyEmptyText(),this.fireEvent("rowremoved",this,i,t))},onLoad:function(){this.scrollToTop()},onColWidthChange:function(n,t,i){this.updateColumnWidth(t,i)},onHeaderChange:function(){this.updateHeaders()},onHiddenChange:function(n,t,i){this.updateColumnHidden(t,i)},onColumnMove:function(n,t,i){this.indexMap=null;var r=this.getScrollState();this.refresh(!0);this.restoreScroll(r);this.afterMove(i)},onColConfigChange:function(){delete this.lastViewWidth;this.indexMap=null;this.refresh(!0)},initUI:function(n){n.on("headerclick",this.onHeaderClick,this);if(n.trackMouseOver){n.on("mouseover",this.onRowOver,this);n.on("mouseout",this.onRowOut,this)}},initEvents:function(){},onHeaderClick:function(n,t){!this.headersDisabled&&this.cm.isSortable(t)&&(n.stopEditing(),n.store.sort(this.cm.getDataIndex(t)))},onRowOver:function(n,t){var i;(i=this.findRowIndex(t))!==!1&&this.addRowClass(i,"x-grid3-row-over")},onRowOut:function(n,t){var i;(i=this.findRowIndex(t))!==!1&&i!==this.findRowIndex(n.getRelatedTarget())&&this.removeRowClass(i,"x-grid3-row-over")},handleWheel:function(n){n.stopPropagation()},onRowSelect:function(n){this.addRowClass(n,"x-grid3-row-selected")},onRowDeselect:function(n){this.removeRowClass(n,"x-grid3-row-selected")},onCellSelect:function(n,t){var i=this.getCell(n,t);i&&this.fly(i).addClass("x-grid3-cell-selected")},onCellDeselect:function(n,t){var i=this.getCell(n,t);i&&this.fly(i).removeClass("x-grid3-cell-selected")},onColumnSplitterMoved:function(n,t){this.userResized=!0;var i=this.grid.colModel;i.setColumnWidth(n,t,!0);this.forceFit?(this.fitColumns(!0,!1,n),this.updateAllColumnWidths()):this.updateColumnWidth(n,t);this.grid.fireEvent("columnresize",n,t)},handleHdMenuClick:function(n){var t=this.hdCtxIndex,i=this.cm,r=this.ds;switch(n.id){case"asc":r.sort(i.getDataIndex(t),"ASC");break;case"desc":r.sort(i.getDataIndex(t),"DESC");break;default:if(t=i.getIndexById(n.id.substr(4)),t!=-1){if(n.checked&&i.getColumnsBy(this.isHideableColumn,this).length<=1)return this.onDenyColumnHide(),!1;i.setHidden(t,n.checked)}}return!0},isHideableColumn:function(n){return!n.hidden&&!n.fixed},beforeColMenuShow:function(){var t=this.cm,i=t.getColumnCount(),n;for(this.colMenu.removeAll(),n=0;n<i;n++)t.config[n].fixed!==!0&&t.config[n].hideable!==!1&&this.colMenu.add(new Ext.menu.CheckItem({id:"col-"+t.getColumnId(n),text:t.getColumnHeader(n),checked:!t.isHidden(n),hideOnClick:!1,disabled:t.config[n].hideable===!1}))},handleHdDown:function(n,t){var i,r,u,f;if(Ext.fly(t).hasClass("x-grid3-hd-btn")){n.stopEvent();i=this.findHeaderCell(t);Ext.fly(i).addClass("x-grid3-hd-menu-open");r=this.getCellIndex(i);this.hdCtxIndex=r;u=this.hmenu.items;f=this.cm;u.get("asc").setDisabled(!f.isSortable(r));u.get("desc").setDisabled(!f.isSortable(r));this.hmenu.on("hide",function(){Ext.fly(i).removeClass("x-grid3-hd-menu-open")},this,{single:!0});this.hmenu.show(t,"tl-bl?")}},handleHdOver:function(n,t){var i=this.findHeaderCell(t),r;i&&!this.headersDisabled&&(this.activeHd=i,this.activeHdIndex=this.getCellIndex(i),r=this.fly(i),this.activeHdRegion=r.getRegion(),this.cm.isSortable(this.activeHdIndex)&&!this.cm.isFixed(this.activeHdIndex)&&(r.addClass("x-grid3-hd-over"),this.activeHdBtn=r.child(".x-grid3-hd-btn"),this.activeHdBtn&&(this.activeHdBtn.dom.style.height=i.firstChild.offsetHeight-1+"px")))},handleHdMove:function(n){if(this.activeHd&&!this.headersDisabled){var t=this.splitHandleWidth||5,i=this.activeHdRegion,r=n.getPageX(),u=this.activeHd.style;u.cursor=r-i.left<=t&&this.cm.isResizable(this.activeHdIndex-1)?Ext.isSafari?"e-resize":"col-resize":i.right-r<=(this.activeHdBtn?2:t)&&this.cm.isResizable(this.activeHdIndex)?Ext.isSafari?"w-resize":"col-resize":""}},handleHdOut:function(n,t){var i=this.findHeaderCell(t);!i||Ext.isIE&&n.within(i,!0)||(this.activeHd=null,this.fly(i).removeClass("x-grid3-hd-over"),i.style.cursor="")},hasRows:function(){var n=this.mainBody.dom.firstChild;return n&&n.className!="x-grid-empty"},bind:function(n,t){this.initData(n,t)}});Ext.grid.GridView.SplitDragZone=function(n,t){this.grid=n;this.view=n.getView();this.marker=this.view.resizeMarker;this.proxy=this.view.resizeProxy;Ext.grid.GridView.SplitDragZone.superclass.constructor.call(this,t,"gridSplitters"+this.grid.getGridEl().id,{dragElId:Ext.id(this.proxy.dom),resizeFrame:!1});this.scroll=!1;this.hw=this.view.splitHandleWidth||5};Ext.extend(Ext.grid.GridView.SplitDragZone,Ext.dd.DDProxy,{b4StartDrag:function(n,t){var i,u,r;this.view.headersDisabled=!0;i=this.view.mainWrap.getHeight();this.marker.setHeight(i);this.marker.show();this.marker.alignTo(this.view.getHeaderCell(this.cellIndex),"tl-tl",[-2,0]);this.proxy.setHeight(i);u=this.cm.getColumnWidth(this.cellIndex);r=Math.max(u-this.grid.minColumnWidth,0);this.resetConstraints();this.setXConstraint(r,1e3);this.setYConstraint(0,0);this.minX=n-r;this.maxX=n+1e3;this.startPos=n;Ext.dd.DDProxy.prototype.b4StartDrag.call(this,n,t)},handleMouseDown:function(n){var i=this.view.findHeaderCell(n.getTarget()),r;if(i){var u=this.view.fly(i).getXY(),f=u[0],h=u[1],e=n.getXY(),o=e[0],c=e[1],s=i.offsetWidth,t=!1;if(o-f<=this.hw?t=-1:f+s-o<=this.hw&&(t=0),t!==!1){if(this.cm=this.grid.colModel,r=this.view.getCellIndex(i),t==-1){if(r+t<0)return;while(this.cm.isHidden(r+t))if(--t,r+t<0)return}this.cellIndex=r+t;this.split=i.dom;this.cm.isResizable(this.cellIndex)&&!this.cm.isFixed(this.cellIndex)&&Ext.grid.GridView.SplitDragZone.superclass.handleMouseDown.apply(this,arguments)}else this.view.columnDrag&&this.view.columnDrag.callHandleMouseDown(n)}},endDrag:function(n){this.marker.hide();var t=this.view,i=Math.max(this.minX,n.getPageX()),r=i-this.startPos;t.onColumnSplitterMoved(this.cellIndex,this.cm.getColumnWidth(this.cellIndex)+r);setTimeout(function(){t.headersDisabled=!1},50)},autoOffset:function(){this.setDelta(0,0)}})
Ext.grid.CellSelectionModel=function(n){Ext.apply(this,n);this.selection=null;this.addEvents("beforecellselect","cellselect","selectionchange");Ext.grid.CellSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.grid.CellSelectionModel,Ext.grid.AbstractSelectionModel,{initEvents:function(){this.grid.on("cellmousedown",this.handleMouseDown,this);this.grid.getGridEl().on(Ext.isIE?"keydown":"keypress",this.handleKeyDown,this);var n=this.grid.view;n.on("refresh",this.onViewChange,this);n.on("rowupdated",this.onRowUpdated,this);n.on("beforerowremoved",this.clearSelections,this);n.on("beforerowsinserted",this.clearSelections,this);if(this.grid.isEditor)this.grid.on("beforeedit",this.beforeEdit,this)},beforeEdit:function(n){this.select(n.row,n.column,!1,!0,n.record)},onRowUpdated:function(n,t,i){if(this.selection&&this.selection.record==i)n.onCellSelect(t,this.selection.cell[1])},onViewChange:function(){this.clearSelections(!0)},getSelectedCell:function(){return this.selection?this.selection.cell:null},clearSelections:function(n){var t=this.selection;if(t){if(n!==!0)this.grid.view.onCellDeselect(t.cell[0],t.cell[1]);this.selection=null;this.fireEvent("selectionchange",this,null)}},hasSelection:function(){return this.selection?!0:!1},handleMouseDown:function(n,t,i,r){r.button!==0||this.isLocked()||this.select(t,i)},select:function(n,t,i,r,u){if(this.fireEvent("beforecellselect",this,n,t)!==!1){if(this.clearSelections(),u=u||this.grid.store.getAt(n),this.selection={record:u,cell:[n,t]},!i){var f=this.grid.getView();f.onCellSelect(n,t);r!==!0&&f.focusCell(n,t)}this.fireEvent("cellselect",this,n,t);this.fireEvent("selectionchange",this,this.selection)}},isSelectable:function(n,t,i){return!i.isHidden(t)},handleKeyDown:function(n){var u,e,o;if(n.isNavKeyPress()){if(u=this.grid,e=this.selection,!e){n.stopEvent();o=u.walkCells(0,0,1,this.isSelectable,this);o&&this.select(o[0],o[1]);return}var s=this,f=function(n,t,i){return u.walkCells(n,t,i,s.isSelectable,s)},h=n.getKey(),i=e.cell[0],r=e.cell[1],t;switch(h){case n.TAB:t=n.shiftKey?f(i,r-1,-1):f(i,r+1,1);break;case n.DOWN:t=f(i+1,r,1);break;case n.UP:t=f(i-1,r,-1);break;case n.RIGHT:t=f(i,r+1,1);break;case n.LEFT:t=f(i,r-1,-1);break;case n.ENTER:if(u.isEditor&&!u.editing){u.startEditing(i,r);n.stopEvent();return}}t&&(this.select(t[0],t[1]),n.stopEvent())}},acceptsNav:function(n,t,i){return!i.isHidden(t)&&i.isCellEditable(t,n)},onEditorKey:function(n,t){var f=t.getKey(),r,u=this.grid,i=u.activeEditor;f==t.TAB?(r=t.shiftKey?u.walkCells(i.row,i.col-1,-1,this.acceptsNav,this):u.walkCells(i.row,i.col+1,1,this.acceptsNav,this),t.stopEvent()):f==t.ENTER?(i.completeEdit(),t.stopEvent()):f==t.ESC&&(t.stopEvent(),i.cancelEdit());r&&u.startEditing(r[0],r[1])}})
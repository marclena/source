Ext.menu.Menu=function(n){n instanceof Array&&(n={items:n});Ext.apply(this,n);this.id=this.id||Ext.id();this.addEvents("beforeshow","beforehide","show","hide","click","mouseover","mouseout","itemclick");Ext.menu.MenuMgr.register(this);Ext.menu.Menu.superclass.constructor.call(this);var t=this.items;this.items=new Ext.util.MixedCollection;t&&this.add.apply(this,t)};Ext.extend(Ext.menu.Menu,Ext.util.Observable,{minWidth:120,shadow:"sides",subMenuAlign:"tl-tr?",defaultAlign:"tl-bl?",allowOtherMenus:!1,hidden:!0,createEl:function(){return new Ext.Layer({cls:"x-menu",shadow:this.shadow,constrain:!1,parentEl:this.parentEl||document.body,zindex:15e3})},render:function(){var t,n;if(!this.el){t=this.el=this.createEl();this.keyNav=new Ext.menu.MenuNav(this);this.plain&&t.addClass("x-menu-plain");this.cls&&t.addClass(this.cls);this.focusEl=t.createChild({tag:"a",cls:"x-menu-focus",href:"#",onclick:"return false;",tabIndex:"-1"});n=t.createChild({tag:"ul",cls:"x-menu-list"});n.on("click",this.onClick,this);n.on("mouseover",this.onMouseOver,this);n.on("mouseout",this.onMouseOut,this);this.items.each(function(t){var i=document.createElement("li");i.className="x-menu-list-item";n.dom.appendChild(i);t.render(i,this)},this);this.ul=n;this.autoWidth()}},autoWidth:function(){var n=this.el,i=this.ul,t,r;n&&(t=this.width,t?n.setWidth(t):Ext.isIE&&(n.setWidth(this.minWidth),r=n.dom.offsetWidth,n.setWidth(i.getWidth()+n.getFrameWidth("lr"))))},delayAutoWidth:function(){this.el&&(this.awTask||(this.awTask=new Ext.util.DelayedTask(this.autoWidth,this)),this.awTask.delay(20))},findTargetItem:function(n){var t=n.getTarget(".x-menu-list-item",this.ul,!0);if(t&&t.menuItemId)return this.items.get(t.menuItemId)},onClick:function(n){var t;if(t=this.findTargetItem(n)){t.onClick(n);this.fireEvent("click",this,t,n)}},setActiveItem:function(n,t){n!=this.activeItem?(this.activeItem&&this.activeItem.deactivate(),this.activeItem=n,n.activate(t)):t&&n.expandMenu()},tryActivate:function(n,t){for(var i,u=this.items,r=n,f=u.length;r>=0&&r<f;r+=t)if(i=u.get(r),!i.disabled&&i.canActivate)return this.setActiveItem(i,!1),i;return!1},onMouseOver:function(n){var t;(t=this.findTargetItem(n))&&t.canActivate&&!t.disabled&&this.setActiveItem(t,!0);this.fireEvent("mouseover",this,n,t)},onMouseOut:function(n){var t;(t=this.findTargetItem(n))&&t==this.activeItem&&t.shouldDeactivate(n)&&(this.activeItem.deactivate(),delete this.activeItem);this.fireEvent("mouseout",this,n,t)},isVisible:function(){return this.el&&!this.hidden},show:function(n,t,i){this.parentMenu=i;this.el||this.render();this.fireEvent("beforeshow",this);this.showAt(this.el.getAlignToXY(n,t||this.defaultAlign),i,!1)},showAt:function(n,t,i){this.parentMenu=t;this.el||this.render();i!==!1&&(this.fireEvent("beforeshow",this),n=this.el.adjustForConstraints(n));this.el.setXY(n);this.el.show();this.hidden=!1;this.focus();this.fireEvent("show",this)},focus:function(){this.hidden||this.doFocus.defer(50,this)},doFocus:function(){this.hidden||this.focusEl.focus()},hide:function(n){this.el&&this.isVisible()&&(this.fireEvent("beforehide",this),this.activeItem&&(this.activeItem.deactivate(),this.activeItem=null),this.el.hide(),this.hidden=!0,this.fireEvent("hide",this));n===!0&&this.parentMenu&&this.parentMenu.hide(!0)},add:function(){for(var n,r=arguments,u=r.length,t,i=0;i<u;i++)n=r[i],n.render?t=this.addItem(n):typeof n=="string"?t=n=="separator"||n=="-"?this.addSeparator():this.addText(n):n.tagName||n.el?t=this.addElement(n):typeof n=="object"&&(Ext.applyIf(n,this.defaults),t=this.addMenuItem(n));return t},getEl:function(){return this.el||this.render(),this.el},addSeparator:function(){return this.addItem(new Ext.menu.Separator)},addElement:function(n){return this.addItem(new Ext.menu.BaseItem(n))},addItem:function(n){if(this.items.add(n),this.ul){var t=document.createElement("li");t.className="x-menu-list-item";this.ul.dom.appendChild(t);n.render(t,this);this.delayAutoWidth()}return n},addMenuItem:function(n){return n instanceof Ext.menu.Item||(n=typeof n.checked=="boolean"?new Ext.menu.CheckItem(n):new Ext.menu.Item(n)),this.addItem(n)},addText:function(n){return this.addItem(new Ext.menu.TextItem(n))},insert:function(n,t){if(this.items.insert(n,t),this.ul){var i=document.createElement("li");i.className="x-menu-list-item";this.ul.dom.insertBefore(i,this.ul.dom.childNodes[n]);t.render(i,this);this.delayAutoWidth()}return t},remove:function(n){this.items.removeKey(n.id);n.destroy()},removeAll:function(){for(var n;n=this.items.first();)this.remove(n)},destroy:function(){this.beforeDestroy();Ext.menu.MenuMgr.unregister(this);this.keyNav&&this.keyNav.disable();this.removeAll();this.ul&&this.ul.removeAllListeners();this.el&&this.el.destroy()},beforeDestroy:Ext.emptyFn});Ext.menu.MenuNav=function(n){Ext.menu.MenuNav.superclass.constructor.call(this,n.el);this.scope=this.menu=n};Ext.extend(Ext.menu.MenuNav,Ext.KeyNav,{doRelay:function(n,t){var i=n.getKey();return!this.menu.activeItem&&n.isNavKeyPress()&&i!=n.SPACE&&i!=n.RETURN?(this.menu.tryActivate(0,1),!1):t.call(this.scope||this,n,this.menu)},up:function(n,t){t.tryActivate(t.items.indexOf(t.activeItem)-1,-1)||t.tryActivate(t.items.length-1,-1)},down:function(n,t){t.tryActivate(t.items.indexOf(t.activeItem)+1,1)||t.tryActivate(0,1)},right:function(n,t){t.activeItem&&t.activeItem.expandMenu(!0)},left:function(n,t){t.hide();t.parentMenu&&t.parentMenu.activeItem&&t.parentMenu.activeItem.activate()},enter:function(n,t){if(t.activeItem){n.stopPropagation();t.activeItem.onClick(n);return t.fireEvent("click",this,t.activeItem),!0}}})
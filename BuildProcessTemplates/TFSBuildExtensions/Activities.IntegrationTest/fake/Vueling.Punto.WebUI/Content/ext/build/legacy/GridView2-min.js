Ext.grid.GridView=function(n){Ext.grid.GridView.superclass.constructor.call(this);this.el=null;Ext.apply(this,n)};Ext.extend(Ext.grid.GridView,Ext.grid.AbstractGridView,{rowClass:"x-grid-row",cellClass:"x-grid-col",tdClass:"x-grid-td",hdClass:"x-grid-hd",splitClass:"x-grid-split",sortClasses:["sort-asc","sort-desc"],enableMoveAnim:!1,hlColor:"C3DAF9",dh:Ext.DomHelper,fly:Ext.Element.fly,css:Ext.util.CSS,borderWidth:1,splitOffset:3,scrollIncrement:22,cellRE:/(?:.*?)x-grid-(?:hd|cell|csplit)-(?:[\d]+)-([\d]+)(?:.*?)/,findRE:/\s?(?:x-grid-hd|x-grid-col|x-grid-csplit)\s/,getEditorParent:function(n){return n.parentEl||document.body},bind:function(n,t){if(this.ds&&(this.ds.un("load",this.onLoad,this),this.ds.un("datachanged",this.onDataChange),this.ds.un("add",this.onAdd),this.ds.un("remove",this.onRemove),this.ds.un("update",this.onUpdate),this.ds.un("clear",this.onClear)),n){n.on("load",this.onLoad,this);n.on("datachanged",this.onDataChange,this);n.on("add",this.onAdd,this);n.on("remove",this.onRemove,this);n.on("update",this.onUpdate,this);n.on("clear",this.onClear,this)}if(this.ds=n,this.cm&&(this.cm.un("widthchange",this.onColWidthChange,this),this.cm.un("headerchange",this.onHeaderChange,this),this.cm.un("hiddenchange",this.onHiddenChange,this),this.cm.un("columnmoved",this.onColumnMove,this),this.cm.un("columnlockchange",this.onColumnLock,this)),t){this.generateRules(t);t.on("widthchange",this.onColWidthChange,this);t.on("headerchange",this.onHeaderChange,this);t.on("hiddenchange",this.onHiddenChange,this);t.on("columnmoved",this.onColumnMove,this);t.on("columnlockchange",this.onColumnLock,this)}this.cm=t},init:function(n){Ext.grid.GridView.superclass.init.call(this,n);this.bind(n.dataSource,n.colModel);n.on("headerclick",this.handleHeaderClick,this);if(n.trackMouseOver){n.on("mouseover",this.onRowOver,this);n.on("mouseout",this.onRowOut,this)}n.cancelTextSelection=function(){};this.gridId=n.id;var t=this.templates||{};t.master||(t.master=new Ext.Template('<div class="x-grid" hidefocus="true">','<div class="x-grid-topbar"><\/div>','<div class="x-grid-scroller"><div><\/div><\/div>','<div class="x-grid-locked">','<div class="x-grid-header">{lockedHeader}<\/div>','<div class="x-grid-body">{lockedBody}<\/div>',"<\/div>",'<div class="x-grid-viewport">','<div class="x-grid-header">{header}<\/div>','<div class="x-grid-body">{body}<\/div>',"<\/div>",'<div class="x-grid-bottombar"><\/div>','<a href="#" class="x-grid-focus" tabIndex="-1"><\/a>','<div class="x-grid-resize-proxy">&#160;<\/div>',"<\/div>"),t.master.disableformats=!0);t.header||(t.header=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0">','<tbody><tr class="x-grid-hd-row">{cells}<\/tr><\/tbody>',"<\/table>{splits}"),t.header.disableformats=!0);t.header.compile();t.hcell||(t.hcell=new Ext.Template('<td class="x-grid-hd x-grid-td-{id} {cellId}"><div title="{title}" class="x-grid-hd-inner x-grid-hd-{id}">','<div class="x-grid-hd-text" unselectable="on">{value}<img class="x-grid-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" /><\/div>',"<\/div><\/td>"),t.hcell.disableFormats=!0);t.hcell.compile();t.hsplit||(t.hsplit=new Ext.Template('<div class="x-grid-split {splitId} x-grid-split-{id}" style="{style}" unselectable="on">&#160;<\/div>'),t.hsplit.disableFormats=!0);t.hsplit.compile();t.body||(t.body=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0">',"<tbody>{rows}<\/tbody>","<\/table>"),t.body.disableFormats=!0);t.body.compile();t.row||(t.row=new Ext.Template('<tr class="x-grid-row {alt}">{cells}<\/tr>'),t.row.disableFormats=!0);t.row.compile();t.cell||(t.cell=new Ext.Template('<td class="x-grid-col x-grid-td-{id} {cellId} {css}" tabIndex="0">','<div class="x-grid-col-{id} x-grid-cell-inner"><div class="x-grid-cell-text" unselectable="on" {attr}>{value}<\/div><\/div>',"<\/td>"),t.cell.disableFormats=!0);t.cell.compile();this.templates=t},onColWidthChange:function(){this.updateColumns.apply(this,arguments)},onHeaderChange:function(){this.updateHeaders.apply(this,arguments)},onHiddenChange:function(){this.handleHiddenChange.apply(this,arguments)},onColumnMove:function(){this.handleColumnMove.apply(this,arguments)},onColumnLock:function(){this.handleLockChange.apply(this,arguments)},onDataChange:function(){this.refresh();this.updateHeaderSortState()},onClear:function(){this.refresh()},onUpdate:function(n,t){this.refreshRow(t)},refreshRow:function(n){var i=this.ds,t;typeof n=="number"?(t=n,n=i.getAt(t)):t=i.indexOf(n);this.insertRows(i,t,t,!0);this.onRemove(i,n,t+1,!0);this.syncRowHeights(t,t);this.layout();this.fireEvent("rowupdated",this,t,n)},onAdd:function(n,t,i){this.insertRows(n,i,i+(t.length-1))},onRemove:function(n,t,i,r){r!==!0&&this.fireEvent("beforerowremoved",this,i,t);var u=this.getBodyTable(),f=this.getLockedTable();u.rows[i]&&u.firstChild.removeChild(u.rows[i]);f.rows[i]&&f.firstChild.removeChild(f.rows[i]);r!==!0&&(this.stripeRows(i),this.syncRowHeights(i,i),this.layout(),this.fireEvent("rowremoved",this,i,t))},onLoad:function(){this.scrollToTop()},scrollToTop:function(){this.scroller&&(this.scroller.dom.scrollTop=0,this.syncScroll())},getHeaderPanel:function(n){return n&&this.headerPanel.show(),this.headerPanel},getFooterPanel:function(n){return n&&this.footerPanel.show(),this.footerPanel},initElements:function(){var n=Ext.Element,i=this.grid.getGridEl().dom.firstChild,t=i.childNodes;this.el=new n(i);this.headerPanel=new n(i.firstChild);this.headerPanel.enableDisplayMode("block");this.scroller=new n(t[1]);this.scrollSizer=new n(this.scroller.dom.firstChild);this.lockedWrap=new n(t[2]);this.lockedHd=new n(this.lockedWrap.dom.firstChild);this.lockedBody=new n(this.lockedWrap.dom.childNodes[1]);this.mainWrap=new n(t[3]);this.mainHd=new n(this.mainWrap.dom.firstChild);this.mainBody=new n(this.mainWrap.dom.childNodes[1]);this.footerPanel=new n(t[4]);this.footerPanel.enableDisplayMode("block");this.focusEl=new n(t[5]);this.focusEl.swallowEvent("click",!0);this.resizeProxy=new n(t[6]);this.headerSelector=String.format("#{0} td.x-grid-hd, #{1} td.x-grid-hd",this.lockedHd.id,this.mainHd.id);this.splitterSelector=String.format("#{0} div.x-grid-split, #{1} div.x-grid-split",this.lockedHd.id,this.mainHd.id)},getHeaderCell:function(n){return Ext.DomQuery.select(this.headerSelector)[n]},getHeaderCellMeasure:function(n){return this.getHeaderCell(n).firstChild},getHeaderCellText:function(n){return this.getHeaderCell(n).firstChild.firstChild},getLockedTable:function(){return this.lockedBody.dom.firstChild},getBodyTable:function(){return this.mainBody.dom.firstChild},getLockedRow:function(n){return this.getLockedTable().rows[n]},getRow:function(n){return this.getBodyTable().rows[n]},getRowComposite:function(n){this.rowEl||(this.rowEl=new Ext.CompositeElementLite);var t=[],i,r;return(i=this.getLockedRow(n))&&t.push(i),(r=this.getRow(n))&&t.push(r),this.rowEl.elements=t,this.rowEl},getCell:function(n,t){var r=this.cm.getLockedCount(),i;return t<r?i=this.lockedBody.dom.firstChild:(i=this.mainBody.dom.firstChild,t-=r),i.rows[n].childNodes[t]},getCellText:function(n,t){return this.getCell(n,t).firstChild.firstChild},getCellBox:function(n){var t=this.fly(n).getBox();return Ext.isOpera&&(t.y=n.offsetTop+this.mainBody.getY()),t},getCellIndex:function(n){var t=String(n.className).match(this.cellRE);return t?parseInt(t[1],10):0},findHeaderIndex:function(n){var t=Ext.fly(n).findParent("td."+this.hdClass,6);return t?this.getCellIndex(t):!1},findHeaderCell:function(n){var t=Ext.fly(n).findParent("td."+this.hdClass,6);return t?t:!1},findRowIndex:function(n){if(!n)return!1;var t=Ext.fly(n).findParent("tr."+this.rowClass,6);return t?t.rowIndex:!1},findCellIndex:function(n){for(var t=this.el.dom;n&&n!=t;){if(this.findRE.test(n.className))return this.getCellIndex(n);n=n.parentNode}return!1},getColumnId:function(n){return this.cm.getColumnId(n)},getSplitters:function(){return this.splitterSelector?Ext.DomQuery.select(this.splitterSelector):null},getSplitter:function(n){return this.getSplitters()[n]},onRowOver:function(n,t){var i;(i=this.findRowIndex(t))!==!1&&this.getRowComposite(i).addClass("x-grid-row-over")},onRowOut:function(n,t){var i;(i=this.findRowIndex(t))!==!1&&i!==this.findRowIndex(n.getRelatedTarget())&&this.getRowComposite(i).removeClass("x-grid-row-over")},renderHeaders:function(){for(var i=this.cm,o=this.templates.hcell,s=this.templates.header,h=this.templates.hsplit,r=[],u=[],f=[],e=[],n={},t=0,c=i.getColumnCount();t<c;t++)n.cellId="x-grid-hd-0-"+t,n.splitId="x-grid-csplit-0-"+t,n.id=i.getColumnId(t),n.title=i.getColumnTooltip(t)||"",n.value=i.getColumnHeader(t)||"",n.style=this.grid.enableColumnResize===!1||!i.isResizable(t)||i.isFixed(t)?"cursor:default":"",i.isLocked(t)?(u[u.length]=o.apply(n),e[e.length]=h.apply(n)):(r[r.length]=o.apply(n),f[f.length]=h.apply(n));return[s.apply({cells:u.join(""),splits:e.join("")}),s.apply({cells:r.join(""),splits:f.join("")})]},updateHeaders:function(){var n=this.renderHeaders();this.lockedHd.update(n[0]);this.mainHd.update(n[1])},focusRow:function(n){var t=this.scroller.dom.scrollLeft;this.focusCell(n,0,!1);this.scroller.dom.scrollLeft=t},focusCell:function(n,t,i){var r=this.ensureVisible(n,t,i);this.focusEl.alignTo(r,"tl-tl");Ext.isGecko?this.focusEl.focus():this.focusEl.focus.defer(1,this.focusEl)},ensureVisible:function(n,t,i){var o,u;if(typeof n!="number"&&(n=n.rowIndex),!(n<0)||!(n>=this.ds.getCount())){for(t=t!==undefined?t:0,o=this.grid.colModel;o.isHidden(t);)t++;if(u=this.getCell(n,t),u){var r=this.scroller.dom,f=parseInt(u.offsetTop,10),e=parseInt(u.offsetLeft,10),s=f+u.offsetHeight,h=e+u.offsetWidth,c=r.clientHeight-this.mainHd.dom.offsetHeight,l=parseInt(r.scrollTop,10),a=parseInt(r.scrollLeft,10),v=l+c,y=a+r.clientWidth;return f<l?r.scrollTop=f:s>v&&(r.scrollTop=s-c),i!==!1&&(e<a?r.scrollLeft=e:h>y&&(r.scrollLeft=h-r.clientWidth)),u}}},updateColumns:function(){var n,u,t;this.grid.stopEditing();var i=this.grid.colModel,r=this.getColumnIds();for(n=0,u=i.getColumnCount();n<u;n++)t=i.getColumnWidth(n),this.css.updateRule(this.colSelector+r[n],"width",t-this.borderWidth+"px"),this.css.updateRule(this.hdSelector+r[n],"width",t-this.borderWidth+"px");this.updateSplitters()},generateRules:function(n){for(var i,r,u,f,e=[],t=0,o=n.getColumnCount();t<o;t++)i=n.getColumnId(t),r="",n.config[t].align&&(r="text-align:"+n.config[t].align+";"),u="",n.isHidden(t)&&(u="display:none;"),f="width:"+(n.getColumnWidth(t)-this.borderWidth)+"px;",e.push(this.colSelector,i," {\n",n.config[t].css,r,f,"\n}\n",this.hdSelector,i," {\n",r,f,"}\n",this.tdSelector,i," {\n",u,"\n}\n",this.splitSelector,i," {\n",u,"\n}\n");return Ext.util.CSS.createStyleSheet(e.join(""))},updateSplitters:function(){var t=this.cm,u=this.getSplitters(),i,r,n,f,e;if(u)for(i=0,r=!0,n=0,f=t.getColumnCount();n<f;n++)t.isHidden(n)||(e=t.getColumnWidth(n),!t.isLocked(n)&&r&&(i=0,r=!1),i+=e,u[n].style.left=i-this.splitOffset+"px")},handleHiddenChange:function(n,t,i){i?this.hideColumn(t):this.unhideColumn(t)},hideColumn:function(n){var t=this.getColumnId(n);this.css.updateRule(this.tdSelector+t,"display","none");this.css.updateRule(this.splitSelector+t,"display","none");Ext.isSafari&&this.updateHeaders();this.updateSplitters();this.layout()},unhideColumn:function(n){var t=this.getColumnId(n);this.css.updateRule(this.tdSelector+t,"display","");this.css.updateRule(this.splitSelector+t,"display","");Ext.isSafari&&this.updateHeaders();this.updateSplitters();this.layout()},insertRows:function(n,t,i,r){if(t==0&&i==n.getCount()-1)this.refresh();else{r||this.fireEvent("beforerowsinserted",this,t,i);var f=this.getScrollState(),u=this.renderRows(t,i);this.bufferRows(u[0],this.getLockedTable(),t);this.bufferRows(u[1],this.getBodyTable(),t);this.restoreScroll(f);r||(this.fireEvent("rowsinserted",this,t,i),this.syncRowHeights(t,i),this.stripeRows(t),this.layout())}},bufferRows:function(n,t,i){var f=null,o=t.rows,s=t.tBodies[0],r,u,e,h;for(i<o.length&&(f=o[i]),r=document.createElement("div"),r.innerHTML="<table><tbody>"+n+"<\/tbody><\/table>",u=r.firstChild.rows,e=0,h=u.length;e<h;e++)f?s.insertBefore(u[0],f):s.appendChild(u[0]);r.innerHTML="";r=null},deleteRows:function(n,t,i){var r;if(n.getRowCount()<1)this.fireEvent("beforerefresh",this),this.mainBody.update(""),this.lockedBody.update(""),this.fireEvent("refresh",this);else{this.fireEvent("beforerowsdeleted",this,t,i);var u=this.getBodyTable(),f=u.firstChild,e=u.rows;for(r=t;r<=i;r++)f.removeChild(e[t]);this.stripeRows(t);this.fireEvent("rowsdeleted",this,t,i)}},updateRows:function(){var n=this.getScrollState();this.refresh();this.restoreScroll(n)},handleSort:function(n,t,i,r){r||this.refresh();this.updateHeaderSortState()},getScrollState:function(){var n=this.scroller.dom;return{left:n.scrollLeft,top:n.scrollTop}},stripeRows:function(n){var t,u;if(this.grid.stripeRows&&!(this.ds.getCount()<1)){n=n||0;var r=this.getBodyTable().rows,o=this.getLockedTable().rows;for(t=n,u=r.length;t<u;t++){var i=r[t],f=o[t],e=(t+1)%2==0,s=(" "+i.className+" ").indexOf(" x-grid-row-alt ")!=-1;e!=s&&(e?i.className+=" x-grid-row-alt":i.className=i.className.replace("x-grid-row-alt",""),f&&(f.className=i.className))}}},restoreScroll:function(n){var t=this.scroller.dom;t.scrollLeft=n.left;t.scrollTop=n.top;this.syncScroll()},syncScroll:function(){var n=this.scroller.dom,i=this.mainHd.dom,t=this.mainBody.dom,r=this.lockedBody.dom;i.scrollLeft=t.scrollLeft=n.scrollLeft;r.scrollTop=t.scrollTop=n.scrollTop},handleScroll:function(n){this.syncScroll();var t=this.scroller.dom;this.grid.fireEvent("bodyscroll",t.scrollLeft,t.scrollTop);n.stopEvent()},handleWheel:function(n){var t=n.getWheelDelta();this.scroller.dom.scrollTop-=t*22;this.lockedBody.dom.scrollTop=this.mainBody.dom.scrollTop=this.scroller.dom.scrollTop;n.stopEvent()},renderRows:function(n,t){var f=this.grid,r=f.colModel,u=f.dataSource,c=f.stripeRows,s=r.getColumnCount(),e,i,o,h;if(u.getCount()<1)return["",""];for(e=[],i=0;i<s;i++)o=r.getDataIndex(i),e[i]={name:typeof o=="undefined"?u.fields.get(i).name:o,renderer:r.getRenderer(i),id:r.getColumnId(i),locked:r.isLocked(i)};return n=n||0,t=typeof t=="undefined"?u.getCount()-1:t,h=u.getRange(n,t),this.doRender(e,h,u,n,s,c)},doRender:Ext.isGecko?function(n,t,i,r,u,f){for(var h,w,a,b=this.templates,nt=b.cell,k=b.row,d="",g="",y,p,s,e={},c={},o,l,v=0,tt=t.length;v<tt;v++){for(o=t[v],y="",p="",l=v+r,h=0;h<u;h++)s=n[h],e.cellId="x-grid-cell-"+l+"-"+h,e.id=s.id,e.css=e.attr="",e.value=s.renderer(o.data[s.name],e,o,l,h,i),(e.value==undefined||e.value==="")&&(e.value="&#160;"),o.dirty&&typeof o.modified[s.name]!="undefined"&&(e.css+=e.css?" x-grid-dirty-cell":"x-grid-dirty-cell"),w=nt.apply(e),s.locked?p+=w:y+=w;a=[];f&&(l+1)%2==0&&(a[0]="x-grid-row-alt");o.dirty&&(a[1]=" x-grid-dirty-row");c.cells=p;this.getRowClass&&(a[2]=this.getRowClass(o,l));c.alt=a.join(" ");g+=k.apply(c);c.cells=y;d+=k.apply(c)}return[g,d]}:function(n,t,i,r,u,f){for(var c,k,v,d=this.templates,nt=d.cell,g=d.row,w=[],b=[],y,l,s,e={},h={},o,a,p=0,tt=t.length;p<tt;p++){for(o=t[p],y=[],l=[],a=p+r,c=0;c<u;c++)s=n[c],e.cellId="x-grid-cell-"+a+"-"+c,e.id=s.id,e.css=e.attr="",e.value=s.renderer(o.data[s.name],e,o,a,c,i),(e.value==undefined||e.value==="")&&(e.value="&#160;"),o.dirty&&typeof o.modified[s.name]!="undefined"&&(e.css+=e.css?" x-grid-dirty-cell":"x-grid-dirty-cell"),k=nt.apply(e),s.locked?l[l.length]=k:y[y.length]=k;v=[];f&&(a+1)%2==0&&(v[0]="x-grid-row-alt");o.dirty&&(v[1]=" x-grid-dirty-row");h.cells=l;this.getRowClass&&(v[2]=this.getRowClass(o,a));h.alt=v.join(" ");h.cells=l.join("");b[b.length]=g.apply(h);h.cells=y.join("");w[w.length]=g.apply(h)}return[b.join(""),w.join("")]},renderBody:function(){var n=this.renderRows(),t=this.templates.body;return[t.apply({rows:n[0]}),t.apply({rows:n[1]})]},refresh:function(n){this.fireEvent("beforerefresh",this);this.grid.stopEditing();var t=this.renderBody();this.lockedBody.update(t[0]);this.mainBody.update(t[1]);n===!0&&(this.updateHeaders(),this.updateColumns(),this.updateSplitters(),this.updateHeaderSortState());this.syncRowHeights();this.layout();this.fireEvent("refresh",this)},handleColumnMove:function(n,t,i){this.indexMap=null;var r=this.getScrollState();this.refresh(!0);this.restoreScroll(r);this.afterMove(i)},afterMove:function(n){this.enableMoveAnim&&Ext.enableFx&&this.fly(this.getHeaderCell(n).firstChild).highlight(this.hlColor)},updateCell:function(n,t,i){var r=this.getColumnIndexByDataIndex(i);if(typeof r!="undefined"){var f=this.grid.colModel,o=this.getCell(t,r),s=this.getCellText(t,r),e={cellId:"x-grid-cell-"+t+"-"+r,id:f.getColumnId(r),css:r==f.getColumnCount()-1?"x-grid-col-last":""},h=f.getRenderer(r),u=h(n.getValueAt(t,i),e,t,r,n);(typeof u=="undefined"||u==="")&&(u="&#160;");s.innerHTML=u;o.className=this.cellClass+" "+e.cellId+" "+e.css;this.syncRowHeights(t,t)}},calcColumnWidth:function(n,t){var i=0,o,r,e,u,s,f,h;if(this.grid.autoSizeHeaders&&(o=this.getHeaderCellMeasure(n),i=Math.max(i,o.scrollWidth)),this.cm.isLocked(n)?(r=this.getLockedTable(),e=n):(r=this.getBodyTable(),e=n-this.cm.getLockedCount()),r&&r.rows)for(u=r.rows,s=Math.min(t||u.length,u.length),f=0;f<s;f++)h=u[f].childNodes[e].firstChild,i=Math.max(i,h.scrollWidth);return i+5},autoSizeColumn:function(n,t,i){var r,u;this.cm.isHidden(n)||(t&&(r=this.cm.getColumnId(n),this.css.updateRule(this.colSelector+r,"width",this.grid.minColumnWidth+"px"),this.grid.autoSizeHeaders&&this.css.updateRule(this.hdSelector+r,"width",this.grid.minColumnWidth+"px")),u=this.calcColumnWidth(n),this.cm.setColumnWidth(n,Math.max(this.grid.minColumnWidth,u),i),i||this.grid.fireEvent("columnresize",n,u))},autoSizeColumns:function(){for(var t=this.grid.colModel,i=t.getColumnCount(),n=0;n<i;n++)this.autoSizeColumn(n,!0,!0);t.getTotalWidth()<this.scroller.dom.clientWidth?this.fitColumns():(this.updateColumns(),this.layout())},fitColumns:function(n){for(var i=this.grid.colModel,s=i.getColumnCount(),u=[],e=0,r,f,o,t=0;t<s;t++)i.isHidden(t)||i.isFixed(t)||(r=i.getColumnWidth(t),u.push(t),u.push(r),e+=r);for(f=Math.min(this.scroller.dom.clientWidth,this.el.getWidth()),n&&(f-=17),o=(f-i.getTotalWidth())/e;u.length;)r=u.pop(),t=u.pop(),i.setColumnWidth(t,Math.floor(r+r*o),!0);this.updateColumns();this.layout()},onRowSelect:function(n){var t=this.getRowComposite(n);t.addClass("x-grid-row-selected")},onRowDeselect:function(n){var t=this.getRowComposite(n);t.removeClass("x-grid-row-selected")},onCellSelect:function(n,t){var i=this.getCell(n,t);i&&Ext.fly(i).addClass("x-grid-cell-selected")},onCellDeselect:function(n,t){var i=this.getCell(n,t);i&&Ext.fly(i).removeClass("x-grid-cell-selected")},updateHeaderSortState:function(){var n=this.ds.getSortState(),t;if(n&&(this.sortState=n,t=this.cm.findColumnIndex(n.field),t!=-1)){var r=n.direction,i=this.sortClasses,u=this.el.select(this.headerSelector).removeClass(i);u.item(t).addClass(i[r=="DESC"?1:0])}},handleHeaderClick:function(n,t){if(!this.headersDisabled){var r=n.store,i=n.colModel;i.isSortable(t)&&(n.stopEditing(),r.sort(i.getDataIndex(t)))}},destroy:function(){var n,t,i;if(this.colMenu&&(this.colMenu.removeAll(),Ext.menu.MenuMgr.unregister(this.colMenu),this.colMenu.getEl().remove(),delete this.colMenu),this.hmenu&&(this.hmenu.removeAll(),Ext.menu.MenuMgr.unregister(this.hmenu),this.hmenu.getEl().remove(),delete this.hmenu),this.grid.enableColumnMove&&(n=Ext.dd.DDM.ids["gridHeader"+this.grid.getGridEl().id],n)){for(t in n)!n[t].config.isTarget&&n[t].dragElId?(i=n[t].dragElId,n[t].unreg(),Ext.get(i).remove()):n[t].config.isTarget&&(n[t].proxyTop.remove(),n[t].proxyBottom.remove(),n[t].unreg()),Ext.dd.DDM.locationCache[t]&&delete Ext.dd.DDM.locationCache[t];delete Ext.dd.DDM.ids["gridHeader"+this.grid.getGridEl().id]}this.bind(null,null);Ext.EventManager.removeResizeListener(this.onWindowResize,this)},handleLockChange:function(){this.refresh(!0)},onDenyColumnLock:function(){},onDenyColumnHide:function(){},handleHdMenuClick:function(n){var t=this.hdCtxIndex,i=this.cm,u=this.ds,r;switch(n.id){case"asc":u.sort(i.getDataIndex(t),"ASC");break;case"desc":u.sort(i.getDataIndex(t),"DESC");break;case"lock":if(r=i.getLockedCount(),i.getColumnCount(!0)<=r+1){this.onDenyColumnLock();return}r!=t?(i.setLocked(t,!0,!0),i.moveColumn(t,r),this.grid.fireEvent("columnmove",t,r)):i.setLocked(t,!0);break;case"unlock":r=i.getLockedCount();r-1!=t?(i.setLocked(t,!1,!0),i.moveColumn(t,r-1),this.grid.fireEvent("columnmove",t,r-1)):i.setLocked(t,!1);break;default:if(t=i.getIndexById(n.id.substr(4)),t!=-1){if(n.checked&&i.getColumnCount(!0)<=1)return this.onDenyColumnHide(),!1;i.setHidden(t,n.checked)}}return!0},beforeColMenuShow:function(){var t=this.cm,i=t.getColumnCount(),n;for(this.colMenu.removeAll(),n=0;n<i;n++)this.colMenu.add(new Ext.menu.CheckItem({id:"col-"+t.getColumnId(n),text:t.getColumnHeader(n),checked:!t.isHidden(n),hideOnClick:!1}))},handleHdCtx:function(n,t,i){var f,r,u;i.stopEvent();f=this.getHeaderCell(t);this.hdCtxIndex=t;r=this.hmenu.items;u=this.cm;r.get("asc").setDisabled(!u.isSortable(t));r.get("desc").setDisabled(!u.isSortable(t));this.grid.enableColLock!==!1&&(r.get("lock").setDisabled(u.isLocked(t)),r.get("unlock").setDisabled(!u.isLocked(t)));this.hmenu.show(f,"tl-bl")},handleHdOver:function(n){var t=this.findHeaderCell(n.getTarget());t&&!this.headersDisabled&&this.grid.colModel.isSortable(this.getCellIndex(t))&&this.fly(t).addClass("x-grid-hd-over")},handleHdOut:function(n){var t=this.findHeaderCell(n.getTarget());t&&this.fly(t).removeClass("x-grid-hd-over")},handleSplitDblClick:function(n,t){var i=this.getCellIndex(t);this.grid.enableColumnResize!==!1&&this.cm.isResizable(i)&&!this.cm.isFixed(i)&&(this.autoSizeColumn(i,!0),this.layout())},render:function(){var i=this.cm,u=i.getColumnCount();if(this.grid.monitorWindowResize===!0)Ext.EventManager.onWindowResize(this.onWindowResize,this,!0);var n=this.renderHeaders(),t=this.templates.body.apply({rows:""}),r=this.templates.master.apply({lockedBody:t,body:t,lockedHeader:n[0],header:n[1]});this.grid.getGridEl().dom.innerHTML=r;this.initElements();this.scroller.on("scroll",this.handleScroll,this);this.lockedBody.on("mousewheel",this.handleWheel,this);this.mainBody.on("mousewheel",this.handleWheel,this);this.mainHd.on("mouseover",this.handleHdOver,this);this.mainHd.on("mouseout",this.handleHdOut,this);this.mainHd.on("dblclick",this.handleSplitDblClick,this,{delegate:"."+this.splitClass});this.lockedHd.on("mouseover",this.handleHdOver,this);this.lockedHd.on("mouseout",this.handleHdOut,this);this.lockedHd.on("dblclick",this.handleSplitDblClick,this,{delegate:"."+this.splitClass});if(this.grid.enableColumnResize!==!1&&Ext.grid.SplitDragZone&&new Ext.grid.SplitDragZone(this.grid,this.lockedHd.dom,this.mainHd.dom),this.updateSplitters(),this.grid.enableColumnMove&&Ext.grid.HeaderDragZone&&(new Ext.grid.HeaderDragZone(this.grid,this.lockedHd.dom,this.mainHd.dom),new Ext.grid.HeaderDropZone(this.grid,this.lockedHd.dom,this.mainHd.dom)),this.grid.enableCtxMenu!==!1&&Ext.menu.Menu){if(this.hmenu=new Ext.menu.Menu({id:this.grid.id+"-hctx"}),this.hmenu.add({id:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{id:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"}),this.grid.enableColLock!==!1&&this.hmenu.add("-",{id:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{id:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"}),this.grid.enableColumnHide!==!1){this.colMenu=new Ext.menu.Menu({id:this.grid.id+"-hcols-menu"});this.colMenu.on("beforeshow",this.beforeColMenuShow,this);this.colMenu.on("itemclick",this.handleHdMenuClick,this);this.hmenu.add("-",{id:"columns",text:this.columnsText,menu:this.colMenu})}this.hmenu.on("itemclick",this.handleHdMenuClick,this);this.grid.on("headercontextmenu",this.handleHdCtx,this)}(this.grid.enableDragDrop||this.grid.enableDrag)&&Ext.grid.GridDragZone&&(this.dd=new Ext.grid.GridDragZone(this.grid,{ddGroup:this.grid.ddGroup||"GridDD"}));this.updateHeaderSortState();this.beforeInitialResize();this.layout(!0);this.renderPhase2.defer(1,this)},renderPhase2:function(){this.refresh();this.grid.autoSizeColumns&&this.autoSizeColumns()},beforeInitialResize:function(){},onColumnSplitterMoved:function(n,t){var i,r;this.userResized=!0;i=this.grid.colModel;i.setColumnWidth(n,t,!0);r=i.getColumnId(n);this.css.updateRule(this.colSelector+r,"width",t-this.borderWidth+"px");this.css.updateRule(this.hdSelector+r,"width",t-this.borderWidth+"px");this.updateSplitters();this.layout();this.grid.fireEvent("columnresize",n,t)},syncRowHeights:function(n,t){var i;if(this.grid.enableRowHeightSync===!0&&this.cm.getLockedCount()>0){n=n||0;var r=this.getBodyTable().rows,o=this.getLockedTable().rows,u=r.length-1;for(t=Math.min(t||u,u),i=n;i<=t;i++){var f=r[i],e=o[i],s=Math.max(f.offsetHeight,e.offsetHeight);f.style.height=e.style.height=s+"px"}}},layout:function(n,t){var r=this.grid,k=r.autoHeight,f=r.getGridEl(),o=this.cm,s=r.autoExpandColumn,i=this,w,h,e,u;if(!f.dom.offsetWidth){n&&(this.lockedWrap.show(),this.mainWrap.show());return}var d=this.cm.isLocked(0),y=this.headerPanel.getHeight(),p=this.footerPanel.getHeight();k&&(w=this.getBodyTable().offsetHeight+y+p+this.mainHd.getHeight(),h=w+f.getBorderWidth("tb"),r.maxHeight&&(h=Math.min(r.maxHeight,h)),f.setHeight(h));r.autoWidth&&f.setWidth(o.getTotalWidth()+f.getBorderWidth("lr"));e=this.scroller;u=f.getSize(!0);this.el.setSize(u.width,u.height);this.headerPanel.setWidth(u.width);this.footerPanel.setWidth(u.width);var l=this.mainHd.getHeight(),g=u.width,nt=u.height-(y+p);e.setSize(g,nt);var b=this.getBodyTable(),c=d?Math.max(this.getLockedTable().offsetWidth,this.lockedHd.dom.firstChild.offsetWidth):0,tt=b.offsetHeight,it=c+b.offsetWidth;this.scrollSizer.setSize(it,tt+l);var a=this.lockedWrap,v=this.mainWrap,rt=this.lockedBody,ut=this.mainBody;setTimeout(function(){var y=e.dom.offsetTop,h=e.dom.clientWidth,u=e.dom.clientHeight;if(a.setTop(y),a.setSize(c,u),v.setLeftTop(c,y),v.setSize(h-c,u),rt.setHeight(u-l),ut.setHeight(u-l),t!==!0&&!i.userResized&&s){var p=o.getIndexById(s),b=o.getTotalWidth(!1),w=o.getColumnWidth(p),f=Math.min(Math.max(h-b+w-2-(h<=e.dom.offsetWidth?0:18),r.autoExpandMin),r.autoExpandMax);w!=f&&(o.setColumnWidth(p,f,!0),i.css.updateRule(i.colSelector+s,"width",f-i.borderWidth+"px"),i.css.updateRule(i.hdSelector+s,"width",f-i.borderWidth+"px"),i.updateSplitters(),i.layout(!1,!0))}n&&(a.show(),v.show())},10)},onWindowResize:function(){this.grid.monitorWindowResize&&!this.grid.autoHeight&&this.layout()},appendFooter:function(){return null},sortAscText:"Sort Ascending",sortDescText:"Sort Descending",lockText:"Lock Column",unlockText:"Unlock Column",columnsText:"Columns"})
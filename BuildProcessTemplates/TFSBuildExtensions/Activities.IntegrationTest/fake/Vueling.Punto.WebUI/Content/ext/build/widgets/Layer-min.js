(function(){Ext.Layer=function(n,t){var r;n=n||{};var u=Ext.DomHelper,i=n.parentEl,f=i?Ext.getDom(i):document.body;t&&(this.dom=Ext.getDom(t));this.dom||(r=n.dh||{tag:"div",cls:"x-layer"},this.dom=u.append(f,r));n.cls&&this.addClass(n.cls);this.constrain=n.constrain!==!1;this.visibilityMode=Ext.Element.VISIBILITY;this.id=n.id?this.dom.id=n.id:Ext.id(this.dom);this.zindex=n.zindex||this.getZIndex();this.position("absolute",this.zindex);n.shadow?(this.shadowOffset=n.shadowOffset||4,this.shadow=new Ext.Shadow({offset:this.shadowOffset,mode:n.shadow})):this.shadowOffset=0;this.useShim=n.shim!==!1&&Ext.useShims;this.useDisplay=n.useDisplay;this.hide()};var n=Ext.Element.prototype,t=[];Ext.extend(Ext.Layer,Ext.Element,{getZIndex:function(){return this.zindex||parseInt(this.getStyle("z-index"),10)||11e3},getShim:function(){var n,i;return this.useShim?this.shim?this.shim:(n=t.shift(),n||(n=this.createShim(),n.enableDisplayMode("block"),n.dom.style.display="none",n.dom.style.visibility="visible"),i=this.dom.parentNode,n.dom.parentNode!=i&&i.insertBefore(n.dom,this.dom),n.setStyle("z-index",this.getZIndex()-2),this.shim=n,n):null},hideShim:function(){this.shim&&(this.shim.setDisplayed(!1),t.push(this.shim),delete this.shim)},disableShadow:function(){this.shadow&&(this.shadowDisabled=!0,this.shadow.hide(),this.lastShadowOffset=this.shadowOffset,this.shadowOffset=0)},enableShadow:function(n){this.shadow&&(this.shadowDisabled=!1,this.shadowOffset=this.lastShadowOffset,delete this.lastShadowOffset,n&&this.sync(!0))},sync:function(n){var i=this.shadow,r,u;if(!this.updating&&this.isVisible()&&(i||this.useShim)){var t=this.getShim(),o=this.getWidth(),s=this.getHeight(),f=this.getLeft(!0),e=this.getTop(!0);i&&!this.shadowDisabled?(n&&!i.isVisible()?i.show(this):i.realign(f,e,o,s),t&&(n&&t.show(),r=i.adjusts,u=t.dom.style,u.left=Math.min(f,f+r.l)+"px",u.top=Math.min(e,e+r.t)+"px",u.width=o+r.w+"px",u.height=s+r.h+"px")):t&&(n&&t.show(),t.setSize(o,s),t.setLeftTop(f,e))}},destroy:function(){this.hideShim();this.shadow&&this.shadow.hide();this.removeAllListeners();Ext.removeNode(this.dom);Ext.Element.uncache(this.id)},remove:function(){this.destroy()},beginUpdate:function(){this.updating=!0},endUpdate:function(){this.updating=!1;this.sync(!0)},hideUnders:function(){this.shadow&&this.shadow.hide();this.hideShim()},constrainXY:function(){var o;if(this.constrain){var s=Ext.lib.Dom.getViewWidth(),h=Ext.lib.Dom.getViewHeight(),i=Ext.getDoc().getScroll(),r=this.getXY(),u=r[0],t=r[1],c=this.dom.offsetWidth+this.shadowOffset,e=this.dom.offsetHeight+this.shadowOffset,f=!1;u+c>s+i.left&&(u=s-c-this.shadowOffset,f=!0);t+e>h+i.top&&(t=h-e-this.shadowOffset,f=!0);u<i.left&&(u=i.left,f=!0);t<i.top&&(t=i.top,f=!0);f&&(this.avoidY&&(o=this.avoidY,t<=o&&t+e>=o&&(t=o-e-5)),r=[u,t],this.storeXY(r),n.setXY.call(this,r),this.sync())}},isVisible:function(){return this.visible},showAction:function(){this.visible=!0;this.useDisplay===!0?this.setDisplayed(""):this.lastXY?n.setXY.call(this,this.lastXY):this.lastLT&&n.setLeftTop.call(this,this.lastLT[0],this.lastLT[1])},hideAction:function(){this.visible=!1;this.useDisplay===!0?this.setDisplayed(!1):this.setLeftTop(-1e4,-1e4)},setVisible:function(t,i,r,u,f){var e;t&&this.showAction();i&&t?(e=function(){this.sync(!0);u&&u()}.createDelegate(this),n.setVisible.call(this,!0,!0,r,e,f)):(t||this.hideUnders(!0),e=u,i&&(e=function(){this.hideAction();u&&u()}.createDelegate(this)),n.setVisible.call(this,t,i,r,e,f),t?this.sync(!0):i||this.hideAction())},storeXY:function(n){delete this.lastLT;this.lastXY=n},storeLeftTop:function(n,t){delete this.lastXY;this.lastLT=[n,t]},beforeFx:function(){return this.beforeAction(),Ext.Layer.superclass.beforeFx.apply(this,arguments)},afterFx:function(){Ext.Layer.superclass.afterFx.apply(this,arguments);this.sync(this.isVisible())},beforeAction:function(){!this.updating&&this.shadow&&this.shadow.hide()},setLeft:function(t){this.storeLeftTop(t,this.getTop(!0));n.setLeft.apply(this,arguments);this.sync()},setTop:function(t){this.storeLeftTop(this.getLeft(!0),t);n.setTop.apply(this,arguments);this.sync()},setLeftTop:function(t,i){this.storeLeftTop(t,i);n.setLeftTop.apply(this,arguments);this.sync()},setXY:function(t,i,r,u,f){this.fixDisplay();this.beforeAction();this.storeXY(t);var e=this.createCB(u);n.setXY.call(this,t,i,r,e,f);i||e()},createCB:function(n){var t=this;return function(){t.constrainXY();t.sync(!0);n&&n()}},setX:function(n,t,i,r,u){this.setXY([n,this.getY()],t,i,r,u)},setY:function(n,t,i,r,u){this.setXY([this.getX(),n],t,i,r,u)},setSize:function(t,i,r,u,f,e){this.beforeAction();var o=this.createCB(f);n.setSize.call(this,t,i,r,u,o,e);r||o()},setWidth:function(t,i,r,u,f){this.beforeAction();var e=this.createCB(u);n.setWidth.call(this,t,i,r,e,f);i||e()},setHeight:function(t,i,r,u,f){this.beforeAction();var e=this.createCB(u);n.setHeight.call(this,t,i,r,e,f);i||e()},setBounds:function(t,i,r,u,f,e,o,s){this.beforeAction();var h=this.createCB(o);return f?n.setBounds.call(this,t,i,r,u,f,e,h,s):(this.storeXY([t,i]),n.setXY.call(this,[t,i]),n.setSize.call(this,r,u,f,e,h,s),h()),this},setZIndex:function(n){this.zindex=n;this.setStyle("z-index",n+2);this.shadow&&this.shadow.setZIndex(n+1);this.shim&&this.shim.setStyle("z-index",n)}})})()
Ext.data.Tree=function(n){this.nodeHash={};this.root=null;n&&this.setRootNode(n);this.addEvents("append","remove","move","insert","beforeappend","beforeremove","beforemove","beforeinsert");Ext.data.Tree.superclass.constructor.call(this)};Ext.extend(Ext.data.Tree,Ext.util.Observable,{pathSeparator:"/",proxyNodeEvent:function(){return this.fireEvent.apply(this,arguments)},getRootNode:function(){return this.root},setRootNode:function(n){return this.root=n,n.ownerTree=this,n.isRoot=!0,this.registerNode(n),n},getNodeById:function(n){return this.nodeHash[n]},registerNode:function(n){this.nodeHash[n.id]=n},unregisterNode:function(n){delete this.nodeHash[n.id]},toString:function(){return"[Tree"+(this.id?" "+this.id:"")+"]"}});Ext.data.Node=function(n){this.attributes=n||{};this.leaf=this.attributes.leaf;this.id=this.attributes.id;this.id||(this.id=Ext.id(null,"ynode-"),this.attributes.id=this.id);this.childNodes=[];this.childNodes.indexOf||(this.childNodes.indexOf=function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]==n)return t;return-1});this.parentNode=null;this.firstChild=null;this.lastChild=null;this.previousSibling=null;this.nextSibling=null;this.addEvents({append:!0,remove:!0,move:!0,insert:!0,beforeappend:!0,beforeremove:!0,beforemove:!0,beforeinsert:!0});this.listeners=this.attributes.listeners;Ext.data.Node.superclass.constructor.call(this)};Ext.extend(Ext.data.Node,Ext.util.Observable,{fireEvent:function(){if(Ext.data.Node.superclass.fireEvent.apply(this,arguments)===!1)return!1;var n=this.getOwnerTree();return n&&n.proxyNodeEvent.apply(n,arguments)===!1?!1:!0},isLeaf:function(){return this.leaf===!0},setFirstChild:function(n){this.firstChild=n},setLastChild:function(n){this.lastChild=n},isLast:function(){return this.parentNode?this.parentNode.lastChild==this:!0},isFirst:function(){return this.parentNode?this.parentNode.firstChild==this:!0},hasChildNodes:function(){return!this.isLeaf()&&this.childNodes.length>0},appendChild:function(n){var r=!1,u,e,t,i,f;if(n instanceof Array?r=n:arguments.length>1&&(r=arguments),r)for(u=0,e=r.length;u<e;u++)this.appendChild(r[u]);else{if(this.fireEvent("beforeappend",this.ownerTree,this,n)===!1)return!1;if(t=this.childNodes.length,i=n.parentNode,i){if(n.fireEvent("beforemove",n.getOwnerTree(),n,i,this,t)===!1)return!1;i.removeChild(n)}return t=this.childNodes.length,t==0&&this.setFirstChild(n),this.childNodes.push(n),n.parentNode=this,f=this.childNodes[t-1],f?(n.previousSibling=f,f.nextSibling=n):n.previousSibling=null,n.nextSibling=null,this.setLastChild(n),n.setOwnerTree(this.getOwnerTree()),this.fireEvent("append",this.ownerTree,this,n,t),i&&n.fireEvent("move",this.ownerTree,n,i,this,t),n}},removeChild:function(n){var t=this.childNodes.indexOf(n);return t==-1?!1:this.fireEvent("beforeremove",this.ownerTree,this,n)===!1?!1:(this.childNodes.splice(t,1),n.previousSibling&&(n.previousSibling.nextSibling=n.nextSibling),n.nextSibling&&(n.nextSibling.previousSibling=n.previousSibling),this.firstChild==n&&this.setFirstChild(n.nextSibling),this.lastChild==n&&this.setLastChild(n.previousSibling),n.setOwnerTree(null),n.parentNode=null,n.previousSibling=null,n.nextSibling=null,this.fireEvent("remove",this.ownerTree,this,n),n)},insertBefore:function(n,t){var u;if(!t)return this.appendChild(n);if(n==t||this.fireEvent("beforeinsert",this.ownerTree,this,n,t)===!1)return!1;var f=this.childNodes.indexOf(t),i=n.parentNode,r=f;if(i==this&&this.childNodes.indexOf(n)<f&&r--,i){if(n.fireEvent("beforemove",n.getOwnerTree(),n,i,this,f,t)===!1)return!1;i.removeChild(n)}return r==0&&this.setFirstChild(n),this.childNodes.splice(r,0,n),n.parentNode=this,u=this.childNodes[r-1],u?(n.previousSibling=u,u.nextSibling=n):n.previousSibling=null,n.nextSibling=t,t.previousSibling=n,n.setOwnerTree(this.getOwnerTree()),this.fireEvent("insert",this.ownerTree,this,n,t),i&&n.fireEvent("move",this.ownerTree,n,i,this,r,t),n},remove:function(){return this.parentNode.removeChild(this),this},item:function(n){return this.childNodes[n]},replaceChild:function(n,t){return this.insertBefore(n,t),this.removeChild(t),t},indexOf:function(n){return this.childNodes.indexOf(n)},getOwnerTree:function(){if(!this.ownerTree)for(var n=this;n;){if(n.ownerTree){this.ownerTree=n.ownerTree;break}n=n.parentNode}return this.ownerTree},getDepth:function(){for(var t=0,n=this;n.parentNode;)++t,n=n.parentNode;return t},setOwnerTree:function(n){var i,t,r;if(n!=this.ownerTree){for(this.ownerTree&&this.ownerTree.unregisterNode(this),this.ownerTree=n,i=this.childNodes,t=0,r=i.length;t<r;t++)i[t].setOwnerTree(n);n&&n.registerNode(this)}},getPath:function(n){var t,i,r;for(n=n||"id",t=this.parentNode,i=[this.attributes[n]];t;)i.unshift(t.attributes[n]),t=t.parentNode;return r=this.getOwnerTree().pathSeparator,r+i.join(r)},bubble:function(n,t,i){for(var r=this;r;){if(n.apply(t||r,i||[r])===!1)break;r=r.parentNode}},cascade:function(n,t,i){var u,r,f;if(n.apply(t||this,i||[this])!==!1)for(u=this.childNodes,r=0,f=u.length;r<f;r++)u[r].cascade(n,t,i)},eachChild:function(n,t,i){for(var u=this.childNodes,r=0,f=u.length;r<f;r++)if(n.apply(t||this,i||[u[r]])===!1)break},findChild:function(n,t){for(var r=this.childNodes,i=0,u=r.length;i<u;i++)if(r[i].attributes[n]==t)return r[i];return null},findChildBy:function(n,t){for(var r=this.childNodes,i=0,u=r.length;i<u;i++)if(n.call(t||r[i],r[i])===!0)return r[i];return null},sort:function(n,t){var r=this.childNodes,f=r.length,e,i,u;if(f>0)for(e=t?function(){n.apply(t,arguments)}:n,r.sort(e),i=0;i<f;i++)u=r[i],u.previousSibling=r[i-1],u.nextSibling=r[i+1],i==0&&this.setFirstChild(u),i==f-1&&this.setLastChild(u)},contains:function(n){return n.isAncestor(this)},isAncestor:function(n){for(var t=this.parentNode;t;){if(t==n)return!0;t=t.parentNode}return!1},toString:function(){return"[Node"+(this.id?" "+this.id:"")+"]"}})
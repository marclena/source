Ext.TabPanel=Ext.extend(Ext.Panel,{monitorResize:!0,deferredRender:!0,tabWidth:120,minTabWidth:30,resizeTabs:!1,enableTabScroll:!1,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:.35,animScroll:!0,tabPosition:"top",baseCls:"x-tab-panel",autoTabs:!1,autoTabSelector:"div.x-tab",activeTab:null,tabMargin:2,plain:!1,wheelIncrement:20,idDelimiter:"__",itemCls:"x-tab-item",elements:"body",headerAsText:!1,frame:!1,hideBorders:!0,initComponent:function(){this.frame=!1;Ext.TabPanel.superclass.initComponent.call(this);this.addEvents("beforetabchange","tabchange","contextmenu");this.setLayout(new Ext.layout.CardLayout({deferredRender:this.deferredRender}));this.tabPosition=="top"?(this.elements+=",header",this.stripTarget="header"):(this.elements+=",footer",this.stripTarget="footer");this.stack||(this.stack=Ext.TabPanel.AccessStack());this.initItems()},render:function(){if(Ext.TabPanel.superclass.render.apply(this,arguments),this.activeTab!==undefined){var n=this.activeTab;delete this.activeTab;this.setActiveTab(n)}},onRender:function(n,t){var r,u,i;Ext.TabPanel.superclass.onRender.call(this,n,t);this.plain&&(r=this.tabPosition=="top"?"header":"footer",this[r].addClass("x-tab-panel-"+r+"-plain"));u=this[this.stripTarget];this.stripWrap=u.createChild({cls:"x-tab-strip-wrap",cn:{tag:"ul",cls:"x-tab-strip x-tab-strip-"+this.tabPosition}});this.stripSpacer=u.createChild({cls:"x-tab-strip-spacer"});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:"li",cls:"x-tab-edge"});this.strip.createChild({cls:"x-clear"});this.body.addClass("x-tab-panel-body-"+this.tabPosition);this.itemTpl||(i=new Ext.Template('<li class="{cls}" id="{id}"><a class="x-tab-strip-close" onclick="return false;"><\/a>','<a class="x-tab-right" href="#" onclick="return false;"><em class="x-tab-left">','<span class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}<\/span><\/span>',"<\/em><\/a><\/li>"),i.disableFormats=!0,i.compile(),Ext.TabPanel.prototype.itemTpl=i);this.items.each(this.initTab,this)},afterRender:function(){Ext.TabPanel.superclass.afterRender.call(this);this.autoTabs&&this.readTabs(!1)},initEvents:function(){Ext.TabPanel.superclass.initEvents.call(this);this.on("add",this.onAdd,this);this.on("remove",this.onRemove,this);this.strip.on("mousedown",this.onStripMouseDown,this);this.strip.on("click",this.onStripClick,this);this.strip.on("contextmenu",this.onStripContextMenu,this);if(this.enableTabScroll)this.strip.on("mousewheel",this.onWheel,this)},findTargets:function(n){var t=null,i=n.getTarget("li",this.strip);return i&&(t=this.getComponent(i.id.split(this.idDelimiter)[1]),t.disabled)?{close:null,item:null,el:null}:{close:n.getTarget(".x-tab-strip-close",this.strip),item:t,el:i}},onStripMouseDown:function(n){if(n.preventDefault(),n.button==0){var t=this.findTargets(n);if(t.close){this.remove(t.item);return}t.item&&t.item!=this.activeTab&&this.setActiveTab(t.item)}},onStripClick:function(n){var t=this.findTargets(n);!t.close&&t.item&&t.item!=this.activeTab&&this.setActiveTab(t.item)},onStripContextMenu:function(n){n.preventDefault();var t=this.findTargets(n);t.item&&this.fireEvent("contextmenu",this,t.item,n)},readTabs:function(n){var r,t,u,i,f;for(n===!0&&this.items.each(function(n){this.remove(n)},this),r=this.el.query(this.autoTabSelector),t=0,u=r.length;t<u;t++)i=r[t],f=i.getAttribute("title"),i.removeAttribute("title"),this.add({title:f,el:i})},initTab:function(n,t){var f=this.strip.dom.childNodes[t],i=n.closable?"x-tab-strip-closable":"",r,u;n.disabled&&(i+=" x-item-disabled");n.iconCls&&(i+=" x-tab-with-icon");r={id:this.id+this.idDelimiter+n.getItemId(),text:n.title,cls:i,iconCls:n.iconCls||""};u=f?this.itemTpl.insertBefore(f,r):this.itemTpl.append(this.strip,r);Ext.fly(u).addClassOnOver("x-tab-strip-over");n.tabTip&&(Ext.fly(u).child("span.x-tab-strip-text",!0).qtip=n.tabTip);n.on("disable",this.onItemDisabled,this);n.on("enable",this.onItemEnabled,this);n.on("titlechange",this.onItemTitleChanged,this);n.on("beforeshow",this.onBeforeShowItem,this)},onAdd:function(n,t,i){this.initTab(t,i);this.items.getCount()==1&&this.syncSize();this.delegateUpdates()},onBeforeAdd:function(n){var i=n.events?this.items.containsKey(n.getItemId())?n:null:this.items.get(n),t;if(i)return this.setActiveTab(n),!1;Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);t=n.elements;n.elements=t?t.replace(",header",""):t;n.border=n.border===!0},onRemove:function(n,t){if(Ext.removeNode(this.getTabEl(t)),this.stack.remove(t),t==this.activeTab){var i=this.stack.next();i?this.setActiveTab(i):this.setActiveTab(0)}this.delegateUpdates()},onBeforeShowItem:function(n){if(n!=this.activeTab)return this.setActiveTab(n),!1},onItemDisabled:function(n){var t=this.getTabEl(n);t&&Ext.fly(t).addClass("x-item-disabled");this.stack.remove(n)},onItemEnabled:function(n){var t=this.getTabEl(n);t&&Ext.fly(t).removeClass("x-item-disabled")},onItemTitleChanged:function(n){var t=this.getTabEl(n);t&&(Ext.fly(t).child("span.x-tab-strip-text",!0).innerHTML=n.title)},getTabEl:function(n){var t=typeof n=="number"?this.items.items[n].getItemId():n.getItemId();return document.getElementById(this.id+this.idDelimiter+t)},onResize:function(){Ext.TabPanel.superclass.onResize.apply(this,arguments);this.delegateUpdates()},beginUpdate:function(){this.suspendUpdates=!0},endUpdate:function(){this.suspendUpdates=!1;this.delegateUpdates()},hideTabStripItem:function(n){n=this.getComponent(n);var t=this.getTabEl(n);t&&(t.style.display="none",this.delegateUpdates())},unhideTabStripItem:function(n){n=this.getComponent(n);var t=this.getTabEl(n);t&&(t.style.display="",this.delegateUpdates())},delegateUpdates:function(){this.suspendUpdates||(this.resizeTabs&&this.rendered&&this.autoSizeTabs(),this.enableTabScroll&&this.rendered&&this.autoScrollTabs())},autoSizeTabs:function(){var r=this.items.length,u=this.tabPosition!="bottom"?"header":"footer",l=this[u].dom.offsetWidth,f=this[u].dom.clientWidth,t,i,n,e;if(this.resizeTabs&&!(r<1)&&f)for(t=Math.max(Math.min(Math.floor((f-4)/r)-this.tabMargin,this.tabWidth),this.minTabWidth),this.lastTabWidth=t,i=this.stripWrap.dom.getElementsByTagName("li"),n=0,e=i.length-1;n<e;n++){var o=i[n],s=o.childNodes[1].firstChild.firstChild,h=o.offsetWidth,c=s.offsetWidth;s.style.width=t-(h-c)+"px"}},adjustBodyWidth:function(n){return this.header&&this.header.setWidth(n),this.footer&&this.footer.setWidth(n),n},setActiveTab:function(n){var t,i;if(n=this.getComponent(n),n&&this.fireEvent("beforetabchange",this,n,this.activeTab)!==!1){if(!this.rendered){this.activeTab=n;return}this.activeTab!=n&&(this.activeTab&&(t=this.getTabEl(this.activeTab),t&&Ext.fly(t).removeClass("x-tab-strip-active"),this.activeTab.fireEvent("deactivate",this.activeTab)),i=this.getTabEl(n),Ext.fly(i).addClass("x-tab-strip-active"),this.activeTab=n,this.stack.add(n),this.layout.setActiveItem(n),this.layoutOnTabChange&&n.doLayout&&n.doLayout(),this.scrolling&&this.scrollToTab(n,this.animScroll),n.fireEvent("activate",n),this.fireEvent("tabchange",this,n))}},getActiveTab:function(){return this.activeTab||null},getItem:function(n){return this.getComponent(n)},autoScrollTabs:function(){var u=this.items.length,e=this.header.dom.offsetWidth,n=this.header.dom.clientWidth,t=this.stripWrap,f=t.dom.offsetWidth,r=this.getScrollPos(),i=this.edge.getOffsetsTo(this.stripWrap)[0]+r;!this.enableTabScroll||u<1||f<20||(i<=n?(t.dom.scrollLeft=0,t.setWidth(n),this.scrolling&&(this.scrolling=!1,this.header.removeClass("x-tab-scrolling"),this.scrollLeft.hide(),this.scrollRight.hide())):(this.scrolling||this.header.addClass("x-tab-scrolling"),n-=t.getMargins("lr"),t.setWidth(n>20?n:20),this.scrolling||(this.scrollLeft?(this.scrollLeft.show(),this.scrollRight.show()):this.createScrollers()),this.scrolling=!0,r>i-n?t.dom.scrollLeft=i-n:this.scrollToTab(this.activeTab,!1),this.updateScrollButtons()))},createScrollers:function(){var i=this.stripWrap.dom.offsetHeight,t=this.header.insertFirst({cls:"x-tab-scroller-left"}),n;t.setHeight(i);t.addClassOnOver("x-tab-scroller-left-over");this.leftRepeater=new Ext.util.ClickRepeater(t,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});this.scrollLeft=t;n=this.header.insertFirst({cls:"x-tab-scroller-right"});n.setHeight(i);n.addClassOnOver("x-tab-scroller-right-over");this.rightRepeater=new Ext.util.ClickRepeater(n,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});this.scrollRight=n},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos()},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}},getScrollIncrement:function(){return this.scrollIncrement||(this.resizeTabs?this.lastTabWidth+2:100)},scrollToTab:function(n,t){if(n){var u=this.getTabEl(n),i=this.getScrollPos(),f=this.getScrollArea(),r=Ext.fly(u).getOffsetsTo(this.stripWrap)[0]+i,e=r+u.offsetWidth;r<i?this.scrollTo(r,t):e>i+f&&this.scrollTo(e-f,t)}},scrollTo:function(n,t){this.stripWrap.scrollTo("left",n,t?this.getScrollAnim():!1);t||this.updateScrollButtons()},onWheel:function(n){var r=n.getWheelDelta()*this.wheelIncrement*-1;n.stopEvent();var t=this.getScrollPos(),u=t+r,f=this.getScrollWidth()-this.getScrollArea(),i=Math.max(0,Math.min(f,u));i!=t&&this.scrollTo(i,!1)},onScrollRight:function(){var i=this.getScrollWidth()-this.getScrollArea(),n=this.getScrollPos(),t=Math.min(i,n+this.getScrollIncrement());t!=n&&this.scrollTo(t,this.animScroll)},onScrollLeft:function(){var n=this.getScrollPos(),t=Math.max(0,n-this.getScrollIncrement());t!=n&&this.scrollTo(t,this.animScroll)},updateScrollButtons:function(){var n=this.getScrollPos();this.scrollLeft[n==0?"addClass":"removeClass"]("x-tab-scroller-left-disabled");this.scrollRight[n>=this.getScrollWidth()-this.getScrollArea()?"addClass":"removeClass"]("x-tab-scroller-right-disabled")}});Ext.reg("tabpanel",Ext.TabPanel);Ext.TabPanel.prototype.activate=Ext.TabPanel.prototype.setActiveTab;Ext.TabPanel.AccessStack=function(){var n=[];return{add:function(t){n.push(t);n.length>10&&n.shift()},remove:function(t){for(var r=[],i=0,u=n.length;i<u;i++)n[i]!=t&&r.push(n[i]);n=r},next:function(){return n.pop()}}}
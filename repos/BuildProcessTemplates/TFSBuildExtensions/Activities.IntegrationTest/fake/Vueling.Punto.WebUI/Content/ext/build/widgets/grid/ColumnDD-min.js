Ext.grid.HeaderDragZone=function(n,t,i){this.grid=n;this.view=n.getView();this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDragZone.superclass.constructor.call(this,t);i&&(this.setHandleElId(Ext.id(t)),this.setOuterHandleElId(Ext.id(i)));this.scroll=!1};Ext.extend(Ext.grid.HeaderDragZone,Ext.dd.DragZone,{maxDragWidth:120,getDragData:function(n){var i=Ext.lib.Event.getTarget(n),t=this.view.findHeaderCell(i);return t?{ddel:t.firstChild,header:t}:!1},onInitDrag:function(){this.view.headersDisabled=!0;var n=this.dragData.ddel.cloneNode(!0);return n.id=Ext.id(),n.style.width=Math.min(this.dragData.header.offsetWidth,this.maxDragWidth)+"px",this.proxy.update(n),!0},afterValidDrop:function(){var n=this.view;setTimeout(function(){n.headersDisabled=!1},50)},afterInvalidDrop:function(){var n=this.view;setTimeout(function(){n.headersDisabled=!1},50)}});Ext.grid.HeaderDropZone=function(n){this.grid=n;this.view=n.getView();this.proxyTop=Ext.DomHelper.append(document.body,{cls:"col-move-top",html:"&#160;"},!0);this.proxyBottom=Ext.DomHelper.append(document.body,{cls:"col-move-bottom",html:"&#160;"},!0);this.proxyTop.hide=this.proxyBottom.hide=function(){this.setLeftTop(-100,-100);this.setStyle("visibility","hidden")};this.ddGroup="gridHeader"+this.grid.getGridEl().id;Ext.grid.HeaderDropZone.superclass.constructor.call(this,n.getGridEl().dom)};Ext.extend(Ext.grid.HeaderDropZone,Ext.dd.DropZone,{proxyOffsets:[-4,-9],fly:Ext.Element.fly,getTargetFromEvent:function(n){var i=Ext.lib.Event.getTarget(n),t=this.view.findCellIndex(i);if(t!==!1)return this.view.getHeaderCell(t)},nextVisible:function(n){var t=this.view,i=this.grid.colModel;for(n=n.nextSibling;n;){if(!i.isHidden(t.getCellIndex(n)))return n;n=n.nextSibling}return null},prevVisible:function(n){var t=this.view,i=this.grid.colModel;for(n=n.prevSibling;n;){if(!i.isHidden(t.getCellIndex(n)))return n;n=n.prevSibling}return null},positionIndicator:function(n,t,i){var c=Ext.lib.Event.getPageX(i),u=Ext.lib.Dom.getRegion(t.firstChild),f,e,s=u.top+this.proxyOffsets[1],o,r,h;return(u.right-c<=(u.right-u.left)/2?(f=u.right+this.view.borderWidth,e="after"):(f=u.left,e="before"),o=this.view.getCellIndex(n),r=this.view.getCellIndex(t),this.grid.colModel.isFixed(r))?!1:(h=this.grid.colModel.isLocked(r),e=="after"&&r++,o<r&&r--,o==r&&h==this.grid.colModel.isLocked(o))?!1:(f+=this.proxyOffsets[0],this.proxyTop.setLeftTop(f,s),this.proxyTop.show(),this.bottomOffset||(this.bottomOffset=this.view.mainHd.getHeight()),this.proxyBottom.setLeftTop(f,s+this.proxyTop.dom.offsetHeight+this.bottomOffset),this.proxyBottom.show(),e)},onNodeEnter:function(n,t,i,r){r.header!=n&&this.positionIndicator(r.header,n,i)},onNodeOver:function(n,t,i,r){var u=!1;return r.header!=n&&(u=this.positionIndicator(r.header,n,i)),u||(this.proxyTop.hide(),this.proxyBottom.hide()),u?this.dropAllowed:this.dropNotAllowed},onNodeOut:function(){this.proxyTop.hide();this.proxyBottom.hide()},onNodeDrop:function(n,t,i,r){var s=r.header;if(s!=n){var e=this.grid.colModel,c=Ext.lib.Event.getPageX(i),o=Ext.lib.Dom.getRegion(n.firstChild),l=o.right-c<=(o.right-o.left)/2?"after":"before",f=this.view.getCellIndex(s),u=this.view.getCellIndex(n),h=e.isLocked(u);return(l=="after"&&u++,f<u&&u--,f==u&&h==e.isLocked(f))?!1:(e.setLocked(f,h,!0),e.moveColumn(f,u),this.grid.fireEvent("columnmove",f,u),!0)}return!1}});Ext.grid.GridView.ColumnDragZone=function(n,t){Ext.grid.GridView.ColumnDragZone.superclass.constructor.call(this,n,t,null);this.proxy.el.addClass("x-grid3-col-dd")};Ext.extend(Ext.grid.GridView.ColumnDragZone,Ext.grid.HeaderDragZone,{handleMouseDown:function(){},callHandleMouseDown:function(n){Ext.grid.GridView.ColumnDragZone.superclass.handleMouseDown.call(this,n)}})
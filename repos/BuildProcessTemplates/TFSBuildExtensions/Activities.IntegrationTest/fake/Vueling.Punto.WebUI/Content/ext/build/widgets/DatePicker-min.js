Ext.DatePicker=Ext.extend(Ext.Component,{todayText:"Today",okText:"&#160;OK&#160;",cancelText:"Cancel",todayTip:"{0} (Spacebar)",minDate:null,maxDate:null,minText:"This date is before the minimum date",maxText:"This date is after the maximum date",format:"m/d/y",disabledDays:null,disabledDaysText:"",disabledDatesRE:null,disabledDatesText:"",constrainToViewport:!0,monthNames:Date.monthNames,dayNames:Date.dayNames,nextText:"Next Month (Control+Right)",prevText:"Previous Month (Control+Left)",monthYearText:"Choose a month (Control+Up/Down to move years)",startDay:0,initComponent:function(){if(Ext.DatePicker.superclass.initComponent.call(this),this.value=this.value?this.value.clearTime():(new Date).clearTime(),this.addEvents("select"),this.handler)this.on("select",this.handler,this.scope||this);this.initDisabledDays()},initDisabledDays:function(){var t,i,n;if(!this.disabledDatesRE&&this.disabledDates){for(t=this.disabledDates,i="(?:",n=0;n<t.length;n++)i+=t[n],n!=t.length-1&&(i+="|");this.disabledDatesRE=new RegExp(i+")")}},setValue:function(n){var t=this.value;this.value=n.clearTime(!0);this.el&&this.update(this.value)},getValue:function(){return this.value},focus:function(){this.el&&this.update(this.activeDate)},onRender:function(n,t){for(var f,u,s,e,i=['<table cellspacing="0">','<tr><td class="x-date-left"><a href="#" title="',this.prevText,'">&#160;<\/a><\/td><td class="x-date-middle" align="center"><\/td><td class="x-date-right"><a href="#" title="',this.nextText,'">&#160;<\/a><\/td><\/tr>','<tr><td colspan="3"><table class="x-date-inner" cellspacing="0"><thead><tr>'],o=this.dayNames,r=0;r<7;r++)f=this.startDay+r,f>6&&(f=f-7),i.push("<th><span>",o[f].substr(0,1),"<\/span><\/th>");for(i[i.length]="<\/tr><\/thead><tbody><tr>",r=0;r<42;r++)r%7==0&&r!=0&&(i[i.length]="<\/tr><tr>"),i[i.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span><\/span><\/em><\/a><\/td>';i[i.length]='<\/tr><\/tbody><\/table><\/td><\/tr><tr><td colspan="3" class="x-date-bottom" align="center"><\/td><\/tr><\/table><div class="x-date-mp"><\/div>';u=document.createElement("div");u.className="x-date-picker";u.innerHTML=i.join("");n.dom.insertBefore(u,t);this.el=Ext.get(u);this.eventEl=Ext.get(u.firstChild);new Ext.util.ClickRepeater(this.el.child("td.x-date-left a"),{handler:this.showPrevMonth,scope:this,preventDefault:!0,stopDefault:!0});new Ext.util.ClickRepeater(this.el.child("td.x-date-right a"),{handler:this.showNextMonth,scope:this,preventDefault:!0,stopDefault:!0});this.eventEl.on("mousewheel",this.handleMouseWheel,this);this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");s=new Ext.KeyNav(this.eventEl,{left:function(n){n.ctrlKey?this.showPrevMonth():this.update(this.activeDate.add("d",-1))},right:function(n){n.ctrlKey?this.showNextMonth():this.update(this.activeDate.add("d",1))},up:function(n){n.ctrlKey?this.showNextYear():this.update(this.activeDate.add("d",-7))},down:function(n){n.ctrlKey?this.showPrevYear():this.update(this.activeDate.add("d",7))},pageUp:function(){this.showNextMonth()},pageDown:function(){this.showPrevMonth()},enter:function(n){return n.stopPropagation(),!0},scope:this});this.eventEl.on("click",this.handleDateClick,this,{delegate:"a.x-date-date"});this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);this.el.unselectable();this.cells=this.el.select("table.x-date-inner tbody td");this.textNodes=this.el.query("table.x-date-inner tbody span");this.mbtn=new Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-middle",!0)});this.mbtn.on("click",this.showMonthPicker,this);this.mbtn.el.child(this.mbtn.menuClassTarget).addClass("x-btn-with-menu");e=(new Date).dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom",!0),text:String.format(this.todayText,e),tooltip:String.format(this.todayTip,e),handler:this.selectToday,scope:this});Ext.isIE&&this.el.repaint();this.update(this.value)},createMonthPicker:function(){var t,n;if(!this.monthPicker.dom.firstChild){for(t=['<table border="0" cellspacing="0">'],n=0;n<6;n++)t.push('<tr><td class="x-date-mp-month"><a href="#">',this.monthNames[n].substr(0,3),"<\/a><\/td>",'<td class="x-date-mp-month x-date-mp-sep"><a href="#">',this.monthNames[n+6].substr(0,3),"<\/a><\/td>",n==0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"><\/a><\/td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next"><\/a><\/td><\/tr>':'<td class="x-date-mp-year"><a href="#"><\/a><\/td><td class="x-date-mp-year"><a href="#"><\/a><\/td><\/tr>');t.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'<\/button><button type="button" class="x-date-mp-cancel">',this.cancelText,"<\/button><\/td><\/tr>","<\/table>");this.monthPicker.update(t.join(""));this.monthPicker.on("click",this.onMonthClick,this);this.monthPicker.on("dblclick",this.onMonthDblClick,this);this.mpMonths=this.monthPicker.select("td.x-date-mp-month");this.mpYears=this.monthPicker.select("td.x-date-mp-year");this.mpMonths.each(function(n,t,i){i+=1;n.dom.xmonth=i%2==0?5+Math.round(i*.5):Math.round((i-1)*.5)})}},showMonthPicker:function(){this.createMonthPicker();var n=this.el.getSize();this.monthPicker.setSize(n);this.monthPicker.child("table").setSize(n);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.monthPicker.slideIn("t",{duration:.2})},updateMPYear:function(n){var u,t,r,i;for(this.mpyear=n,u=this.mpYears.elements,t=1;t<=10;t++)r=u[t-1],t%2==0?(i=n+Math.round(t*.5),r.firstChild.innerHTML=i,r.xyear=i):(i=n-(5-Math.round(t*.5)),r.firstChild.innerHTML=i,r.xyear=i),this.mpYears.item(t-1)[i==this.mpSelYear?"addClass":"removeClass"]("x-date-mp-sel")},updateMPMonth:function(n){this.mpMonths.each(function(t){t[t.dom.xmonth==n?"addClass":"removeClass"]("x-date-mp-sel")})},selectMPMonth:function(){},onMonthClick:function(n,t){n.stopEvent();var i=new Ext.Element(t),r;i.is("button.x-date-mp-cancel")?this.hideMonthPicker():i.is("button.x-date-mp-ok")?(this.update(new Date(this.mpSelYear,this.mpSelMonth,(this.activeDate||this.value).getDate())),this.hideMonthPicker()):(r=i.up("td.x-date-mp-month",2))?(this.mpMonths.removeClass("x-date-mp-sel"),r.addClass("x-date-mp-sel"),this.mpSelMonth=r.dom.xmonth):(r=i.up("td.x-date-mp-year",2))?(this.mpYears.removeClass("x-date-mp-sel"),r.addClass("x-date-mp-sel"),this.mpSelYear=r.dom.xyear):i.is("a.x-date-mp-prev")?this.updateMPYear(this.mpyear-10):i.is("a.x-date-mp-next")&&this.updateMPYear(this.mpyear+10)},onMonthDblClick:function(n,t){n.stopEvent();var r=new Ext.Element(t),i;(i=r.up("td.x-date-mp-month",2))?(this.update(new Date(this.mpSelYear,i.dom.xmonth,(this.activeDate||this.value).getDate())),this.hideMonthPicker()):(i=r.up("td.x-date-mp-year",2))&&(this.update(new Date(i.dom.xyear,this.mpSelMonth,(this.activeDate||this.value).getDate())),this.hideMonthPicker())},hideMonthPicker:function(n){this.monthPicker&&(n===!0?this.monthPicker.hide():this.monthPicker.slideOut("t",{duration:.2}))},showPrevMonth:function(){this.update(this.activeDate.add("mo",-1))},showNextMonth:function(){this.update(this.activeDate.add("mo",1))},showPrevYear:function(){this.update(this.activeDate.add("y",-1))},showNextYear:function(){this.update(this.activeDate.add("y",1))},handleMouseWheel:function(n){var t=n.getWheelDelta();t>0?(this.showPrevMonth(),n.stopEvent()):t<0&&(this.showNextMonth(),n.stopEvent())},handleDateClick:function(n,t){n.stopEvent();t.dateValue&&!Ext.fly(t.parentNode).hasClass("x-date-disabled")&&(this.setValue(new Date(t.dateValue)),this.fireEvent("select",this,this.value))},selectToday:function(){this.setValue((new Date).clearTime());this.fireEvent("select",this,this.value)},update:function(n){var o=this.activeDate,l,b,f,e;if(this.activeDate=n,o&&this.el&&(l=n.getTime(),o.getMonth()==n.getMonth()&&o.getFullYear()==n.getFullYear())){this.cells.removeClass("x-date-selected");this.cells.each(function(n){if(n.dom.firstChild.dateValue==l)return n.addClass("x-date-selected"),setTimeout(function(){try{n.dom.firstChild.focus()}catch(t){}},50),!1});return}var a=n.getDaysInMonth(),k=n.getFirstDateOfMonth(),r=k.getDay()-this.startDay;r<=this.startDay&&(r+=7);var s=n.add("mo",-1),v=s.getDaysInMonth()-r,u=this.cells.elements,h=this.textNodes;a+=r;for(var i=new Date(s.getFullYear(),s.getMonth(),v).clearTime(),d=(new Date).clearTime().getTime(),g=n.clearTime().getTime(),nt=this.minDate?this.minDate.clearTime():Number.NEGATIVE_INFINITY,tt=this.maxDate?this.maxDate.clearTime():Number.POSITIVE_INFINITY,y=this.disabledDatesRE,it=this.disabledDatesText,p=this.disabledDays?this.disabledDays.join(""):!1,rt=this.disabledDaysText,w=this.format,c=function(n,t){var r,u;if(t.title="",r=i.getTime(),t.firstChild.dateValue=r,r==d&&(t.className+=" x-date-today",t.title=n.todayText),r==g&&(t.className+=" x-date-selected",setTimeout(function(){try{t.firstChild.focus()}catch(n){}},50)),r<nt){t.className=" x-date-disabled";t.title=n.minText;return}if(r>tt){t.className=" x-date-disabled";t.title=n.maxText;return}p&&p.indexOf(i.getDay())!=-1&&(t.title=rt,t.className=" x-date-disabled");y&&w&&(u=i.dateFormat(w),y.test(u)&&(t.title=it.replace("%0",u),t.className=" x-date-disabled"))},t=0;t<r;t++)h[t].innerHTML=++v,i.setDate(i.getDate()+1),u[t].className="x-date-prevday",c(this,u[t]);for(;t<a;t++)intDay=t-r+1,h[t].innerHTML=intDay,i.setDate(i.getDate()+1),u[t].className="x-date-active",c(this,u[t]);for(b=0;t<42;t++)h[t].innerHTML=++b,i.setDate(i.getDate()+1),u[t].className="x-date-nextday",c(this,u[t]);this.mbtn.setText(this.monthNames[n.getMonth()]+" "+n.getFullYear());this.internalRender||(f=this.el.dom.firstChild,e=f.offsetWidth,this.el.setWidth(e+this.el.getBorderWidth("lr")),Ext.fly(f).setWidth(e),this.internalRender=!0,Ext.isOpera&&!this.secondPass&&(f.rows[0].cells[1].style.width=e-(f.rows[0].cells[0].offsetWidth+f.rows[0].cells[2].offsetWidth)+"px",this.secondPass=!0,this.update.defer(10,this,[n])))},beforeDestroy:function(){this.mbtn.destroy();this.todayBtn.destroy()}});Ext.reg("datepicker",Ext.DatePicker)
Ext.grid.EditorGridPanel=Ext.extend(Ext.grid.GridPanel,{clicksToEdit:2,isEditor:!0,detectEdit:!1,autoEncode:!1,trackMouseOver:!1,initComponent:function(){Ext.grid.EditorGridPanel.superclass.initComponent.call(this);this.selModel||(this.selModel=new Ext.grid.CellSelectionModel);this.activeEditor=null;this.addEvents("beforeedit","afteredit","validateedit")},initEvents:function(){Ext.grid.EditorGridPanel.superclass.initEvents.call(this);this.on("bodyscroll",this.stopEditing,this);if(this.clicksToEdit==1)this.on("cellclick",this.onCellDblClick,this);else{if(this.clicksToEdit=="auto"&&this.view.mainBody)this.view.mainBody.on("mousedown",this.onAutoEditClick,this);this.on("celldblclick",this.onCellDblClick,this)}this.getGridEl().addClass("xedit-grid")},onCellDblClick:function(n,t,i){this.startEditing(t,i)},onAutoEditClick:function(n,t){var i=this.view.findRowIndex(t),r=this.view.findCellIndex(t),u;i!==!1&&r!==!1&&(this.selModel.getSelectedCell?(u=this.selModel.getSelectedCell(),u&&u.cell[0]===i&&u.cell[1]===r&&this.startEditing(i,r)):this.selModel.isSelected(i)&&this.startEditing(i,r))},onEditComplete:function(n,t,i){var u,f,r;this.editing=!1;this.activeEditor=null;n.un("specialkey",this.selModel.onEditorKey,this.selModel);u=n.record;f=this.colModel.getDataIndex(n.col);t=this.postEditValue(t,i,u,f);String(t)!==String(i)&&(r={grid:this,record:u,field:f,originalValue:i,value:t,row:n.row,column:n.col,cancel:!1},this.fireEvent("validateedit",r)===!1||r.cancel||(u.set(f,r.value),delete r.cancel,this.fireEvent("afteredit",r)));this.view.focusCell(n.row,n.col)},startEditing:function(n,t){var i;if(this.stopEditing(),this.colModel.isCellEditable(t,n)){this.view.ensureVisible(n,t,!0);var r=this.store.getAt(n),u=this.colModel.getDataIndex(t),f={grid:this,record:r,field:u,value:r.data[u],row:n,column:t,cancel:!1};this.fireEvent("beforeedit",f)===!1||f.cancel||(this.editing=!0,i=this.colModel.getCellEditor(t,n),i.rendered||i.render(this.view.getEditorParent(i)),function(){i.row=n;i.col=t;i.record=r;i.on("complete",this.onEditComplete,this,{single:!0});i.on("specialkey",this.selModel.onEditorKey,this.selModel);this.activeEditor=i;var f=this.preEditValue(r,u);i.startEdit(this.view.getCell(n,t),f)}.defer(50,this))}},preEditValue:function(n,t){return this.autoEncode?Ext.util.Format.htmlDecode(n.data[t]):n.data[t]},postEditValue:function(n){return this.autoEncode?Ext.util.Format.htmlEncode(n):n},stopEditing:function(){this.activeEditor&&this.activeEditor.completeEdit();this.activeEditor=null}});Ext.reg("editorgrid",Ext.grid.EditorGridPanel)
Ext.ProgressBar=Ext.extend(Ext.BoxComponent,{baseCls:"x-progress",waitTimer:null,initComponent:function(){Ext.ProgressBar.superclass.initComponent.call(this);this.addEvents("update")},onRender:function(n,t){var r,i,u;Ext.ProgressBar.superclass.onRender.call(this,n,t);r=new Ext.Template('<div class="{cls}-wrap">','<div class="{cls}-inner">','<div class="{cls}-bar">','<div class="{cls}-text">',"<div>&#160;<\/div>","<\/div>","<\/div>",'<div class="{cls}-text {cls}-text-back">',"<div>&#160;<\/div>","<\/div>","<\/div>","<\/div>");this.el=t?r.insertBefore(t,{cls:this.baseCls},!0):r.append(n,{cls:this.baseCls},!0);this.id&&(this.el.dom.id=this.id);i=this.el.dom.firstChild;this.progressBar=Ext.get(i.firstChild);this.textEl?(this.textEl=Ext.get(this.textEl),delete this.textTopEl):(this.textTopEl=Ext.get(this.progressBar.dom.firstChild),u=Ext.get(i.childNodes[1]),this.textTopEl.setStyle("z-index",99).addClass("x-hidden"),this.textEl=new Ext.CompositeElement([this.textTopEl.dom.firstChild,u.dom.firstChild]),this.textEl.setWidth(i.offsetWidth));this.value?this.updateProgress(this.value,this.text):this.updateText(this.text);this.setSize(this.width||"auto","auto");this.progressBar.setHeight(i.offsetHeight)},updateProgress:function(n,t){this.value=n||0;t&&this.updateText(t);var i=Math.floor(n*this.el.dom.firstChild.offsetWidth);return this.progressBar.setWidth(i),this.textTopEl&&this.textTopEl.removeClass("x-hidden").setWidth(i),this.fireEvent("update",this,n,t),this},wait:function(n){if(!this.waitTimer){var t=this;n=n||{};this.waitTimer=Ext.TaskMgr.start({run:function(t){var i=n.increment||10;this.updateProgress(((t+i)%i+1)*(100/i)*.01)},interval:n.interval||1e3,duration:n.duration,onStop:function(){n.fn&&n.fn.apply(n.scope||this);this.reset()},scope:t})}return this},isWaiting:function(){return this.waitTimer!=null},updateText:function(n){return this.text=n||"&#160;",this.textEl.update(this.text),this},setSize:function(n,t){if(Ext.ProgressBar.superclass.setSize.call(this,n,t),this.textTopEl){var i=this.el.dom.firstChild;this.textEl.setSize(i.offsetWidth,i.offsetHeight)}return this},reset:function(n){return this.updateProgress(0),this.textTopEl&&this.textTopEl.addClass("x-hidden"),this.waitTimer&&(this.waitTimer.onStop=null,Ext.TaskMgr.stop(this.waitTimer),this.waitTimer=null),n===!0&&this.hide(),this}});Ext.reg("progress",Ext.ProgressBar)
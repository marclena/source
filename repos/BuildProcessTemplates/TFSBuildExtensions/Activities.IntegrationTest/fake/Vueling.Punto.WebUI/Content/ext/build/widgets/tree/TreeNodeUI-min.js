Ext.tree.TreeNodeUI=function(n){this.node=n;this.rendered=!1;this.animating=!1;this.wasLeaf=!0;this.ecc="x-tree-ec-icon x-tree-elbow";this.emptyIcon=Ext.BLANK_IMAGE_URL};Ext.tree.TreeNodeUI.prototype={removeChild:function(n){this.rendered&&this.ctNode.removeChild(n.ui.getEl())},beforeLoad:function(){this.addClass("x-tree-node-loading")},afterLoad:function(){this.removeClass("x-tree-node-loading")},onTextChange:function(n,t){this.rendered&&(this.textNode.innerHTML=t)},onDisableChange:function(n,t){this.disabled=t;this.checkbox&&(this.checkbox.disabled=t);t?this.addClass("x-tree-node-disabled"):this.removeClass("x-tree-node-disabled")},onSelectedChange:function(n){n?(this.focus(),this.addClass("x-tree-selected")):this.removeClass("x-tree-selected")},onMove:function(n,t,i,r,u,f){var e,o;if(this.childIndent=null,this.rendered){if(e=r.ui.getContainer(),!e){this.holder=document.createElement("div");this.holder.appendChild(this.wrap);return}o=f?f.ui.getEl():null;o?e.insertBefore(this.wrap,o):e.appendChild(this.wrap);this.node.renderIndent(!0)}},addClass:function(n){this.elNode&&Ext.fly(this.elNode).addClass(n)},removeClass:function(n){this.elNode&&Ext.fly(this.elNode).removeClass(n)},remove:function(){this.rendered&&(this.holder=document.createElement("div"),this.holder.appendChild(this.wrap))},fireEvent:function(){return this.node.fireEvent.apply(this.node,arguments)},initEvents:function(){this.node.on("move",this.onMove,this);this.node.disabled&&(this.addClass("x-tree-node-disabled"),this.checkbox&&(this.checkbox.disabled=!0));this.node.hidden&&this.hide();var n=this.node.getOwnerTree(),t=n.enableDD||n.enableDrag||n.enableDrop;t&&(!this.node.isRoot||n.rootVisible)&&Ext.dd.Registry.register(this.elNode,{node:this.node,handles:this.getDDHandles(),isHandle:!1})},getDDHandles:function(){return[this.iconNode,this.textNode,this.elNode]},hide:function(){this.node.hidden=!0;this.wrap&&(this.wrap.style.display="none")},show:function(){this.node.hidden=!1;this.wrap&&(this.wrap.style.display="")},onContextMenu:function(n){(this.node.hasListener("contextmenu")||this.node.getOwnerTree().hasListener("contextmenu"))&&(n.preventDefault(),this.focus(),this.fireEvent("contextmenu",this.node,n))},onClick:function(n){if(this.dropping){n.stopEvent();return}if(this.fireEvent("beforeclick",this.node,n)!==!1){var t=n.getTarget("a");if(!this.disabled&&this.node.attributes.href&&t){this.fireEvent("click",this.node,n);return}if(t&&n.ctrlKey&&n.stopEvent(),n.preventDefault(),this.disabled)return;this.node.attributes.singleClickExpand&&!this.animating&&this.node.hasChildNodes()&&this.node.toggle();this.fireEvent("click",this.node,n)}else n.stopEvent()},onDblClick:function(n){(n.preventDefault(),this.disabled)||(this.checkbox&&this.toggleCheck(),!this.animating&&this.node.hasChildNodes()&&this.node.toggle(),this.fireEvent("dblclick",this.node,n))},onOver:function(){this.addClass("x-tree-node-over")},onOut:function(){this.removeClass("x-tree-node-over")},onCheckChange:function(){var n=this.checkbox.checked;this.node.attributes.checked=n;this.fireEvent("checkchange",this.node,n)},ecClick:function(){!this.animating&&(this.node.hasChildNodes()||this.node.attributes.expandable)&&this.node.toggle()},startDrop:function(){this.dropping=!0},endDrop:function(){setTimeout(function(){this.dropping=!1}.createDelegate(this),50)},expand:function(){this.updateExpandIcon();this.ctNode.style.display=""},focus:function(){if(this.node.preventHScroll){if(!Ext.isIE)try{var n=this.node.getOwnerTree().getTreeEl().dom,t=n.scrollLeft;this.anchor.focus();n.scrollLeft=t}catch(i){}}else try{this.anchor.focus()}catch(i){}},toggleCheck:function(n){var t=this.checkbox;t&&(t.checked=n===undefined?!t.checked:n)},blur:function(){try{this.anchor.blur()}catch(n){}},animExpand:function(n){var t=Ext.get(this.ctNode);if(t.stopFx(),!this.node.hasChildNodes()){this.updateExpandIcon();this.ctNode.style.display="";Ext.callback(n);return}this.animating=!0;this.updateExpandIcon();t.slideIn("t",{callback:function(){this.animating=!1;Ext.callback(n)},scope:this,duration:this.node.ownerTree.duration||.25})},highlight:function(){var n=this.node.getOwnerTree();Ext.fly(this.wrap).highlight(n.hlColor||"C3DAF9",{endColor:n.hlBaseColor})},collapse:function(){this.updateExpandIcon();this.ctNode.style.display="none"},animCollapse:function(n){var t=Ext.get(this.ctNode);t.enableDisplayMode("block");t.stopFx();this.animating=!0;this.updateExpandIcon();t.slideOut("t",{callback:function(){this.animating=!1;Ext.callback(n)},scope:this,duration:this.node.ownerTree.duration||.25})},getContainer:function(){return this.ctNode},getEl:function(){return this.wrap},appendDDGhost:function(n){n.appendChild(this.elNode.cloneNode(!0))},getDDRepairXY:function(){return Ext.lib.Dom.getXY(this.iconNode)},onRender:function(){this.render()},render:function(n){var i=this.node,t=i.attributes,r=i.parentNode?i.parentNode.ui.getContainer():i.ownerTree.innerCt.dom;this.rendered?n===!0&&r.appendChild(this.wrap):(this.rendered=!0,this.renderElements(i,t,r,n),t.qtip?this.textNode.setAttributeNS?(this.textNode.setAttributeNS("ext","qtip",t.qtip),t.qtipTitle&&this.textNode.setAttributeNS("ext","qtitle",t.qtipTitle)):(this.textNode.setAttribute("ext:qtip",t.qtip),t.qtipTitle&&this.textNode.setAttribute("ext:qtitle",t.qtipTitle)):t.qtipCfg&&(t.qtipCfg.target=Ext.id(this.textNode),Ext.QuickTips.register(t.qtipCfg)),this.initEvents(),this.node.expanded||this.updateExpandIcon(!0))},renderElements:function(n,t,i,r){var u,f;this.indentMarkup=n.parentNode?n.parentNode.ui.getChildIndent():"";var e=typeof t.checked=="boolean",h=t.href?t.href:Ext.isGecko?"":"#",o=['<li class="x-tree-node"><div ext:tree-node-id="',n.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',t.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"<\/span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',t.icon||this.emptyIcon,'" class="x-tree-node-icon',t.icon?" x-tree-node-inline-icon":"",t.iconCls?" "+t.iconCls:"",'" unselectable="on" />',e?'<input class="x-tree-node-cb" type="checkbox" '+(t.checked?'checked="checked" />':"/>"):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',h,'" tabIndex="1" ',t.hrefTarget?' target="'+t.hrefTarget+'"':"",'><span unselectable="on">',n.text,"<\/span><\/a><\/div>",'<ul class="x-tree-node-ct" style="display:none;"><\/ul>',"<\/li>"].join(""),s;this.wrap=r!==!0&&n.nextSibling&&(s=n.nextSibling.ui.getEl())?Ext.DomHelper.insertHtml("beforeBegin",s,o):Ext.DomHelper.insertHtml("beforeEnd",i,o);this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];u=this.elNode.childNodes;this.indentNode=u[0];this.ecNode=u[1];this.iconNode=u[2];f=3;e&&(this.checkbox=u[3],f++);this.anchor=u[f];this.textNode=u[f].firstChild},getAnchor:function(){return this.anchor},getTextEl:function(){return this.textNode},getIconEl:function(){return this.iconNode},isChecked:function(){return this.checkbox?this.checkbox.checked:!1},updateExpandIcon:function(){var r;if(this.rendered){var i=this.node,n,t,u=i.isLast()?"x-tree-elbow-end":"x-tree-elbow",f=i.hasChildNodes();f||i.attributes.expandable?(i.expanded?(u+="-minus",n="x-tree-node-collapsed",t="x-tree-node-expanded"):(u+="-plus",n="x-tree-node-expanded",t="x-tree-node-collapsed"),this.wasLeaf&&(this.removeClass("x-tree-node-leaf"),this.wasLeaf=!1),(this.c1!=n||this.c2!=t)&&(Ext.fly(this.elNode).replaceClass(n,t),this.c1=n,this.c2=t)):this.wasLeaf||(Ext.fly(this.elNode).replaceClass("x-tree-node-expanded","x-tree-node-leaf"),delete this.c1,delete this.c2,this.wasLeaf=!0);r="x-tree-ec-icon "+u;this.ecc!=r&&(this.ecNode.className=r,this.ecc=r)}},getChildIndent:function(){if(!this.childIndent){for(var t=[],n=this.node;n;)(!n.isRoot||n.isRoot&&n.ownerTree.rootVisible)&&(n.isLast()?t.unshift('<img src="'+this.emptyIcon+'" class="x-tree-icon" />'):t.unshift('<img src="'+this.emptyIcon+'" class="x-tree-elbow-line" />')),n=n.parentNode;this.childIndent=t.join("")}return this.childIndent},renderIndent:function(){if(this.rendered){var n="",t=this.node.parentNode;t&&(n=t.ui.getChildIndent());this.indentMarkup!=n&&(this.indentNode.innerHTML=n,this.indentMarkup=n);this.updateExpandIcon()}},destroy:function(){this.elNode&&Ext.dd.Registry.unregister(this.elNode.id);delete this.elNode;delete this.ctNode;delete this.indentNode;delete this.ecNode;delete this.iconNode;delete this.checkbox;delete this.anchor;delete this.textNode;Ext.removeNode(this.ctNode)}};Ext.tree.RootTreeNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{render:function(){if(!this.rendered){var n=this.node.ownerTree.innerCt.dom;this.node.expanded=!0;n.innerHTML='<div class="x-tree-root-node"><\/div>';this.wrap=this.ctNode=n.firstChild}},collapse:Ext.emptyFn,expand:Ext.emptyFn})
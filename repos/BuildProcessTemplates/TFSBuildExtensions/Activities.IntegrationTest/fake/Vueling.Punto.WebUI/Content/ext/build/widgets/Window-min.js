Ext.Window=Ext.extend(Ext.Panel,{baseCls:"x-window",resizable:!0,draggable:!0,closable:!0,constrain:!1,constrainHeader:!1,plain:!1,minimizable:!1,maximizable:!1,minHeight:100,minWidth:200,expandOnShow:!0,closeAction:"close",collapsible:!1,initHidden:!0,monitorResize:!0,elements:"header,body",frame:!0,floating:!0,initComponent:function(){Ext.Window.superclass.initComponent.call(this);this.addEvents("resize","maximize","minimize","restore")},getState:function(){return Ext.apply(Ext.Window.superclass.getState.call(this)||{},this.getBox())},onRender:function(n,t){Ext.Window.superclass.onRender.call(this,n,t);this.plain&&this.el.addClass("x-window-plain");this.focusEl=this.el.createChild({tag:"a",href:"#",cls:"x-dlg-focus",tabIndex:"-1",html:"&#160;"});this.focusEl.swallowEvent("click",!0);this.proxy=this.el.createProxy("x-window-proxy");this.proxy.enableDisplayMode("block");this.modal&&(this.mask=this.container.createChild({cls:"ext-el-mask"},this.el.dom),this.mask.enableDisplayMode("block"),this.mask.hide())},initEvents:function(){if(Ext.Window.superclass.initEvents.call(this),this.animateTarget&&this.setAnimateTarget(this.animateTarget),this.resizable){this.resizer=new Ext.Resizable(this.el,{minWidth:this.minWidth,minHeight:this.minHeight,handles:this.resizeHandles||"all",pinned:!0,resizeElement:this.resizerAction});this.resizer.window=this;this.resizer.on("beforeresize",this.beforeResize,this)}this.draggable&&this.header.addClass("x-window-draggable");this.initTools();this.el.on("mousedown",this.toFront,this);if(this.manager=this.manager||Ext.WindowMgr,this.manager.register(this),this.hidden=!0,this.maximized&&(this.maximized=!1,this.maximize()),this.closable){var n=this.getKeyMap();n.on(27,this.onEsc,this);n.disable()}},initDraggable:function(){this.dd=new Ext.Window.DD(this)},onEsc:function(){this[this.closeAction]()},beforeDestroy:function(){Ext.destroy(this.resizer,this.dd,this.proxy,this.mask);Ext.Window.superclass.beforeDestroy.call(this)},onDestroy:function(){this.manager&&this.manager.unregister(this);Ext.Window.superclass.onDestroy.call(this)},initTools:function(){if(this.minimizable&&this.addTool({id:"minimize",handler:this.minimize.createDelegate(this,[])}),this.maximizable){this.addTool({id:"maximize",handler:this.maximize.createDelegate(this,[])});this.addTool({id:"restore",handler:this.restore.createDelegate(this,[]),hidden:!0});this.header.on("dblclick",this.toggleMaximize,this)}this.closable&&this.addTool({id:"close",handler:this[this.closeAction].createDelegate(this,[])})},resizerAction:function(){var n=this.proxy.getBox();return this.proxy.hide(),this.window.handleResize(n),n},beforeResize:function(){this.resizer.minHeight=Math.max(this.minHeight,this.getFrameHeight()+40);this.resizer.minWidth=Math.max(this.minWidth,this.getFrameWidth()+40);this.resizeBox=this.el.getBox()},updateHandles:function(){Ext.isIE&&this.resizer&&(this.resizer.syncHandleHeight(),this.el.repaint())},handleResize:function(n){var t=this.resizeBox;t.x!=n.x||t.y!=n.y?this.updateBox(n):this.setSize(n);this.focus();this.updateHandles();this.saveState();this.fireEvent("resize",this,n.width,n.height)},focus:function(){var t=this.focusEl,n=this.defaultButton,i=typeof n;i!="undefined"&&(t=i=="number"?this.buttons[n]:i=="string"?Ext.getCmp(n):n);t.focus.defer(10,t)},setAnimateTarget:function(n){n=Ext.get(n);this.animateTarget=n},beforeShow:function(){if(delete this.el.lastXY,delete this.el.lastLT,this.x===undefined||this.y===undefined){var n=this.el.getAlignToXY(this.container,"c-c"),t=this.el.translatePoints(n[0],n[1]);this.x=this.x===undefined?t.left:this.x;this.y=this.y===undefined?t.top:this.y}this.el.setLeftTop(this.x,this.y);this.expandOnShow&&this.expand(!1);this.modal&&(Ext.getBody().addClass("x-body-masked"),this.mask.setSize(Ext.lib.Dom.getViewWidth(!0),Ext.lib.Dom.getViewHeight(!0)),this.mask.show())},show:function(n,t,i){if(this.rendered||this.render(Ext.getBody()),this.hidden===!1){this.toFront();return}if(this.fireEvent("beforeshow",this)!==!1){if(t)this.on("show",t,i,{single:!0});this.hidden=!1;n!==undefined&&this.setAnimateTarget(n);this.beforeShow();this.animateTarget?this.animShow():this.afterShow()}},afterShow:function(){if(this.proxy.hide(),this.el.setStyle("display","block"),this.el.show(),this.maximized&&this.fitContainer(),Ext.isMac&&Ext.isGecko&&this.cascade(this.setAutoScroll),this.monitorResize||this.modal||this.constrain||this.constrainHeader)Ext.EventManager.onWindowResize(this.onWindowResize,this);this.doConstrain();this.layout&&this.doLayout();this.keyMap&&this.keyMap.enable();this.toFront();this.updateHandles();this.fireEvent("show",this)},animShow:function(){this.proxy.show();this.proxy.setBox(this.animateTarget.getBox());this.proxy.setOpacity(0);var n=this.getBox(!1);n.callback=this.afterShow;n.scope=this;n.duration=.25;n.easing="easeNone";n.opacity=.5;n.block=!0;this.el.setStyle("display","none");this.proxy.shift(n)},hide:function(n,t,i){if(!this.hidden&&this.fireEvent("beforehide",this)!==!1){if(t)this.on("hide",t,i,{single:!0});this.hidden=!0;n!==undefined&&this.setAnimateTarget(n);this.animateTarget?this.animHide():(this.el.hide(),this.afterHide())}},afterHide:function(){this.proxy.hide();(this.monitorResize||this.modal||this.constrain||this.constrainHeader)&&Ext.EventManager.removeResizeListener(this.onWindowResize,this);this.modal&&(this.mask.hide(),Ext.getBody().removeClass("x-body-masked"));this.keyMap&&this.keyMap.disable();this.fireEvent("hide",this)},animHide:function(){var t,n;this.proxy.setOpacity(.5);this.proxy.show();t=this.getBox(!1);this.proxy.setBox(t);this.el.hide();n=this.animateTarget.getBox();n.callback=this.afterHide;n.scope=this;n.duration=.25;n.easing="easeNone";n.block=!0;n.opacity=0;this.proxy.shift(n)},onWindowResize:function(){if(this.maximized&&this.fitContainer(),this.modal){this.mask.setSize("100%","100%");var n=this.mask.dom.offsetHeight;this.mask.setSize(Ext.lib.Dom.getViewWidth(!0),Ext.lib.Dom.getViewHeight(!0))}this.doConstrain()},doConstrain:function(){var t,i,n;(this.constrain||this.constrainHeader)&&(this.constrain?t={right:this.el.shadowOffset,left:this.el.shadowOffset,bottom:this.el.shadowOffset}:(i=this.getSize(),t={right:-(i.width-100),bottom:-(i.height-25)}),n=this.el.getConstrainToXY(this.container,!0,t),n&&this.setPosition(n[0],n[1]))},ghost:function(n){var t=this.createGhost(n),i=this.getBox(!0);return t.setLeftTop(i.x,i.y),t.setWidth(i.width),this.el.hide(),this.activeGhost=t,t},unghost:function(n,t){n!==!1&&(this.el.show(),this.focus(),Ext.isMac&&Ext.isGecko&&this.cascade(this.setAutoScroll));t!==!1&&this.setPosition(this.activeGhost.getLeft(!0),this.activeGhost.getTop(!0));this.activeGhost.hide();this.activeGhost.remove();delete this.activeGhost},minimize:function(){this.fireEvent("minimize",this)},close:function(){this.fireEvent("beforeclose",this)!==!1&&this.hide(null,function(){this.fireEvent("close",this);this.destroy()},this)},maximize:function(){this.maximized||(this.expand(!1),this.restoreSize=this.getSize(),this.restorePos=this.getPosition(!0),this.tools.maximize.hide(),this.tools.restore.show(),this.maximized=!0,this.el.disableShadow(),this.dd&&this.dd.lock(),this.collapsible&&this.tools.toggle.hide(),this.el.addClass("x-window-maximized"),this.container.addClass("x-window-maximized-ct"),this.setPosition(0,0),this.fitContainer(),this.fireEvent("maximize",this))},restore:function(){this.maximized&&(this.el.removeClass("x-window-maximized"),this.tools.restore.hide(),this.tools.maximize.show(),this.setPosition(this.restorePos[0],this.restorePos[1]),this.setSize(this.restoreSize.width,this.restoreSize.height),delete this.restorePos,delete this.restoreSize,this.maximized=!1,this.el.enableShadow(!0),this.dd&&this.dd.unlock(),this.collapsible&&this.tools.toggle.show(),this.container.removeClass("x-window-maximized-ct"),this.doConstrain(),this.fireEvent("restore",this))},toggleMaximize:function(){this[this.maximized?"restore":"maximize"]()},fitContainer:function(){var n=this.container.getViewSize();this.setSize(n.width,n.height)},setZIndex:function(n){this.modal&&this.mask.setStyle("z-index",n);this.el.setZIndex(++n);n+=5;this.resizer&&this.resizer.proxy.setStyle("z-index",++n);this.lastZIndex=n},alignTo:function(n,t,i){var r=this.el.getAlignToXY(n,t,i);return this.setPagePosition(r[0],r[1]),this},anchorTo:function(n,t,i,r,u){var f=function(){this.alignTo(n,t,i)},e;Ext.EventManager.onWindowResize(f,this);if(e=typeof r,e!="undefined")Ext.EventManager.on(window,"scroll",f,this,{buffer:e=="number"?r:50});return f.call(this),this[u]=f,this},toFront:function(){return this.manager.bringToFront(this)&&this.focus(),this},setActive:function(n){n?(this.maximized||this.el.enableShadow(!0),this.fireEvent("activate",this)):(this.el.disableShadow(),this.fireEvent("deactivate",this))},toBack:function(){return this.manager.sendToBack(this),this},center:function(){var n=this.el.getAlignToXY(this.container,"c-c");return this.setPagePosition(n[0],n[1]),this}});Ext.reg("window",Ext.Window);Ext.Window.DD=function(n){this.win=n;Ext.Window.DD.superclass.constructor.call(this,n.el.id,"WindowDD-"+n.id);this.setHandleElId(n.header.id);this.scroll=!1};Ext.extend(Ext.Window.DD,Ext.dd.DD,{moveOnly:!0,headerOffsets:[100,25],startDrag:function(){var n=this.win,t,i;this.proxy=n.ghost();n.constrain!==!1?(t=n.el.shadowOffset,this.constrainTo(n.container,{right:t,left:t,bottom:t})):n.constrainHeader!==!1&&(i=this.proxy.getSize(),this.constrainTo(n.container,{right:-(i.width-this.headerOffsets[0]),bottom:-(i.height-this.headerOffsets[1])}))},b4Drag:Ext.emptyFn,onDrag:function(n){this.alignElWithMouse(this.proxy,n.getPageX(),n.getPageY())},endDrag:function(){this.win.unghost();this.win.saveState()}})
Ext.data.Store=function(n){this.data=new Ext.util.MixedCollection(!1);this.data.getKey=function(n){return n.id};this.baseParams={};this.paramNames={start:"start",limit:"limit",sort:"sort",dir:"dir"};n&&n.data&&(this.inlineData=n.data,delete n.data);Ext.apply(this,n);this.url&&!this.proxy&&(this.proxy=new Ext.data.HttpProxy({url:this.url}));this.reader&&(this.recordType||(this.recordType=this.reader.recordType),this.reader.onMetaChange&&(this.reader.onMetaChange=this.onMetaChange.createDelegate(this)));this.recordType&&(this.fields=this.recordType.prototype.fields);this.modified=[];this.addEvents("datachanged","metachange","add","remove","update","clear","beforeload","load","loadexception");this.proxy&&this.relayEvents(this.proxy,["loadexception"]);this.sortToggle={};this.sortInfo&&this.setDefaultSort(this.sortInfo.field,this.sortInfo.direction);Ext.data.Store.superclass.constructor.call(this);(this.storeId||this.id)&&Ext.StoreMgr.register(this);this.inlineData?(this.loadData(this.inlineData),delete this.inlineData):this.autoLoad&&this.load.defer(10,this,[typeof this.autoLoad=="object"?this.autoLoad:undefined])};Ext.extend(Ext.data.Store,Ext.util.Observable,{remoteSort:!1,pruneModifiedRecords:!1,lastOptions:null,destroy:function(){this.id&&Ext.StoreMgr.unregister(this);this.data=null;this.purgeListeners()},add:function(n){var t,i,r;if(n=[].concat(n),!(n.length<1)){for(t=0,i=n.length;t<i;t++)n[t].join(this);r=this.data.length;this.data.addAll(n);this.snapshot&&this.snapshot.addAll(n);this.fireEvent("add",this,n,r)}},addSorted:function(n){var t=this.findInsertIndex(n);this.insert(t,n)},remove:function(n){var t=this.data.indexOf(n);this.data.removeAt(t);this.pruneModifiedRecords&&this.modified.remove(n);this.snapshot&&this.snapshot.remove(n);this.fireEvent("remove",this,n,t)},removeAll:function(){this.data.clear();this.snapshot&&this.snapshot.clear();this.pruneModifiedRecords&&(this.modified=[]);this.fireEvent("clear",this)},insert:function(n,t){t=[].concat(t);for(var i=0,r=t.length;i<r;i++)this.data.insert(n,t[i]),t[i].join(this);this.fireEvent("add",this,t,n)},indexOf:function(n){return this.data.indexOf(n)},indexOfId:function(n){return this.data.indexOfKey(n)},getById:function(n){return this.data.key(n)},getAt:function(n){return this.data.itemAt(n)},getRange:function(n,t){return this.data.getRange(n,t)},storeOptions:function(n){n=Ext.apply({},n);delete n.callback;delete n.scope;this.lastOptions=n},load:function(n){var t,i;return n=n||{},this.fireEvent("beforeload",this,n)!==!1?(this.storeOptions(n),t=Ext.apply(n.params||{},this.baseParams),this.sortInfo&&this.remoteSort&&(i=this.paramNames,t[i.sort]=this.sortInfo.field,t[i.dir]=this.sortInfo.direction),this.proxy.load(t,this.reader,this.loadRecords,this,n),!0):!1},reload:function(n){this.load(Ext.applyIf(n||{},this.lastOptions))},loadRecords:function(n,t,i){var r,f,u,e;if(!n||i===!1){i!==!1&&this.fireEvent("load",this,[],t);t.callback&&t.callback.call(t.scope||this,[],t,!1);return}if(r=n.records,f=n.totalRecords||r.length,t&&t.add===!0)this.totalLength=Math.max(f,this.data.length+r.length),this.add(r);else{for(this.pruneModifiedRecords&&(this.modified=[]),u=0,e=r.length;u<e;u++)r[u].join(this);this.snapshot&&(this.data=this.snapshot,delete this.snapshot);this.data.clear();this.data.addAll(r);this.totalLength=f;this.applySort();this.fireEvent("datachanged",this)}this.fireEvent("load",this,r,t);t.callback&&t.callback.call(t.scope||this,r,t,!0)},loadData:function(n,t){var i=this.reader.readRecords(n);this.loadRecords(i,{add:t},!0)},getCount:function(){return this.data.length||0},getTotalCount:function(){return this.totalLength||0},getSortState:function(){return this.sortInfo},applySort:function(){if(this.sortInfo&&!this.remoteSort){var n=this.sortInfo,t=n.field;this.sortData(t,n.direction)}},sortData:function(n,t){t=t||"ASC";var i=this.fields.get(n).sortType,r=function(t,r){var u=i(t.data[n]),f=i(r.data[n]);return u>f?1:u<f?-1:0};this.data.sort(t,r);this.snapshot&&this.snapshot!=this.data&&this.snapshot.sort(t,r)},setDefaultSort:function(n,t){t=t?t.toUpperCase():"ASC";this.sortInfo={field:n,direction:t};this.sortToggle[n]=t},sort:function(n,t){var i=this.fields.get(n),r,u;if(!i)return!1;t||(t=this.sortInfo&&this.sortInfo.field==i.name?(this.sortToggle[i.name]||"ASC").toggle("ASC","DESC"):i.sortDir);r=this.sortToggle?this.sortToggle[i.name]:null;u=this.sortInfo?this.sortInfo:null;this.sortToggle[i.name]=t;this.sortInfo={field:i.name,direction:t};this.remoteSort?this.load(this.lastOptions)||(r&&(this.sortToggle[i.name]=r),u&&(this.sortInfo=u)):(this.applySort(),this.fireEvent("datachanged",this))},each:function(n,t){this.data.each(n,t)},getModifiedRecords:function(){return this.modified},createFilterFn:function(n,t,i,r){return Ext.isEmpty(t,!1)?!1:(t=this.data.createValueMatcher(t,i,r),function(i){return t.test(i.data[n])})},sum:function(n,t,i){var u=this.data.items,f=0,r;for(t=t||0,i=i||i===0?i:u.length-1,r=t;r<=i;r++)f+=u[r].data[n]||0;return f},filter:function(n,t,i,r){var u=this.createFilterFn(n,t,i,r);return u?this.filterBy(u):this.clearFilter()},filterBy:function(n,t){this.snapshot=this.snapshot||this.data;this.data=this.queryBy(n,t||this);this.fireEvent("datachanged",this)},query:function(n,t,i,r){var u=this.createFilterFn(n,t,i,r);return u?this.queryBy(u):this.data.clone()},queryBy:function(n,t){var i=this.snapshot||this.data;return i.filterBy(n,t||this)},find:function(n,t,i,r,u){var f=this.createFilterFn(n,t,r,u);return f?this.data.findIndexBy(f,null,i):-1},findBy:function(n,t,i){return this.data.findIndexBy(n,t,i)},collect:function(n,t,i){for(var o=i===!0&&this.snapshot?this.snapshot.items:this.data.items,r,u,f=[],s={},e=0,h=o.length;e<h;e++)r=o[e].data[n],u=String(r),!t&&Ext.isEmpty(r)||s[u]||(s[u]=!0,f[f.length]=r);return f},clearFilter:function(n){this.isFiltered()&&(this.data=this.snapshot,delete this.snapshot,n!==!0&&this.fireEvent("datachanged",this))},isFiltered:function(){return this.snapshot&&this.snapshot!=this.data},afterEdit:function(n){this.modified.indexOf(n)==-1&&this.modified.push(n);this.fireEvent("update",this,n,Ext.data.Record.EDIT)},afterReject:function(n){this.modified.remove(n);this.fireEvent("update",this,n,Ext.data.Record.REJECT)},afterCommit:function(n){this.modified.remove(n);this.fireEvent("update",this,n,Ext.data.Record.COMMIT)},commitChanges:function(){var t=this.modified.slice(0),n,i;for(this.modified=[],n=0,i=t.length;n<i;n++)t[n].commit()},rejectChanges:function(){var t=this.modified.slice(0),n,i;for(this.modified=[],n=0,i=t.length;n<i;n++)t[n].reject()},onMetaChange:function(n,t){this.recordType=t;this.fields=t.prototype.fields;delete this.snapshot;this.sortInfo=n.sortInfo;this.modified=[];this.fireEvent("metachange",this,this.reader.meta)},findInsertIndex:function(n){var t,i;return this.suspendEvents(),t=this.data.clone(),this.data.add(n),this.applySort(),i=this.data.indexOf(n),this.data=t,this.resumeEvents(),i}})
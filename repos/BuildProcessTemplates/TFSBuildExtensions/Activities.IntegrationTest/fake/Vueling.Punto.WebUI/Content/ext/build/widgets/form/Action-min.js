Ext.form.Action=function(n,t){this.form=n;this.options=t||{}};Ext.form.Action.CLIENT_INVALID="client";Ext.form.Action.SERVER_INVALID="server";Ext.form.Action.CONNECT_FAILURE="connect";Ext.form.Action.LOAD_FAILURE="load";Ext.form.Action.prototype={type:"default",run:function(){},success:function(){},handleResponse:function(){},failure:function(n){this.response=n;this.failureType=Ext.form.Action.CONNECT_FAILURE;this.form.afterAction(this,!1)},processResponse:function(n){return(this.response=n,!n.responseText)?!0:(this.result=this.handleResponse(n),this.result)},getUrl:function(n){var t=this.options.url||this.form.url||this.form.el.dom.action,i;return n&&(i=this.getParams(),i&&(t+=(t.indexOf("?")!=-1?"&":"?")+i)),t},getMethod:function(){return(this.options.method||this.form.method||this.form.el.dom.method||"POST").toUpperCase()},getParams:function(){var t=this.form.baseParams,n=this.options.params;return n?typeof n=="object"?n=Ext.urlEncode(Ext.applyIf(n,t)):typeof n=="string"&&t&&(n+="&"+Ext.urlEncode(t)):t&&(n=Ext.urlEncode(t)),n},createCallback:function(n){var n=n||{};return{success:this.success,failure:this.failure,scope:this,timeout:n.timeout*1e3||this.form.timeout*1e3,upload:this.form.fileUpload?this.success:undefined}}};Ext.form.Action.Submit=function(n,t){Ext.form.Action.Submit.superclass.constructor.call(this,n,t)};Ext.extend(Ext.form.Action.Submit,Ext.form.Action,{type:"submit",run:function(){var n=this.options,t=this.getMethod(),i=t=="POST";n.clientValidation===!1||this.form.isValid()?Ext.Ajax.request(Ext.apply(this.createCallback(n),{form:this.form.el.dom,url:this.getUrl(!i),method:t,params:i?this.getParams():null,isUpload:this.form.fileUpload})):n.clientValidation!==!1&&(this.failureType=Ext.form.Action.CLIENT_INVALID,this.form.afterAction(this,!1))},success:function(n){var t=this.processResponse(n);if(t===!0||t.success){this.form.afterAction(this,!0);return}t.errors&&(this.form.markInvalid(t.errors),this.failureType=Ext.form.Action.SERVER_INVALID);this.form.afterAction(this,!1)},handleResponse:function(n){var t,i,r,u,f;if(this.form.errorReader){if(t=this.form.errorReader.read(n),i=[],t.records)for(r=0,u=t.records.length;r<u;r++)f=t.records[r],i[r]=f.data;return i.length<1&&(i=null),{success:t.success,errors:i}}return Ext.decode(n.responseText)}});Ext.form.Action.Load=function(n,t){Ext.form.Action.Load.superclass.constructor.call(this,n,t);this.reader=this.form.reader};Ext.extend(Ext.form.Action.Load,Ext.form.Action,{type:"load",run:function(){Ext.Ajax.request(Ext.apply(this.createCallback(this.options),{method:this.getMethod(),url:this.getUrl(!1),params:this.getParams()}))},success:function(n){var t=this.processResponse(n);if(t===!0||!t.success||!t.data){this.failureType=Ext.form.Action.LOAD_FAILURE;this.form.afterAction(this,!1);return}this.form.clearInvalid();this.form.setValues(t.data);this.form.afterAction(this,!0)},handleResponse:function(n){if(this.form.reader){var t=this.form.reader.read(n),i=t.records&&t.records[0]?t.records[0].data:null;return{success:t.success,data:i}}return Ext.decode(n.responseText)}});Ext.form.Action.ACTION_TYPES={load:Ext.form.Action.Load,submit:Ext.form.Action.Submit}
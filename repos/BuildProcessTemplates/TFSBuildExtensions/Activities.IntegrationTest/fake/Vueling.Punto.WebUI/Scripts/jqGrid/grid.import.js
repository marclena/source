(function(n){n.jgrid.extend({jqGridImport:function(t){return t=n.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},t||{}),this.each(function(){var r=this,u=function(t,i){var s=n(i.xmlGrid.config,t)[0],h=n(i.xmlGrid.data,t)[0],u,f,e,o;if(xmlJsonClass.xml2json&&n.jgrid.parse){u=xmlJsonClass.xml2json(s," ");u=n.jgrid.parse(u);for(e in u)u.hasOwnProperty(e)&&(f=u[e]);h?(o=u.grid.datatype,u.grid.datatype="xmlstring",u.grid.datastr=t,n(r).jqGrid(f).jqGrid("setGridParam",{datatype:o})):n(r).jqGrid(f);u=null;f=null}else alert("xml2json or parse are not present")},f=function(t,i){var o;if(t&&typeof t=="string"){var f=n.jgrid.parse(t),u=f[i.jsonGrid.config],e=f[i.jsonGrid.data];e?(o=u.datatype,u.datatype="jsonstring",u.datastr=e,n(r).jqGrid(u).jqGrid("setGridParam",{datatype:o})):n(r).jqGrid(u)}},i;switch(t.imptype){case"xml":n.ajax(n.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"xml",complete:function(i,r){r=="success"&&(u(i.responseXML,t),n.isFunction(t.importComplete)&&t.importComplete(i));i=null}},t.ajaxOptions));break;case"xmlstring":t.impstring&&typeof t.impstring=="string"&&(i=n.jgrid.stringToDoc(t.impstring),i&&(u(i,t),n.isFunction(t.importComplete)&&t.importComplete(i),t.impstring=null),i=null);break;case"json":n.ajax(n.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"json",complete:function(i,r){r=="success"&&(f(i.responseText,t),n.isFunction(t.importComplete)&&t.importComplete(i));i=null}},t.ajaxOptions));break;case"jsonstring":t.impstring&&typeof t.impstring=="string"&&(f(t.impstring,t),n.isFunction(t.importComplete)&&t.importComplete(t.impstring),t.impstring=null)}})},jqGridExport:function(t){t=n.extend({exptype:"xmlstring",root:"grid",ident:"\t"},t||{});var i=null;return this.each(function(){var r,u;if(this.grid){if(r=n.extend({},n(this).jqGrid("getGridParam")),r.rownumbers&&(r.colNames.splice(0,1),r.colModel.splice(0,1)),r.multiselect&&(r.colNames.splice(0,1),r.colModel.splice(0,1)),r.subGrid&&(r.colNames.splice(0,1),r.colModel.splice(0,1)),r.knv=null,r.treeGrid)for(u in r.treeReader)r.treeReader.hasOwnProperty(u)&&(r.colNames.splice(r.colNames.length-1),r.colModel.splice(r.colModel.length-1));switch(t.exptype){case"xmlstring":i="<"+t.root+">"+xmlJsonClass.json2xml(r,t.ident)+"<\/"+t.root+">";break;case"jsonstring":i="{"+xmlJsonClass.toJson(r,t.root,t.ident)+"}";r.postData.filters!==undefined&&(i=i.replace(/filters":"/,'filters":'),i=i.replace(/}]}"/,"}]}"))}}}),i},excelExport:function(t){return t=n.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},t||{}),this.each(function(){var u,i,r;this.grid&&t.exptype=="remote"&&(i=n.extend({},this.p.postData),i[t.oper]=t.tag,r=jQuery.param(i),u=t.url.indexOf("?")!=-1?t.url+"&"+r:t.url+"?"+r,window.location=u)})}})})(jQuery)
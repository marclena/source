(function(n){if(n.browser.msie&&n.browser.version==8&&(n.expr[":"].hidden=function(n){return n.offsetWidth===0||n.offsetHeight===0||n.style.display=="none"}),n.jgrid._multiselect=!1,n.ui&&n.ui.multiselect){if(n.ui.multiselect.prototype._setSelected){var t=n.ui.multiselect.prototype._setSelected;n.ui.multiselect.prototype._setSelected=function(i,r){var f=t.call(this,i,r),u;return r&&this.selectedList&&(u=this.element,this.selectedList.find("li").each(function(){n(this).data("optionLink")&&n(this).data("optionLink").remove().appendTo(u)})),f}}n.ui.multiselect.prototype.destroy&&(n.ui.multiselect.prototype.destroy=function(){this.element.show();this.container.remove();n.Widget===undefined?n.widget.prototype.destroy.apply(this,arguments):n.Widget.prototype.destroy.apply(this,arguments)});n.jgrid._multiselect=!0}n.jgrid.extend({sortableColumns:function(t){return this.each(function(){function u(){i.p.disableClick=!0}var i=this,r={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_cb,#jqgh_rn,#jqgh_subgrid),:hidden)",placeholder:{element:function(t){return n(document.createElement(t[0].nodeName)).addClass(t[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(n,t){t.height(n.currentItem.innerHeight()-parseInt(n.currentItem.css("paddingTop")||0,10)-parseInt(n.currentItem.css("paddingBottom")||0,10));t.width(n.currentItem.innerWidth()-parseInt(n.currentItem.css("paddingLeft")||0,10)-parseInt(n.currentItem.css("paddingRight")||0,10))}},update:function(t,r){var e=n(r.item).parent(),o=n(">th",e),s=i.p.colModel,f={},u;n.each(s,function(n){f[this.name]=n});u=[];o.each(function(){var t=n(">div",this).get(0).id.replace(/^jqgh_/,"");t in f&&u.push(f[t])});n(i).jqGrid("remapColumns",u,!0,!0);n.isFunction(i.p.sortable.update)&&i.p.sortable.update(u);setTimeout(function(){i.p.disableClick=!1},50)}},f;i.p.sortable.options?n.extend(r,i.p.sortable.options):n.isFunction(i.p.sortable)&&(i.p.sortable={update:i.p.sortable});r.start?(f=r.start,r.start=function(n,t){u();f.call(this,n,t)}):r.start=u;i.p.sortable.exclude&&(r.items+=":not("+i.p.sortable.exclude+")");t.sortable(r).data("sortable").floating=!0})},columnChooser:function(t){function a(n,t,i){if(t>=0){var r=n.slice(),u=r.splice(t,Math.max(n.length-t,t));return t>n.length&&(t=n.length),r[t]=i,r.concat(u)}}function e(t,i){t&&(typeof t=="string"?n.fn[t]&&n.fn[t].apply(i,n.makeArray(arguments).slice(2)):n.isFunction(t)&&t.apply(i,n.makeArray(arguments).slice(2)))}var i=this,u,r,s,h;if(!n("#colchooser_"+i[0].p.id).length){if(u=n('<div id="colchooser_'+i[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"><\/select><\/div><\/div>'),r=n("select",u),t=n.extend({width:420,height:240,classname:null,done:function(n){n&&i.jqGrid("remapColumns",n,!0)},msel:"multiselect",dlog:"dialog",dlog_opts:function(n){var t={};return t[n.bSubmit]=function(){n.apply_perm();n.cleanup(!1)},t[n.bCancel]=function(){n.cleanup(!0)},{buttons:t,close:function(){n.cleanup(!0)},modal:!1,resizable:!1,width:n.width+20}},apply_perm:function(){n("option",r).each(function(){this.selected?i.jqGrid("showCol",f[this.value].name):i.jqGrid("hideCol",f[this.value].name)});var u=[];n("option[selected]",r).each(function(){u.push(parseInt(this.value,10))});n.each(u,function(){delete o[f[parseInt(this,10)].name]});n.each(o,function(){var n=parseInt(this,10);u=a(u,n,n)});t.done&&t.done.call(i,u)},cleanup:function(n){e(t.dlog,u,"destroy");e(t.msel,r,"destroy");u.remove();n&&t.done&&t.done.call(i)},msel_opts:{}},n.jgrid.col,t||{}),n.ui&&n.ui.multiselect&&t.msel=="multiselect"){if(!n.jgrid._multiselect){alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");return}t.msel_opts=n.extend(n.ui.multiselect.defaults,t.msel_opts)}t.caption&&u.attr("title",t.caption);t.classname&&(u.addClass(t.classname),r.addClass(t.classname));t.width&&(n(">div",u).css({width:t.width,margin:"0 auto"}),r.css("width",t.width));t.height&&(n(">div",u).css("height",t.height),r.css("height",t.height-10));var f=i.jqGrid("getGridParam","colModel"),c=i.jqGrid("getGridParam","colNames"),o={},l=[];r.empty();n.each(f,function(n){if(o[this.name]=n,this.hidedlg){this.hidden||l.push(n);return}r.append("<option value='"+n+"' "+(this.hidden?"":"selected='selected'")+">"+c[n]+"<\/option>")});s=n.isFunction(t.dlog_opts)?t.dlog_opts.call(i,t):t.dlog_opts;e(t.dlog,u,s);h=n.isFunction(t.msel_opts)?t.msel_opts.call(i,t):t.msel_opts;e(t.msel,r,h)}},sortableRows:function(t){return this.each(function(){var i=this;i.grid&&(i.p.treeGrid||n.fn.sortable&&(t=n.extend({cursor:"move",axis:"y",items:".jqgrow"},t||{}),t.start&&n.isFunction(t.start)?(t._start_=t.start,delete t.start):t._start_=!1,t.update&&n.isFunction(t.update)?(t._update_=t.update,delete t.update):t._update_=!1,t.start=function(r,u){if(n(u.item).css("border-width","0px"),n("td",u.item).each(function(n){this.style.width=i.grid.cols[n].style.width}),i.p.subGrid){var f=n(u.item).attr("id");try{n(i).jqGrid("collapseSubGridRow",f)}catch(e){}}t._start_&&t._start_.apply(this,[r,u])},t.update=function(r,u){n(u.item).css("border-width","");i.p.rownumbers===!0&&n("td.jqgrid-rownum",i.rows).each(function(t){n(this).html(t+1)});t._update_&&t._update_.apply(this,[r,u])},n("tbody:first",i).sortable(t),n("tbody:first",i).disableSelection()))})},gridDnD:function(t){return this.each(function(){function u(){var t=n.data(i,"dnd");n("tr.jqgrow:not(.ui-draggable)",i).draggable(n.isFunction(t.drag)?t.drag.call(n(i),t):t.drag)}var i=this,f,r,e;if(i.grid&&!i.p.treeGrid&&n.fn.draggable&&n.fn.droppable){if(f="<table id='jqgrid_dnd' class='ui-jqgrid-dnd'><\/table>",n("#jqgrid_dnd").html()===null&&n("body").append(f),typeof t=="string"&&t=="updateDnD"&&i.p.jqgdnd===!0){u();return}if(t=n.extend({drag:function(t){return n.extend({start:function(r,u){var e,f;if(i.p.subGrid){e=n(u.helper).attr("id");try{n(i).jqGrid("collapseSubGridRow",e)}catch(o){}}for(f=0;f<n.data(i,"dnd").connectWith.length;f++)n(n.data(i,"dnd").connectWith[f]).jqGrid("getGridParam","reccount")=="0"&&n(n.data(i,"dnd").connectWith[f]).jqGrid("addRowData","jqg_empty_row",{});u.helper.addClass("ui-state-highlight");n("td",u.helper).each(function(n){this.style.width=i.grid.headers[n].width+"px"});t.onstart&&n.isFunction(t.onstart)&&t.onstart.call(n(i),r,u)},stop:function(r,u){var e,f;for(u.helper.dropped&&(e=n(u.helper).attr("id"),n(i).jqGrid("delRowData",e)),f=0;f<n.data(i,"dnd").connectWith.length;f++)n(n.data(i,"dnd").connectWith[f]).jqGrid("delRowData","jqg_empty_row");t.onstop&&n.isFunction(t.onstop)&&t.onstop.call(n(i),r,u)}},t.drag_opts||{})},drop:function(t){return n.extend({accept:function(t){var i=n(t).closest("table.ui-jqgrid-btable"),r;return n.data(i[0],"dnd")!==undefined?(r=n.data(i[0],"dnd").connectWith,n.inArray("#"+this.id,r)!=-1?!0:!1):t},drop:function(r,u){var v=n(u.draggable).attr("id"),f=n("#"+i.id).jqGrid("getRowData",v),h,e,o;if(!t.dropbyname){var s=0,c={},l,a=n("#"+this.id).jqGrid("getGridParam","colModel");try{for(h in f)f.hasOwnProperty(h)&&a[s]&&(l=a[s].name,c[l]=f[h]),s++;f=c}catch(y){}}u.helper.dropped=!0;t.beforedrop&&n.isFunction(t.beforedrop)&&(e=t.beforedrop.call(this,r,u,f,n("#"+i.id),n(this)),typeof e!="undefined"&&e!==null&&typeof e=="object"&&(f=e));u.helper.dropped&&(t.autoid&&(n.isFunction(t.autoid)?o=t.autoid.call(this,f):(o=Math.ceil(Math.random()*1e3),o=t.autoidprefix+o)),n("#"+this.id).jqGrid("addRowData",o,f,t.droppos));t.ondrop&&n.isFunction(t.ondrop)&&t.ondrop.call(this,r,u,f)}},t.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},t||{}),t.connectWith)for(t.connectWith=t.connectWith.split(","),t.connectWith=n.map(t.connectWith,function(t){return n.trim(t)}),n.data(i,"dnd",t),i.p.reccount=="0"||i.p.jqgdnd||u(),i.p.jqgdnd=!0,r=0;r<t.connectWith.length;r++)e=t.connectWith[r],n(e).droppable(n.isFunction(t.drop)?t.drop.call(n(i),t):t.drop)}})},gridResize:function(t){return this.each(function(){var i=this,r;i.grid&&n.fn.resizable&&(t=n.extend({},t||{}),t.alsoResize?(t._alsoResize_=t.alsoResize,delete t.alsoResize):t._alsoResize_=!1,t.stop&&n.isFunction(t.stop)?(t._stop_=t.stop,delete t.stop):t._stop_=!1,t.stop=function(r,u){n(i).jqGrid("setGridParam",{height:n("#gview_"+i.p.id+" .ui-jqgrid-bdiv").height()});n(i).jqGrid("setGridWidth",u.size.width,t.shrinkToFit);t._stop_&&t._stop_.call(i,r,u)},t._alsoResize_?(r="{'#gview_"+i.p.id+" .ui-jqgrid-bdiv':true,'"+t._alsoResize_+"':true}",t.alsoResize=eval("("+r+")")):t.alsoResize=n(".ui-jqgrid-bdiv","#gview_"+i.p.id),delete t._alsoResize_,n("#gbox_"+i.p.id).resizable(t))})}})})(jQuery)